import { j as e, r as k, t as j } from "./react-D9TtqY-V.js";
import { f as E, i as $ } from "./@tanstack-3iyDWv8L.js";
import { C as q, S as Q, m as I } from "./db-master-BrZHBPj2.js";
import { B as x } from "./button-CMoAlsw3.js";
import { B as S } from "./badge-B6qKYUZD.js";
import { C as i, d, a as o, b as m, c as A } from "./card-85OZoUtz.js";
import { T as U, a as R, b as f, c as b } from "./tabs-D5XuT8p1.js";
import { B as V, l as L, Y, a7 as K, a2 as X, a8 as F, _ as Z, a9 as ee, a3 as se, aa as ae, P as re, s as te, u as J, x as ce, D as le, v as ne, ab as ie, ac as P, ad as de, d as oe } from "./icons-bBaH0MBC.js";
import { g as _ } from "./mode-registry-feswD2MX.js";
import { D as O, a as B, b as z, c as me, d as M, e as v, S as xe } from "./SessionSetupWizard-CsDv7O_p.js";
import { e as he, b as je } from "./card-converters-CUCioum9.js";
import { D as ue, g as pe, a as ge, b as Ne, c as fe } from "./dialog-v6BqSj-g.js";
import { C as be } from "./checkbox-DyRtCSLW.js";
import { L as ve } from "./label-CBzbyhxK.js";
import { A as ye, a as we, b as Ce, c as ke, d as Se, e as De, f as Ie, g as Ae, h as Te } from "./alert-dialog-Bxna6sSR.js";
import { b as $e } from "./index-IzUhM_kF.js";
import "./vendor-C4ToNUTj.js";
import "./@radix-ui-BQCqNqg0.js";
import "./immer-BCQU3qJI.js";
import "./dexie-C2pyTzVO.js";
import "./zod-fbN9ubnj.js";
import "./components-and-styling-lnR2ABT4.js";
import "./shadcn-utils-BMZD7_jZ.js";
import "./@tailwind-COJ8Fh6m.js";
import "./llm-readiness-DgR8F2ee.js";
import "./input-CtGFdN_9.js";
import "./textarea-NuAUq_bK.js";
const Le = (s) => !s.lorebook || !s.lorebook.entries || s.lorebook.entries.length === 0 ? e.jsx(i, { className: "bg-muted/20 border-dashed", children: e.jsxs(d, { className: "py-10 flex flex-col items-center justify-center text-muted-foreground", children: [e.jsx(V, { className: "w-10 h-10 mb-3 opacity-20" }), e.jsx("p", { className: "text-sm", children: "\u8BE5\u89D2\u8272\u6682\u65E0\u7ED1\u5B9A\u7684\u77E5\u8BC6\u4E66 (Lorebook)" })] }) }) : e.jsxs("div", { className: "space-y-6", children: [e.jsxs("div", { className: "flex flex-wrap gap-4", children: [e.jsxs("div", { className: "flex items-center gap-2 text-xs bg-muted/50 px-3 py-1.5 rounded-full border", children: [e.jsx(L, { className: "w-3.5 h-3.5 text-primary" }), e.jsx("span", { className: "font-medium text-muted-foreground mr-1", children: "\u626B\u63CF\u6DF1\u5EA6:" }), s.lorebook.scan_depth ?? 50] }), e.jsxs("div", { className: "flex items-center gap-2 text-xs bg-muted/50 px-3 py-1.5 rounded-full border", children: [e.jsx(Y, { className: "w-3.5 h-3.5 text-blue-500" }), e.jsx("span", { className: "font-medium text-muted-foreground mr-1", children: "Token \u9884\u7B97:" }), s.lorebook.token_budget ?? 500] }), s.lorebook.recursive_scanning && e.jsxs("div", { className: "flex items-center gap-2 text-xs bg-green-500/5 text-green-600 px-3 py-1.5 rounded-full border border-green-500/20", children: [e.jsx(K, { className: "w-3.5 h-3.5" }), "\u9012\u5F52\u626B\u63CF\u5DF2\u5F00\u542F"] })] }), e.jsx("div", { className: "grid grid-cols-1 gap-4", children: s.lorebook.entries.map((t, c) => e.jsx(i, { className: "overflow-hidden group hover:border-primary/40 transition-colors shadow-sm", children: e.jsxs("div", { className: "flex", children: [e.jsx("div", { className: "w-1 bg-primary group-hover:w-2 transition-all shrink-0" }), e.jsxs("div", { className: "grow", children: [e.jsxs(o, { className: "py-4 flex flex-row items-start justify-between space-y-0", children: [e.jsxs("div", { className: "space-y-1.5 grow", children: [e.jsxs("div", { className: "flex items-center gap-2 flex-wrap", children: [e.jsx(m, { className: "text-base font-bold", children: t.name || `\u6761\u76EE ${c + 1}` }), !t.enabled && e.jsx(S, { variant: "secondary", children: "\u5DF2\u7981\u7528" }), t.constant && e.jsx(S, { variant: "outline", className: "text-amber-600 border-amber-200 bg-amber-50", children: "\u5E38\u91CF" })] }), e.jsx("div", { className: "flex flex-wrap gap-1.5", children: t.keys.map((l) => e.jsxs("div", { className: "flex items-center gap-1 bg-primary/5 text-[10px] text-primary px-1.5 py-0.5 rounded border border-primary/10 font-mono", children: [e.jsx(X, { className: "w-2.5 h-2.5" }), l] }, `key-${l}-${t.id || c}`)) })] }), e.jsxs("div", { className: "text-[10px] text-muted-foreground font-mono text-right shrink-0 ml-4", children: ["Order: ", t.insertion_order, " ", e.jsx("br", {}), "Pos: ", t.position === "before_char" ? "Before Char" : "After Char"] })] }), e.jsxs(d, { className: "pb-4", children: [e.jsx("div", { className: "text-sm bg-muted/30 p-3 rounded-lg border text-muted-foreground leading-relaxed whitespace-pre-wrap", children: t.content }), t.comment && e.jsxs("p", { className: "mt-2 text-[10px] text-muted-foreground italic flex items-center gap-1", children: [e.jsx(L, { className: "w-2.5 h-2.5 opacity-50" }), "\u6CE8: ", t.comment] })] })] })] }) }, t.id || `entry-${c}`)) })] }), Pe = (s) => e.jsx("div", { className: "space-y-6", children: e.jsxs(U, { defaultValue: "basic", className: "w-full", children: [e.jsxs(R, { className: "grid grid-cols-4 w-full h-11 bg-muted/30 p-1 mb-6", children: [e.jsx(f, { value: "basic", className: "data-[state=active]:bg-background", children: "\u57FA\u7840\u8BBE\u5B9A" }), e.jsx(f, { value: "prompt", className: "data-[state=active]:bg-background", children: "\u63D0\u793A\u8BCD\u6A21\u677F" }), e.jsx(f, { value: "lorebook", className: "data-[state=active]:bg-background", children: "\u77E5\u8BC6\u4E66" }), e.jsx(f, { value: "advanced", className: "data-[state=active]:bg-background", children: "\u9AD8\u7EA7/\u6269\u5C55" })] }), e.jsxs(b, { value: "basic", className: "space-y-6 animate-in fade-in-50 duration-300", children: [e.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-6", children: [e.jsxs(i, { className: "shadow-xs border-muted/50", children: [e.jsx(o, { className: "py-4", children: e.jsxs(m, { className: "text-sm flex items-center gap-2", children: [e.jsx(F, { className: "w-4 h-4 text-primary" }), "\u4EBA\u683C\u4E0E\u8EAB\u4E16"] }) }), e.jsxs(d, { className: "space-y-4", children: [e.jsxs("div", { className: "space-y-1.5", children: [e.jsx(N, { children: "\u4EBA\u683C\u63CF\u8FF0 (Personality)" }), e.jsx(h, { children: s.character.personality })] }), e.jsxs("div", { className: "space-y-1.5", children: [e.jsx(N, { children: "\u89D2\u8272\u63CF\u8FF0 (Description)" }), e.jsx(h, { children: s.character.description })] })] })] }), e.jsxs(i, { className: "shadow-xs border-muted/50", children: [e.jsx(o, { className: "py-4", children: e.jsxs(m, { className: "text-sm flex items-center gap-2", children: [e.jsx(Z, { className: "w-4 h-4 text-green-500" }), "\u5F00\u573A\u8BED\u4E0E\u793A\u4F8B"] }) }), e.jsxs(d, { className: "space-y-4", children: [e.jsxs("div", { className: "space-y-1.5", children: [e.jsx(N, { children: "\u7B2C\u4E00\u6761\u6D88\u606F (First Message)" }), e.jsx(h, { variant: "primary", children: s.character.first_mes })] }), e.jsxs("div", { className: "space-y-1.5", children: [e.jsx(N, { children: "\u5BF9\u8BDD\u573A\u666F\u63CF\u8FF0 (Scenario)" }), e.jsx(h, { children: s.character.scenario })] }), s.character.alternate_greetings.length > 0 && e.jsxs("div", { className: "space-y-1.5", children: [e.jsxs(N, { children: ["\u5907\u7528\u95EE\u5019\u8BED (", s.character.alternate_greetings.length, ")"] }), e.jsx("div", { className: "space-y-2", children: s.character.alternate_greetings.map((t, c) => e.jsx(h, { className: "py-2 opacity-80", children: t }, `alt-greet-${c}-${t.length}`)) })] })] })] })] }), e.jsxs(i, { className: "shadow-xs border-muted/50", children: [e.jsx(o, { className: "py-4", children: e.jsxs(m, { className: "text-sm flex items-center gap-2", children: [e.jsx(ee, { className: "w-4 h-4 text-amber-500" }), "\u6D88\u606F\u793A\u4F8B (Message Examples)"] }) }), e.jsx(d, { children: e.jsx(h, { className: "font-mono text-xs", children: s.character.mes_example }) })] })] }), e.jsxs(b, { value: "prompt", className: "space-y-6 animate-in fade-in-50 duration-300", children: [e.jsxs(i, { className: "border-muted/50", children: [e.jsxs(o, { className: "py-4", children: [e.jsxs(m, { className: "text-sm flex items-center gap-2 text-blue-600", children: [e.jsx(se, { className: "w-4 h-4" }), "\u7CFB\u7EDF\u63D0\u793A\u8BCD\u6A21\u677F (System Prompt)"] }), e.jsx(A, { className: "text-[11px]", children: "\u5C06\u63D2\u5165\u5230\u5BF9\u8BDD\u5386\u53F2\u7684\u6700\u524D\u65B9\uFF0C\u7528\u4E8E\u5B9A\u4E49\u89D2\u8272\u7684\u6838\u5FC3\u884C\u4E3A\u51C6\u5219\u3002" })] }), e.jsx(d, { children: e.jsx(h, { className: "font-mono text-xs bg-blue-500/2 border-blue-500/10", children: s.character.system_prompt || "\u4F7F\u7528\u5168\u5C40\u9ED8\u8BA4\u8BBE\u7F6E" }) })] }), e.jsxs(i, { className: "border-muted/50", children: [e.jsxs(o, { className: "py-4", children: [e.jsxs(m, { className: "text-sm flex items-center gap-2 text-purple-600", children: [e.jsx(ae, { className: "w-4 h-4" }), "\u5386\u53F2\u6307\u4EE4\u540E\u7F00 (Post-History Instructions)"] }), e.jsx(A, { className: "text-[11px]", children: "\u5C06\u63D2\u5165\u5230\u6BCF\u6761\u8BF7\u6C42\u6D88\u606F\u4E4B\u540E\uFF0C\u7528\u4E8E\u5F3A\u5236 LLM \u9075\u5B88\u7279\u5B9A\u8F93\u51FA\u683C\u5F0F\u3002" })] }), e.jsx(d, { children: e.jsx(h, { className: "font-mono text-xs bg-purple-500/2 border-purple-500/10", children: s.character.post_history_instructions || "\u65E0\u7279\u5B9A\u6307\u4EE4" }) })] })] }), e.jsx(b, { value: "lorebook", className: "animate-in fade-in-50 duration-300", children: e.jsx(Le, { lorebook: s.character.character_book }) }), e.jsx(b, { value: "advanced", className: "space-y-6 animate-in fade-in-50 duration-300", children: e.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-6", children: [e.jsxs(i, { className: "border-muted/50", children: [e.jsx(o, { className: "py-4", children: e.jsx(m, { className: "text-sm", children: "\u5143\u6570\u636E\u4FE1\u606F" }) }), e.jsxs(d, { className: "space-y-3", children: [e.jsx(C, { label: "\u521B\u5EFA\u8005", value: s.character.creator }), e.jsx(C, { label: "\u89D2\u8272\u7248\u672C", value: s.character.character_version }), e.jsx(C, { label: "\u521B\u5EFA\u4E8E", value: s.character.createdAt ? new Date(s.character.createdAt).toLocaleString() : "-" }), e.jsx(C, { label: "\u66F4\u65B0\u4E8E", value: s.character.updatedAt ? new Date(s.character.updatedAt).toLocaleString() : "-" }), e.jsxs("div", { className: "pt-2", children: [e.jsx(N, { children: "\u521B\u5EFA\u8005\u7B14\u8BB0 (Creator Notes)" }), e.jsx(h, { className: "mt-1 text-xs", children: s.character.creator_notes })] })] })] }), e.jsxs(i, { className: "border-muted/50", children: [e.jsx(o, { className: "py-4", children: e.jsx(m, { className: "text-sm", children: "\u6269\u5C55\u5B57\u6BB5 (Extensions)" }) }), e.jsx(d, { children: e.jsx("div", { className: "max-h-75 overflow-auto rounded-lg border bg-muted/20 p-4", children: e.jsx("pre", { className: "text-[10px] font-mono leading-tight", children: JSON.stringify(s.character.extensions, null, 2) }) }) })] })] }) })] }) }), N = (s) => e.jsx("span", { className: "text-[11px] font-bold text-muted-foreground/80 uppercase tracking-widest block", children: s.children }), h = (s) => e.jsx("div", { className: `text-sm rounded-lg border p-3 leading-relaxed whitespace-pre-wrap ${s.variant === "primary" ? "bg-primary/5 text-primary/90 border-primary/20 italic" : "bg-muted/30 text-muted-foreground/90 border-muted/50"} ${s.className || ""}`, children: s.children || e.jsx("span", { className: "opacity-30", children: "\u672A\u586B\u5199" }) }), C = (s) => e.jsxs("div", { className: "flex justify-between items-center text-xs py-1.5 border-b border-muted/50 last:border-0", children: [e.jsx("span", { className: "text-muted-foreground", children: s.label }), e.jsx("span", { className: "font-mono font-medium", children: s.value ?? "-" })] }), _e = (s) => {
  const t = E();
  return e.jsxs("div", { className: "space-y-6", children: [e.jsxs(i, { className: "border-primary/20 bg-primary/5", children: [e.jsxs(o, { children: [e.jsxs(m, { className: "text-lg flex items-center gap-2", children: [e.jsx(re, { className: "w-5 h-5" }), "\u5F00\u542F\u65B0\u4F1A\u8BDD"] }), e.jsx(A, { children: "\u9009\u62E9\u4E00\u4E2A\u6A21\u5F0F\u5F00\u59CB\u4E0E\u8BE5\u89D2\u8272\u7684\u6545\u4E8B" })] }), e.jsx(d, { className: "grid grid-cols-1 sm:grid-cols-3 gap-4", children: ["chat", "challenge", "dnd", "group-chat"].map((c) => {
    const l = _(c), a = l.icon;
    return e.jsxs(x, { className: "h-auto py-4 flex flex-col items-center gap-2", variant: "outline", onClick: () => s.onStartNew(c), type: "button", children: [e.jsx(a, { className: `w-6 h-6 ${l.colorClass}` }), e.jsxs("div", { className: "text-center", children: [e.jsxs("div", { className: "font-bold", children: [l.label, "\u6A21\u5F0F"] }), e.jsx("div", { className: "text-[10px] text-muted-foreground", children: l.description })] })] }, c);
  }) })] }), e.jsxs(i, { children: [e.jsx(o, { children: e.jsx(m, { className: "text-lg", children: "\u5386\u53F2\u4F1A\u8BDD" }) }), e.jsx(d, { className: "space-y-3", children: s.sessions.length > 0 ? s.sessions.map((c) => e.jsxs(x, { className: "w-full justify-between items-center h-auto py-4 px-5 border hover:bg-muted/50 transition-colors", variant: "ghost", onClick: () => t({ to: "/session/$sessionId", params: { sessionId: c.id } }), type: "button", children: [e.jsxs("div", { className: "flex items-center gap-4", children: [e.jsx("div", { className: "w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center", children: e.jsx(te, { className: "w-6 h-6 text-primary" }) }), e.jsxs("div", { className: "text-left", children: [e.jsx("div", { className: "font-semibold", children: "\u7EE7\u7EED\u4E0A\u6B21\u6545\u4E8B" }), e.jsxs("div", { className: "text-xs text-muted-foreground mt-1", children: ["\u6700\u540E\u6D3B\u8DC3: ", new Date(c.updatedAt).toLocaleString()] })] })] }), e.jsx("div", { className: "flex flex-col items-end gap-2", children: e.jsx(S, { variant: c.mode === "chat" ? "secondary" : "default", className: "text-[10px]", children: _(c.mode).badgeText }) })] }, c.id)) : e.jsx("div", { className: "text-center py-10 border rounded-lg border-dashed", children: e.jsx("p", { className: "text-muted-foreground text-sm", children: "\u8FD8\u6CA1\u6709\u8BE5\u89D2\u8272\u7684\u5386\u53F2\u4F1A\u8BDD" }) }) })] })] });
};
function Oe({ character: s, trigger: t }) {
  const [c, l] = k.useState(false), [a, D] = k.useState(false), y = k.useId(), w = () => {
    try {
      const u = he(s, { includeImageBase64: a }), T = "data:text/json;charset=utf-8," + encodeURIComponent(u), p = document.createElement("a");
      p.setAttribute("href", T), p.setAttribute("download", `${s.name}.json`), document.body.appendChild(p), p.click(), p.remove(), j.success(`\u89D2\u8272 ${s.name} \u5DF2\u5BFC\u51FA\u4E3A JSON`), l(false);
    } catch (u) {
      j.error("\u5BFC\u51FA\u5931\u8D25"), console.error("Export error:", u);
    }
  };
  return e.jsxs(ue, { open: c, onOpenChange: l, children: [e.jsx(pe, { asChild: true, children: t || e.jsxs(x, { variant: "outline", size: "sm", className: "flex items-center gap-2", type: "button", children: [e.jsx(J, { className: "w-4 h-4" }), "\u5BFC\u51FA JSON"] }) }), e.jsxs(ge, { className: "sm:max-w-md", children: [e.jsx(Ne, { children: e.jsx(fe, { children: "\u5BFC\u51FA\u89D2\u8272\u4E3A JSON" }) }), e.jsxs("div", { className: "space-y-4", children: [e.jsxs("p", { className: "text-sm text-muted-foreground", children: ['\u5C06\u89D2\u8272 "', s.name, '" \u5BFC\u51FA\u4E3A JSON \u6587\u4EF6\u3002'] }), e.jsxs("div", { className: "flex items-center space-x-2", children: [e.jsx(be, { id: `${y}-include-image-single`, checked: a, onCheckedChange: (u) => D(u === true) }), e.jsx(ve, { htmlFor: `${y}-include-image-single`, className: "text-sm", children: "\u5305\u542B Base64 \u56FE\u50CF\u6570\u636E" })] }), e.jsx("p", { className: "text-xs text-muted-foreground", children: a ? "\u6587\u4EF6\u5C06\u5305\u542B\u56FE\u50CF\u6570\u636E\uFF0C\u6587\u4EF6\u8F83\u5927\u4F46\u5B8C\u6574\u3002" : "\u6587\u4EF6\u4E0D\u5305\u542B\u56FE\u50CF\u6570\u636E\uFF0C\u6587\u4EF6\u8F83\u5C0F\u4F46\u9700\u8981\u5355\u72EC\u5904\u7406\u56FE\u50CF\u3002" })] }), e.jsxs("div", { className: "flex justify-end gap-2", children: [e.jsx(x, { variant: "outline", onClick: () => l(false), children: "\u53D6\u6D88" }), e.jsx(x, { onClick: w, children: "\u5BFC\u51FA" })] })] })] });
}
function ds() {
  const { characterId: s } = $e.useParams(), t = E(), { data: c = [] } = $((r) => r.from({ c: q })), { data: l = [] } = $((r) => r.from({ s: Q })), a = c.find((r) => r.id === s), D = l.filter((r) => r.characterId === s), [y, w] = k.useState(false);
  if (!a) return e.jsxs("div", { className: "p-20 text-center flex flex-col items-center gap-4", children: [e.jsx("p", { className: "text-muted-foreground", children: "\u89D2\u8272\u4E0D\u5B58\u5728" }), e.jsx(x, { onClick: () => t({ to: "/plaza/characters" }), variant: "outline", type: "button", children: "\u8FD4\u56DE\u5217\u8868" })] });
  const u = (r) => {
    if (r === "challenge") {
      j.info("\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u6311\u6218\u5267\u672C\u4EE5\u5F00\u59CB\u6311\u6218\u6A21\u5F0F"), t({ to: "/plaza/challenges" });
      return;
    }
    if (r === "dnd") {
      t({ to: "/create/dnd" });
      return;
    }
    if (r === "group-chat") {
      t({ to: "/create/group-chat" });
      return;
    }
    w(true);
  }, p = { mode: "chat", character: a, onConfirm: async (r) => {
    try {
      const n = crypto.randomUUID(), g = Date.now(), W = { id: n, title: `\u4E0E ${a.name} \u7684\u804A\u5929`, contextId: null, mode: "chat", modeConfig: { characterId: a.id, globalSystemPrompt: r.globalSystemPrompt || null, userName: r.userName || "User" }, modeState: {}, characterId: a.id, challengeId: void 0, createdAt: g, updatedAt: g, isActive: true };
      await I.sessions.add(W), t({ to: "/session/$sessionId", params: { sessionId: n }, search: { mode: "chat" } });
    } catch (n) {
      console.error("Failed to create session:", n), j.error("\u521B\u5EFA\u4F1A\u8BDD\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5");
    }
  } }, G = () => {
    try {
      if (!a.imageBase64) {
        j.error("\u8BE5\u89D2\u8272\u6CA1\u6709\u5934\u50CF\u56FE\u7247\uFF0C\u65E0\u6CD5\u5BFC\u51FA\u4E3A PNG \u89D2\u8272\u5361");
        return;
      }
      const r = je(a), n = URL.createObjectURL(r), g = document.createElement("a");
      g.href = n, g.download = `${a.name}.png`, g.click(), URL.revokeObjectURL(n), j.success(`\u89D2\u8272 ${a.name} \u5DF2\u5BFC\u51FA\u4E3A PNG \u89D2\u8272\u5361`);
    } catch (r) {
      console.error(r), j.error("\u5BFC\u51FA PNG \u89D2\u8272\u5361\u5931\u8D25");
    }
  }, H = async () => {
    try {
      const r = l.filter((n) => n.characterId === s);
      for (const n of r) await I.sessions.delete(n.id);
      await I.characters.delete(s), j.success("\u89D2\u8272\u5DF2\u5220\u9664"), t({ to: "/plaza/characters" });
    } catch (r) {
      console.error("Failed to delete character:", r), j.error("\u5220\u9664\u89D2\u8272\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5");
    }
  };
  return e.jsxs("div", { className: "w-full max-w-5xl mx-auto p-4 md:p-8 space-y-8 animate-in fade-in duration-500", children: [e.jsxs("div", { className: "flex items-center justify-between", children: [e.jsxs(x, { variant: "ghost", size: "sm", className: "mb-2 -ml-2 text-muted-foreground hover:bg-transparent", onClick: () => t({ to: "/plaza/characters" }), type: "button", children: [e.jsx(ce, { className: "w-4 h-4 mr-1" }), " \u8FD4\u56DE\u89D2\u8272\u5E7F\u573A"] }), e.jsxs("div", { className: "flex items-center gap-2", children: [e.jsxs(O, { children: [e.jsx(B, { asChild: true, children: e.jsxs(x, { variant: "outline", size: "sm", className: "flex gap-2 h-8 rounded-lg", type: "button", children: [e.jsx(le, { className: "w-4 h-4" }), "\u5BFC\u51FA"] }) }), e.jsxs(z, { align: "end", className: "w-56", children: [e.jsx(me, { children: "\u9009\u62E9\u5BFC\u51FA\u683C\u5F0F" }), e.jsx(M, {}), e.jsxs(v, { onClick: G, children: [e.jsx(ne, { className: "mr-2 h-4 w-4" }), " \u5BFC\u51FA PNG \u89D2\u8272\u5361 (\u63A8\u8350)"] }), e.jsx(Oe, { character: a, trigger: e.jsxs(v, { onSelect: (r) => r.preventDefault(), children: [e.jsx(J, { className: "mr-2 h-4 w-4" }), " \u5BFC\u51FA JSON \u539F\u59CB\u6570\u636E"] }) })] })] }), e.jsxs(O, { children: [e.jsx(B, { asChild: true, children: e.jsx(x, { variant: "ghost", size: "icon", className: "h-8 w-8 rounded-full", type: "button", children: e.jsx(ie, { className: "w-4 h-4" }) }) }), e.jsxs(z, { align: "end", className: "w-48", children: [e.jsxs(v, { onClick: () => t({ to: "/characters/$characterId/edit", params: { characterId: a.id } }), children: [e.jsx(P, { className: "mr-2 h-4 w-4" }), " \u7F16\u8F91\u89D2\u8272"] }), e.jsxs(v, { children: [e.jsx(de, { className: "mr-2 h-4 w-4" }), " \u5206\u4EAB\u89D2\u8272"] }), e.jsx(M, {}), e.jsxs(ye, { children: [e.jsx(we, { asChild: true, children: e.jsxs(v, { onSelect: (r) => r.preventDefault(), className: "text-destructive focus:bg-destructive/10 focus:text-destructive", children: [e.jsx(oe, { className: "mr-2 h-4 w-4" }), " \u5220\u9664\u89D2\u8272"] }) }), e.jsxs(Ce, { children: [e.jsxs(ke, { children: [e.jsx(Se, { children: "\u786E\u8BA4\u5220\u9664\u89D2\u8272" }), e.jsxs(De, { children: ['\u786E\u5B9A\u8981\u5220\u9664\u89D2\u8272 "', a.name, '" \u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\uFF0C\u4E14\u4F1A\u6E05\u9664\u6240\u6709\u5173\u8054\u7684\u4F1A\u8BDD\u8BB0\u5F55\u3002'] })] }), e.jsxs(Ie, { children: [e.jsx(Ae, { children: "\u53D6\u6D88" }), e.jsx(Te, { onClick: H, className: "bg-destructive hover:bg-destructive/90", children: "\u786E\u8BA4\u5220\u9664" })] })] })] })] })] })] })] }), e.jsxs("div", { className: "flex flex-col md:flex-row gap-8 items-start pb-8 border-b", children: [e.jsx("div", { className: "w-40 h-40 rounded-3xl bg-muted flex items-center justify-center shrink-0 border-4 border-background shadow-xl overflow-hidden", children: a.imageBase64 || a.avatar ? e.jsx("img", { src: a.imageBase64 || a.avatar, alt: a.name, className: "w-full h-full object-cover" }) : e.jsx(F, { className: "w-20 h-20 text-muted-foreground/30" }) }), e.jsxs("div", { className: "space-y-5 grow", children: [e.jsxs("div", { className: "space-y-1", children: [e.jsxs("div", { className: "flex items-center gap-3", children: [e.jsx("h1", { className: "text-4xl font-extrabold tracking-tight", children: a.name }), e.jsxs(x, { variant: "outline", size: "sm", onClick: () => t({ to: "/characters/$characterId/edit", params: { characterId: a.id } }), className: "flex items-center gap-2", type: "button", children: [e.jsx(P, { className: "w-4 h-4" }), "\u7F16\u8F91"] })] }), e.jsx("p", { className: "text-xl text-muted-foreground font-medium", children: a.nickname || a.name })] }), e.jsx("div", { className: "flex flex-wrap gap-2", children: a.tags.map((r) => e.jsx(S, { variant: "secondary", className: "px-3 py-1 font-medium", children: r }, r)) }), e.jsxs("p", { className: "text-base leading-relaxed text-muted-foreground/90 max-w-2xl", children: [a.description.slice(0, 200), a.description.length > 200 ? "..." : ""] })] })] }), e.jsxs(U, { defaultValue: "sessions", className: "w-full", children: [e.jsxs(R, { className: "w-full justify-start h-12 bg-muted/50 p-1 mb-6", children: [e.jsx(f, { value: "sessions", className: "px-8 h-10 data-[state=active]:shadow-sm", children: "\u4F1A\u8BDD & \u8BB0\u5F55" }), e.jsx(f, { value: "details", className: "px-8 h-10 data-[state=active]:shadow-sm", children: "\u6863\u6848\u8BE6\u60C5" })] }), e.jsx(b, { value: "sessions", className: "mt-0", children: e.jsx("div", { className: "grid grid-cols-1 md:grid-cols-1 gap-8", children: e.jsx(_e, { characterId: a.id, sessions: D, onStartNew: u }) }) }), e.jsx(b, { value: "details", className: "mt-0", children: e.jsx(Pe, { character: a }) })] }), e.jsx(xe, { open: y, onOpenChange: w, wizardProps: p })] });
}
export {
  ds as component
};
