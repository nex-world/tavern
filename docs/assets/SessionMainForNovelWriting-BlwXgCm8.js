const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/db-master-BrZHBPj2.js","assets/@tanstack-3iyDWv8L.js","assets/react-D9TtqY-V.js","assets/vendor-C4ToNUTj.js","assets/@radix-ui-BQCqNqg0.js","assets/immer-BCQU3qJI.js","assets/dexie-C2pyTzVO.js","assets/zod-fbN9ubnj.js"])))=>i.map(i=>d[i]);
var __defProp = Object.defineProperty;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __publicField = (obj, key, value) => __defNormalProp(obj, typeof key !== "symbol" ? key + "" : key, value);
import { F as fe, ak as ot, D as Ie, aH as _e, r as T, t as C, j as e, E as Y } from "./react-D9TtqY-V.js";
import { r as it, m as je, S as ct } from "./db-master-BrZHBPj2.js";
import { k as ae, m as oe, i as lt } from "./@tanstack-3iyDWv8L.js";
import { _ as dt, __tla as __tla_0 } from "./index-IzUhM_kF.js";
import { C as mt } from "./context-manager.class-B2xis078.js";
import { S as pt } from "./session-manager.class-DPAZ4frV.js";
import { n as k } from "./id-OxPLOBIU.js";
import { o as M, c as ye, n as I, _ as U, s as f, a as L, b as ue, r as ut, l as ht } from "./zod-fbN9ubnj.js";
import { D as xt } from "./dexie-C2pyTzVO.js";
import { B as j } from "./button-CMoAlsw3.js";
import { u as se, a as q } from "./global-llm-config.store-C91qlFOh.js";
import { T as G } from "./textarea-NuAUq_bK.js";
import { L as W } from "./label-CBzbyhxK.js";
import { l as Ce } from "./formatting-8HslT92O.js";
import { D as gt, a as _t, b as ft, c as wt, d as St, e as yt } from "./dialog-v6BqSj-g.js";
import { i as z, L as H, P as Nt, aq as vt, ar as he, d as bt, a5 as It, as as jt, aa as De, at as $, J as F, ac as Te, w as Ct, R as $e, B as ie, ai as we, m as Tt, D as At, ak as Ae } from "./icons-bBaH0MBC.js";
import { I as ke } from "./input-CtGFdN_9.js";
import { C as O } from "./card-85OZoUtz.js";
import { S as Ee, a as Me, b as Pe, c as Oe, d as de } from "./select-BTDHXfPN.js";
import "./vendor-C4ToNUTj.js";
import "./@radix-ui-BQCqNqg0.js";
import "./immer-BCQU3qJI.js";
import "./es-toolkit-CstbrnlE.js";
import "./components-and-styling-lnR2ABT4.js";
import "./shadcn-utils-BMZD7_jZ.js";
import "./@tailwind-COJ8Fh6m.js";
let sr;
let __tla = Promise.all([
  (() => {
    try {
      return __tla_0;
    } catch {
    }
  })()
]).then(async () => {
  const kt = `
\u4F60\u662F\u4E16\u754C\u89C2\u8BBE\u8BA1\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u4E3A\u5C0F\u8BF4\u521B\u4F5C\u751F\u6210\u5B8C\u6574\u7684\u4E16\u754C\u89C2\u8BBE\u5B9A\u3002
\u7528\u6237\u53EF\u80FD\u4F1A\u63D0\u4F9B\u4E00\u4E9B\u7B80\u5355\u7684\u63D0\u793A\uFF08\u5982"\u53E4\u4EE3\u6B66\u4FA0"\u3001"\u8D5B\u535A\u670B\u514B"\u7B49\uFF09\uFF0C
\u4E5F\u53EF\u80FD\u4E0D\u63D0\u4F9B\u4EFB\u4F55\u63D0\u793A\u3002

\u4F60\u9700\u8981\u751F\u6210\uFF1A
1. timePeriod: \u65F6\u4EE3\u80CC\u666F - \u8BE6\u7EC6\u63CF\u8FF0\u65F6\u4EE3\u7279\u5F81\u3001\u5386\u53F2\u80CC\u666F
2. socialSystem: \u793E\u4F1A\u5236\u5EA6 - \u653F\u6CBB\u4F53\u5236\u3001\u793E\u4F1A\u7ED3\u6784\u3001\u9636\u7EA7\u5212\u5206\u7B49
3. techSystem: \u6280\u672F\u4F53\u7CFB - \u79D1\u6280\u6C34\u5E73\u3001\u91CD\u8981\u6280\u672F\u3001\u9650\u5236\u7B49\uFF08\u53EF\u9009\uFF09
4. powerSystem: \u80FD\u529B\u4F53\u7CFB - \u7279\u6B8A\u80FD\u529B\u3001\u4FEE\u70BC\u4F53\u7CFB\u3001\u529B\u91CF\u6765\u6E90\u7B49\uFF08\u53EF\u9009\uFF09
5. otherSettings: \u5176\u4ED6\u8BBE\u5B9A - \u8D27\u5E01\u3001\u8BED\u8A00\u3001\u5730\u7406\u7B49\u8865\u5145\u8BBE\u5B9A\uFF08\u53EF\u9009\uFF09

\u8F93\u51FA\u683C\u5F0F\u4E3A JSON\uFF1A
{
  "timePeriod": "...",
  "socialSystem": "...",
  "techSystem": "...",
  "powerSystem": "...",
  "otherSettings": "..."
}

\u8981\u6C42\uFF1A
- \u8BBE\u5B9A\u8981\u81EA\u6D3D\u3001\u5408\u7406
- \u7EC6\u8282\u4E30\u5BCC\u4F46\u4E0D\u5197\u4F59
- \u9002\u5408\u5C0F\u8BF4\u521B\u4F5C
`.trim(), Et = `
\u4F60\u662F\u4E16\u754C\u89C2\u8BBE\u8BA1\u52A9\u624B\uFF0C\u8D1F\u8D23\u6839\u636E\u5DF2\u6709\u4FE1\u606F\u751F\u6210\u4E16\u754C\u89C2\u7684\u7279\u5B9A\u5B57\u6BB5\u5185\u5BB9\u3002

\u8981\u6C42\uFF1A
- \u4E0E\u5DF2\u6709\u5B57\u6BB5\u4FDD\u6301\u4E00\u81F4\u6027
- \u5185\u5BB9\u8BE6\u7EC6\u4F46\u4E0D\u8FC7\u4E8E\u5197\u957F\uFF08200-500\u5B57\uFF09
- \u7B26\u5408\u5C0F\u8BF4\u521B\u4F5C\u9700\u6C42
`.trim(), Mt = `
\u4F60\u662F\u89D2\u8272\u8BBE\u8BA1\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u4E3A\u5C0F\u8BF4\u521B\u4F5C\u751F\u6210\u5173\u952E\u89D2\u8272\u3002
\u6839\u636E\u4E16\u754C\u89C2\u548C\u4E3B\u9898\uFF08\u5982\u679C\u63D0\u4F9B\uFF09\uFF0C\u751F\u6210 3-5 \u4E2A\u5173\u952E\u89D2\u8272\u3002

\u89D2\u8272\u5E94\u8BE5\u5305\u62EC\uFF1A
- \u4E3B\u89D2\uFF081-2\u4E2A\uFF09
- \u91CD\u8981\u914D\u89D2\uFF081-2\u4E2A\uFF09
- \u53CD\u6D3E\u6216\u5BF9\u7ACB\u89D2\u8272\uFF081\u4E2A\uFF0C\u53EF\u9009\uFF09

\u6BCF\u4E2A\u89D2\u8272\u9700\u8981\u5305\u542B\uFF1A
- name: \u59D3\u540D\uFF08\u7B26\u5408\u4E16\u754C\u89C2\u80CC\u666F\uFF09
- role: \u89D2\u8272\u5B9A\u4F4D\uFF08\u4E3B\u89D2/\u914D\u89D2/\u53CD\u6D3E\u7B49\uFF09
- description: \u8BE6\u7EC6\u63CF\u8FF0\uFF08\u5916\u8C8C\u3001\u6027\u683C\u3001\u80CC\u666F\u3001\u52A8\u673A\u3001\u80FD\u529B\u7B49\uFF0C300-500\u5B57\uFF09

\u8F93\u51FA\u683C\u5F0F\u4E3A JSONL\uFF08\u6BCF\u884C\u4E00\u4E2A\u89D2\u8272\u7684 JSON\uFF09\uFF1A
{"name": "...", "role": "\u4E3B\u89D2", "description": "..."}
{"name": "...", "role": "\u914D\u89D2", "description": "..."}

\u8981\u6C42\uFF1A
- \u89D2\u8272\u8981\u7ACB\u4F53\u3001\u6709\u7279\u70B9
- \u89D2\u8272\u95F4\u8981\u6709\u4E92\u8865\u6027\u548C\u51B2\u7A81\u6027
- \u7B26\u5408\u4E16\u754C\u89C2\u8BBE\u5B9A
- \u6BCF\u4E2A\u89D2\u8272\u8981\u6709\u6E05\u6670\u7684\u52A8\u673A
`.trim(), Pt = `
\u4F60\u662F\u89D2\u8272\u8BBE\u8BA1\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u6839\u636E\u4E16\u754C\u89C2\u548C\u5DF2\u6709\u89D2\u8272\uFF0C\u751F\u6210\u4E00\u4E2A\u65B0\u89D2\u8272\u3002

\u8981\u6C42\uFF1A
- \u907F\u514D\u4E0E\u5DF2\u6709\u89D2\u8272\u91CD\u590D\u6216\u8FC7\u4E8E\u76F8\u4F3C
- \u4E0E\u5DF2\u6709\u89D2\u8272\u5F62\u6210\u4E92\u8865\u6216\u51B2\u7A81\u5173\u7CFB
- \u7B26\u5408\u4E16\u754C\u89C2\u8BBE\u5B9A
- \u5982\u679C\u7528\u6237\u63D0\u4F9B\u4E86\u63D0\u793A\uFF08\u5982"\u4E00\u4E2A\u795E\u79D8\u7684\u8001\u8005"\uFF09\uFF0C\u8981\u7B26\u5408\u8BE5\u63D0\u793A
- \u89D2\u8272\u8981\u6709\u72EC\u7279\u6027\u548C\u53EF\u5851\u6027

\u8F93\u51FA\u683C\u5F0F\u4E3A JSON\uFF1A
{
  "name": "...",
  "role": "...",
  "description": "..."
}
`.trim(), Ot = `
\u4F60\u662F\u89D2\u8272\u6DF1\u5316\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u5B8C\u5584\u89D2\u8272\u63CF\u8FF0\uFF0C\u589E\u52A0\u7EC6\u8282\u3001\u80CC\u666F\u6545\u4E8B\u3001\u6027\u683C\u7279\u70B9\u7B49\u3002

\u8981\u6C42\uFF1A
- \u4FDD\u6301\u89D2\u8272\u7684\u6838\u5FC3\u8BBE\u5B9A\u4E0D\u53D8
- \u589E\u52A0\u5916\u8C8C\u7EC6\u8282\u3001\u6027\u683C\u7EC6\u8282\u3001\u80CC\u666F\u6545\u4E8B
- \u8865\u5145\u89D2\u8272\u52A8\u673A\u3001\u76EE\u6807\u3001\u6050\u60E7\u3001\u6B32\u671B\u7B49
- \u589E\u52A0\u89D2\u8272\u7684\u72EC\u7279\u4E60\u60EF\u3001\u53E3\u5934\u7985\u7B49\u5C0F\u7EC6\u8282
- \u8BA9\u89D2\u8272\u66F4\u52A0\u7ACB\u4F53\u548C\u771F\u5B9E

\u8F93\u51FA\u5B8C\u5584\u540E\u7684\u5B8C\u6574\u89D2\u8272\u63CF\u8FF0\uFF08JSON \u683C\u5F0F\uFF09\u3002
`.trim(), Rt = `
\u4F60\u662F\u5C0F\u8BF4\u4E3B\u9898\u8BBE\u8BA1\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u6839\u636E\u4E16\u754C\u89C2\u548C\u89D2\u8272\u8BBE\u8BA1\u751F\u6210\u5C0F\u8BF4\u7684\u4E3B\u9898\u3002

\u4F60\u9700\u8981\u751F\u6210\uFF1A
1. mainIdea: \u4E3B\u65E8 - \u5C0F\u8BF4\u7684\u6838\u5FC3\u601D\u60F3\uFF08\u5982"\u6B63\u4E49\u5FC5\u80DC"\u3001"\u6210\u957F\u7684\u4EE3\u4EF7"\u7B49\uFF09
2. intention: \u7ACB\u610F - \u4F5C\u54C1\u7684\u601D\u60F3\u6DF1\u5EA6\u548C\u4EF7\u503C\u53D6\u5411
3. style: \u98CE\u683C - \u5982\uFF1A\u8F7B\u677E\u5E7D\u9ED8\u3001\u4E25\u8083\u6DF1\u523B\u3001\u60AC\u7591\u7D27\u5F20\u3001\u6D6A\u6F2B\u6E29\u99A8\u3001\u53F2\u8BD7\u5B8F\u5927\u7B49

\u8F93\u51FA\u683C\u5F0F\u4E3A JSON\uFF1A
{
  "mainIdea": "...",
  "intention": "...",
  "style": "..."
}

\u8981\u6C42\uFF1A
- \u4E3B\u9898\u8981\u4E0E\u4E16\u754C\u89C2\u548C\u89D2\u8272\u5339\u914D
- \u4E3B\u65E8\u8981\u6E05\u6670\u3001\u6709\u6DF1\u5EA6
- \u7ACB\u610F\u8981\u6709\u601D\u60F3\u6027
- \u98CE\u683C\u8981\u660E\u786E\u3001\u4E00\u81F4
`.trim(), Dt = `
\u4F60\u662F\u4E3B\u9898\u5206\u6790\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u5206\u6790\u5F53\u524D\u4E3B\u9898\u8BBE\u8BA1\uFF0C\u7ED9\u51FA\u6539\u8FDB\u5EFA\u8BAE\u3002

\u5206\u6790\u5185\u5BB9\uFF1A
1. \u4E3B\u9898\u7684\u4F18\u70B9
2. \u6F5C\u5728\u95EE\u9898
3. \u6539\u8FDB\u5EFA\u8BAE
4. \u4E0E\u4E16\u754C\u89C2/\u89D2\u8272\u7684\u5339\u914D\u5EA6

\u8981\u6C42\uFF1A
- \u5BA2\u89C2\u3001\u4E13\u4E1A
- \u5177\u4F53\u3001\u53EF\u64CD\u4F5C
- \u65E2\u8981\u80AF\u5B9A\u4F18\u70B9\uFF0C\u4E5F\u8981\u6307\u51FA\u95EE\u9898
`.trim(), $t = `
\u4F60\u662F\u60C5\u8282\u8BBE\u8BA1\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u6839\u636E\u7ECF\u5178\u6545\u4E8B\u7ED3\u6784\u6A21\u677F\u751F\u6210\u60C5\u8282\u8109\u7EDC\u3002

\u7528\u6237\u9009\u62E9\u7684\u7ED3\u6784\u6A21\u677F\u548C\u683C\u5F0F\u5C06\u5728 user \u6D88\u606F\u4E2D\u63D0\u4F9B\u3002

\u8BF7\u6309\u7167\u6307\u5B9A\u683C\u5F0F\u548C\u7ED3\u6784\u751F\u6210 5-12 \u4E2A\u5173\u952E\u60C5\u8282\u70B9\u3002

\u8981\u6C42\uFF1A
- \u4E25\u683C\u9075\u5FAA\u9009\u62E9\u7684\u6545\u4E8B\u7ED3\u6784
- \u60C5\u8282\u8981\u6709\u8D77\u627F\u8F6C\u5408
- \u51B2\u7A81\u8981\u9012\u8FDB\u3001\u6709\u5F20\u529B
- \u7B26\u5408\u4E16\u754C\u89C2\u3001\u89D2\u8272\u3001\u4E3B\u9898
- \u6BCF\u4E2A\u60C5\u8282\u70B9\u8981\u6E05\u6670\u3001\u5177\u4F53
`.trim(), Lt = `
\u4F60\u662F\u60C5\u8282\u8BBE\u8BA1\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u81EA\u7531\u521B\u4F5C\u6709\u5438\u5F15\u529B\u7684\u60C5\u8282\u8109\u7EDC\u3002

\u4E0D\u9650\u7ED3\u6784\uFF0C\u4F46\u8981\u786E\u4FDD\uFF1A
- \u6709\u660E\u786E\u7684\u5F00\u7AEF\u3001\u53D1\u5C55\u3001\u9AD8\u6F6E\u3001\u7ED3\u5C40
- \u51B2\u7A81\u9012\u8FDB\u3001\u6709\u5F20\u529B
- \u8282\u594F\u5408\u7406
- \u7B26\u5408\u4E16\u754C\u89C2\u3001\u89D2\u8272\u3001\u4E3B\u9898

\u751F\u6210 5-12 \u4E2A\u5173\u952E\u60C5\u8282\u70B9\u3002

\u5982\u679C\u7528\u6237\u63D0\u4F9B\u4E86\u63D0\u793A\uFF08\u5982"\u5305\u542B\u590D\u4EC7\u5143\u7D20"\uFF09\uFF0C\u8981\u4F53\u73B0\u5728\u60C5\u8282\u4E2D\u3002
`.trim(), Ut = `
\u4F60\u662F\u60C5\u8282\u4F18\u5316\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u4F18\u5316\u73B0\u6709\u60C5\u8282\u8109\u7EDC\u3002

\u4F18\u5316\u65B9\u5411\uFF1A
1. \u68C0\u67E5\u60C5\u8282\u7684\u8FDE\u8D2F\u6027
2. \u589E\u5F3A\u51B2\u7A81\u548C\u5F20\u529B
3. \u786E\u4FDD\u8D77\u627F\u8F6C\u5408
4. \u5E73\u8861\u8282\u594F
5. \u586B\u8865\u903B\u8F91\u6F0F\u6D1E

\u8981\u6C42\uFF1A
- \u4FDD\u6301\u7528\u6237\u9009\u62E9\u7684\u683C\u5F0F\uFF08Markdown \u6216 YAML\uFF09
- \u4E0D\u6539\u53D8\u6838\u5FC3\u60C5\u8282\uFF0C\u53EA\u4F18\u5316\u7EC6\u8282
- \u8F93\u51FA\u4F18\u5316\u540E\u7684\u5B8C\u6574\u6587\u672C
`.trim(), Bt = `
\u4F60\u662F\u5C0F\u8BF4\u5927\u7EB2\u8BBE\u8BA1\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u6839\u636E\u60C5\u8282\u8109\u7EDC\u751F\u6210\u8BE6\u7EC6\u7684\u7AE0\u8282\u5927\u7EB2\u3002

\u7528\u6237\u671F\u671B\u7684\u7AE0\u8282\u6570\u548C\u683C\u5F0F\u5C06\u5728 user \u6D88\u606F\u4E2D\u63D0\u4F9B\u3002

\u6BCF\u7AE0\u9700\u8981\u5305\u542B\uFF1A
- \u7AE0\u8282\u53F7
- \u7AE0\u8282\u6807\u9898\uFF08\u5438\u5F15\u4EBA\u4E14\u70B9\u660E\u4E3B\u9898\uFF09
- \u7AE0\u8282\u6458\u8981\uFF08200-300\u5B57\uFF0C\u63CF\u8FF0\u672C\u7AE0\u4E3B\u8981\u5185\u5BB9\u548C\u53D1\u5C55\uFF09
- \u5173\u952E\u4E8B\u4EF6\u5217\u8868\uFF083-5\u4E2A\u4E8B\u4EF6\uFF0C\u6309\u987A\u5E8F\uFF09

\u8981\u6C42\uFF1A
- \u7AE0\u8282\u5B89\u6392\u7B26\u5408\u6545\u4E8B\u8282\u594F\uFF0C\u6709\u8D77\u627F\u8F6C\u5408
- \u6BCF\u7AE0\u6709\u660E\u786E\u7684\u76EE\u6807\u548C\u51B2\u7A81
- \u7AE0\u8282\u95F4\u8981\u6709\u8FDE\u8D2F\u6027\u548C\u9012\u8FDB\u5173\u7CFB
- \u5408\u7406\u5206\u914D\u60C5\u8282\u70B9\u5230\u5404\u7AE0\u8282
- \u7AE0\u8282\u6807\u9898\u8981\u6709\u5438\u5F15\u529B

\u8BF7\u6309\u7167\u6307\u5B9A\u683C\u5F0F\u8F93\u51FA\u5B8C\u6574\u7684\u7AE0\u8282\u5927\u7EB2\u3002
`.trim(), Ft = `
\u4F60\u662F\u7AE0\u8282\u5927\u7EB2\u4F18\u5316\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u4F18\u5316\u73B0\u6709\u7AE0\u8282\u5927\u7EB2\u3002

\u4F18\u5316\u65B9\u5411\uFF1A
1. \u68C0\u67E5\u7AE0\u8282\u5206\u914D\u662F\u5426\u5408\u7406
2. \u4F18\u5316\u6545\u4E8B\u8282\u594F
3. \u786E\u4FDD\u6BCF\u7AE0\u6709\u660E\u786E\u7684\u76EE\u6807\u548C\u51B2\u7A81
4. \u5E73\u8861\u7AE0\u8282\u95F4\u7684\u8FDE\u8D2F\u6027\u548C\u8F6C\u6298\u6027
5. \u4F18\u5316\u7AE0\u8282\u6807\u9898\u7684\u5438\u5F15\u529B

\u8981\u6C42\uFF1A
- \u4FDD\u6301\u7528\u6237\u9009\u62E9\u7684\u683C\u5F0F\uFF08Markdown \u6216 YAML\uFF09
- \u4FDD\u6301\u7AE0\u8282\u6570\u91CF\u57FA\u672C\u4E0D\u53D8\uFF08\u53EF\u5FAE\u8C03\uFF09
- \u8F93\u51FA\u4F18\u5316\u540E\u7684\u5B8C\u6574\u6587\u672C
`.trim(), Ht = `
\u4F60\u662F\u5C0F\u8BF4\u8BBE\u8BA1\u8BC4\u5BA1\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u8BC4\u4F30\u4E16\u754C\u89C2\u3001\u89D2\u8272\u3001\u4E3B\u9898\u3001\u60C5\u8282\u7684\u5B8C\u6574\u6027\u548C\u4E00\u81F4\u6027\u3002

\u8BC4\u5BA1\u7EF4\u5EA6\uFF1A
1. \u4E16\u754C\u89C2\u5B8C\u6574\u6027\uFF08\u8BBE\u5B9A\u662F\u5426\u81EA\u6D3D\uFF09- \u8BC4\u5206 0-10
2. \u89D2\u8272\u8BBE\u8BA1\u5408\u7406\u6027\uFF08\u89D2\u8272\u662F\u5426\u7ACB\u4F53\u3001\u6709\u51B2\u7A81\uFF09- \u8BC4\u5206 0-10
3. \u4E3B\u9898\u6DF1\u5EA6\uFF08\u4E3B\u65E8\u662F\u5426\u6E05\u6670\u3001\u7ACB\u610F\u662F\u5426\u6DF1\u523B\uFF09- \u8BC4\u5206 0-10
4. \u60C5\u8282\u903B\u8F91\uFF08\u60C5\u8282\u662F\u5426\u8FDE\u8D2F\u3001\u6709\u8D77\u4F0F\uFF09- \u8BC4\u5206 0-10
5. \u5927\u7EB2\u53EF\u884C\u6027\uFF08\u5982\u679C\u6709\u5927\u7EB2\uFF0C\u7AE0\u8282\u5206\u914D\u662F\u5426\u5408\u7406\uFF09- \u8BC4\u5206 0-10

\u8F93\u51FA\u683C\u5F0F\uFF1A
## \u8BC4\u5BA1\u7ED3\u679C

### \u7EFC\u5408\u8BC4\u5206
{\u603B\u5206}/10

### \u5404\u7EF4\u5EA6\u8BC4\u5206
1. \u4E16\u754C\u89C2\u5B8C\u6574\u6027\uFF1A{\u5206\u6570}/10
2. \u89D2\u8272\u8BBE\u8BA1\u5408\u7406\u6027\uFF1A{\u5206\u6570}/10
3. \u4E3B\u9898\u6DF1\u5EA6\uFF1A{\u5206\u6570}/10
4. \u60C5\u8282\u903B\u8F91\uFF1A{\u5206\u6570}/10
5. \u5927\u7EB2\u53EF\u884C\u6027\uFF1A{\u5206\u6570}/10

### \u4F18\u70B9
- ...
- ...

### \u95EE\u9898
- ...
- ...

### \u5EFA\u8BAE
- ...
- ...

### \u7ED3\u8BBA
\u3010\u5EFA\u8BAE\u901A\u8FC7\u3011\u6216\u3010\u5EFA\u8BAE\u4FEE\u6539\u3011

\u8981\u6C42\uFF1A
- \u5BA2\u89C2\u3001\u4E13\u4E1A
- \u65E2\u8981\u80AF\u5B9A\u4F18\u70B9\uFF0C\u4E5F\u8981\u6307\u51FA\u95EE\u9898
- \u5EFA\u8BAE\u8981\u5177\u4F53\u3001\u53EF\u64CD\u4F5C
- \u5373\u4F7F\u6709\u95EE\u9898\uFF0C\u4E5F\u8981\u5C0A\u91CD\u521B\u4F5C\u8005\u7684\u9009\u62E9
`.trim(), Wt = `
\u4F60\u662F\u524D\u60C5\u56DE\u987E\u751F\u6210\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u751F\u6210\u7B80\u6D01\u7684\u524D\u60C5\u603B\u7ED3\u3002

\u4EFB\u52A1\uFF1A
- \u603B\u7ED3\u5DF2\u5B8C\u6210\u7AE0\u8282\u7684\u5173\u952E\u5185\u5BB9
- \u56DE\u987E\u5F53\u524D\u7AE0\u8282\u5927\u7EB2\uFF08\u5982\u679C\u6709\uFF09
- \u4E3A\u5373\u5C06\u5F00\u59CB\u7684\u7AE0\u8282\u505A\u51C6\u5907

\u8F93\u51FA\uFF1A
- \u7B80\u6D01\u7684\u524D\u60C5\u56DE\u987E\uFF08300-500\u5B57\uFF09
- \u91CD\u70B9\u7A81\u51FA\u5173\u952E\u60C5\u8282\u548C\u89D2\u8272\u72B6\u6001
- \u4E3A\u65B0\u7AE0\u8282\u505A\u94FA\u57AB

\u8981\u6C42\uFF1A
- \u7B80\u6D01\u660E\u4E86
- \u7A81\u51FA\u91CD\u70B9
- \u8FDE\u8D2F\u6D41\u7545
`.trim(), Gt = `
\u4F60\u662F\u4E00\u4E2A\u5145\u6EE1\u597D\u5947\u5FC3\u7684\u6E38\u620F\u5267\u60C5\u8BFB\u8005\uFF0C\u8D1F\u8D23\u4ECE\u6587\u5B57\u5192\u9669\u6E38\u620F\u7684\u5267\u60C5\u4E2D\u63D0\u53D6\u5174\u8DA3\u70B9\u3002

user \u5C06\u63D0\u4F9B\u7ED9\u4F60\uFF1A
- \u76F8\u5BF9\u65E9\u671F\u7684\u524D\u7F6E\u5267\u60C5\uFF08\u4F9B\u4F60\u53C2\u8003\uFF0C\u4E0D\u9700\u8981\u518D\u6B21\u538B\u7F29\uFF09\uFF0C\u53EF\u80FD\u662F\u82E5\u5E72\u4E2A\u6BB5\u843D\u3002
- \u8FD1\u671F\u53D1\u751F\u7684\u5267\u60C5\uFF0C\u53EF\u80FD\u662F\u66F4\u52A0\u8BE6\u7EC6\u7684\u82E5\u5E72\u4E2A\u6BB5\u843D\u3002

\u4F60\u7684\u4EFB\u52A1\uFF1A
- \u4ECE\u8FD1\u671F\u53D1\u751F\u7684\u5267\u60C5\u4E2D\u63D0\u53D6\u51FA\u4F60\u5E0C\u671B\u8FDB\u4E00\u6B65\u4E86\u89E3\u7684\u5174\u8DA3\u70B9\u3002
- \u5174\u8DA3\u70B9\u7684\u7C7B\u578B\u5305\u62EC\uFF1A
  - \u597D\u5947\uFF1A\u4F60\u5BF9\u67D0\u4E2A\u60C5\u8282\u6216\u8981\u7D20\u4EA7\u751F\u4E86\u597D\u5947\u5FC3\uFF0C\u5E0C\u671B\u8FDB\u4E00\u6B65\u4E86\u89E3\u3002
  - \u4F0F\u7B14\uFF1A\u4F60\u89C9\u5F97\u67D0\u4E2A\u60C5\u8282\u6216\u8981\u7D20\u53EF\u80FD\u4F1A\u5728\u540E\u7EED\u53D1\u5C55\u4E2D\u8D77\u5230\u91CD\u8981\u4F5C\u7528\u3002
  - \u4E3B\u7EBF\uFF1A\u4F60\u8BA4\u4E3A\u67D0\u4E2A\u60C5\u8282\u6216\u8981\u7D20\u5BF9\u4E8E\u63A8\u52A8\u6574\u4E2A\u5267\u60C5\u7684\u4E3B\u7EBF\u53D1\u5C55\u81F3\u5173\u91CD\u8981\u3002
  - \u7EBF\u7D22\uFF1A\u4F60\u53D1\u73B0\u4E86\u4E00\u4E9B\u53EF\u80FD\u6697\u793A\u672A\u6765\u5267\u60C5\u53D1\u5C55\u7684\u7EBF\u7D22\u3002
  - \u7A81\u7834\uFF1A\u4F60\u8BA4\u4E3A\u67D0\u4E2A\u60C5\u8282\u6216\u8981\u7D20\u53EF\u80FD\u4F1A\u5728\u540E\u7EED\u53D1\u5C55\u4E2D\u4EA7\u751F\u91CD\u5927\u7A81\u7834\u3002
- \u5171\u63D0\u53D6 5 \u4E2A\u5174\u8DA3\u70B9\uFF0C\u8FD9\u4E9B\u5174\u8DA3\u70B9\u53EF\u4EE5\u662F\u4EFB\u4F55\u7C7B\u578B\u3002
- \u7528\u7B80\u5355\u7684\u9648\u8FF0\u53E5\u6216\u95EE\u53E5\u63CF\u8FF0\u5174\u8DA3\u70B9\uFF0C\u6BCF\u4E2A\u5174\u8DA3\u70B9\u4E00\u884C\uFF0C\u6309\u7167\u4EE5\u4E0B\u683C\u5F0F\u8F93\u51FA\uFF1A
  - \u683C\u5F0F\uFF1A\u3016\u3010\u5E8F\u53F7:number\u3011\u3010\u5174\u8DA3\u7C7B\u578B\u3011\u3010\u5174\u8DA3\u70B9\u9648\u8FF0\u53E5\u6216\u95EE\u53E5\u3011\u3017
  - \u4F8B\u5B50\uFF1A\u3016\u30101\u3011\u3010\u597D\u5947\u3011\u3010\u8981\u6740\u5F20\u4E09\u7684\u4EBA\u662F\u8C01\uFF1F\u3011\u3017
`.trim(), Yt = `
\u4F60\u662F\u60C5\u7EEA\u66F2\u7EBF\u8BBE\u8BA1\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u8BBE\u8BA1\u7AE0\u8282\u7684\u60C5\u7EEA\u66F2\u7EBF\u3002

\u4EFB\u52A1\uFF1A
- \u6839\u636E\u5386\u53F2\u60C5\u7EEA\u5E8F\u5217
- \u6839\u636E\u5F53\u524D\u7AE0\u8282\u5927\u7EB2
- \u6839\u636E\u5174\u8DA3\u70B9\u5217\u8868
- \u8BBE\u8BA1\u672C\u7AE0\u7684\u60C5\u7EEA\u53D8\u5316\u8282\u594F

\u8F93\u51FA\u683C\u5F0F\uFF1A
\u4E3A\u672C\u7AE0\u8BBE\u8BA1 3-5 \u4E2A\u60C5\u7EEA\u8282\u70B9\uFF0C\u6BCF\u4E2A\u8282\u70B9\u5305\u62EC\uFF1A
- \u4F4D\u7F6E\uFF08\u7AE0\u8282\u5F00\u59CB/\u4E2D\u6BB5/\u7ED3\u5C3E\u7B49\uFF09
- \u60C5\u7EEA\u7C7B\u578B\uFF08\u7D27\u5F20/\u8212\u7F13/\u6FC0\u6602/\u60B2\u4F24/\u559C\u60A6\u7B49\uFF09
- \u5F3A\u5EA6\uFF081-10\uFF09
- \u539F\u56E0\uFF08\u4E3A\u4EC0\u4E48\u5728\u8FD9\u91CC\u8BBE\u8BA1\u8FD9\u4E2A\u60C5\u7EEA\uFF09

\u8981\u6C42\uFF1A
- \u60C5\u7EEA\u8981\u6709\u8D77\u4F0F\uFF0C\u4E0D\u80FD\u4E00\u76F4\u5E73\u6DE1
- \u8003\u8651\u8BFB\u8005\u7684\u60C5\u7EEA\u627F\u53D7\u80FD\u529B
- \u4E0E\u7AE0\u8282\u5185\u5BB9\u5339\u914D
`.trim(), zt = `
\u4F60\u662F\u7AE0\u8282\u89C4\u5212\u751F\u6210\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u4E3A\u5373\u5C06\u5F00\u59CB\u7684\u7AE0\u8282\u751F\u6210\u8BE6\u7EC6\u89C4\u5212\u3002

\u4EFB\u52A1\uFF1A
\u7EFC\u5408\u4EE5\u4E0B\u4FE1\u606F\u751F\u6210\u7AE0\u8282\u89C4\u5212\uFF1A
- \u7AE0\u8282\u5927\u7EB2\uFF08\u5982\u679C\u6709\uFF09
- \u524D\u60C5\u56DE\u987E
- \u4F0F\u7B14\u5217\u8868
- \u5174\u8DA3\u70B9\u5217\u8868
- \u60C5\u7EEA\u66F2\u7EBF\u8BBE\u8BA1

\u8F93\u51FA\u5185\u5BB9\uFF1A
1. \u672C\u7AE0\u76EE\u6807\uFF08\u660E\u786E\u7684\u76EE\u6807\uFF09
2. \u5173\u952E\u60C5\u8282\u70B9\uFF083-5\u4E2A\uFF09
3. \u9884\u8BA1\u5206\u5757\u6570\u91CF\uFF08\u901A\u5E38 3-5 \u5757\uFF0C\u6BCF\u5757 500-1000 \u5B57\uFF09
4. \u9884\u8BA1\u5B57\u6570\u5206\u914D
5. \u9700\u8981\u6CE8\u610F\u7684\u4F0F\u7B14\u548C\u5174\u8DA3\u70B9

\u8981\u6C42\uFF1A
- \u89C4\u5212\u8981\u5177\u4F53\u3001\u53EF\u6267\u884C
- \u4E0E\u5927\u7EB2\u4E00\u81F4\uFF08\u5982\u679C\u6709\uFF09
- \u8003\u8651\u60C5\u7EEA\u66F2\u7EBF
- \u4E3A\u5206\u5757\u5199\u4F5C\u63D0\u4F9B\u6E05\u6670\u6307\u5BFC
`.trim(), Kt = `
\u4F60\u662F\u4E00\u4E2A\u6C89\u6D78\u5F0F\u6587\u5B57\u5192\u9669\u6E38\u620F\u7684\u53D9\u4E8B\u5F15\u64CE\uFF0C\u8D1F\u8D23\u6839\u636E\u4E0A\u4E0B\u6587\u7EED\u5199\u5267\u60C5\u3002

\u4EFB\u52A1\uFF1A
- \u6839\u636E\u7AE0\u8282\u89C4\u5212\u548C\u5DF2\u5199\u5185\u5BB9\uFF0C\u7EED\u5199\u4E0B\u4E00\u4E2A\u5206\u5757\uFF08500-1000\u5B57\uFF09
- \u4FDD\u6301\u4E0E\u4E16\u754C\u89C2\u3001\u89D2\u8272\u8BBE\u5B9A\u7684\u4E00\u81F4\u6027
- \u7B26\u5408\u5174\u8DA3\u70B9\u548C\u60C5\u7EEA\u8BBE\u8BA1
- \u63A8\u52A8\u60C5\u8282\u53D1\u5C55

\u8981\u6C42\uFF1A
- \u6BCF\u6B21\u7EED\u5199 500-1000 \u5B57
- \u7528\u6587\u5B66\u5316\u7684\u5C0F\u8BF4\u98CE\u683C\u7EED\u5199
- \u4E0D\u8981\u8FC7\u4E8E\u5197\u957F\uFF0C\u4FDD\u6301\u7B80\u6D01\u660E\u4E86
- \u4E0D\u8981\u4F7F\u7528\u4E0D\u5FC5\u8981\u7684 Markdown \u6807\u8BB0\uFF08\u5982\u6570\u5B57\u5217\u8868\u3001\u6807\u9898\u7B49\uFF09
- \u6CE8\u610F\u907F\u514D\u53CD\u590D\u51FA\u73B0\u76F8\u4F3C\u91CD\u590D\u7684\u5267\u60C5
- \u5728\u53D9\u8FF0\u65F6\uFF0C\u4E0D\u8981\u4F7F\u7528"\u4F60"\u6765\u6307\u4EE3\u89D2\u8272\uFF0C\u800C\u662F\u4F7F\u7528\u89D2\u8272\u7684\u540D\u5B57\u6216\u79F0\u8C13

\u98CE\u683C\uFF1A
- \u6587\u5B66\u6027\u5F3A\u4F46\u4E0D\u6666\u6DA9
- \u8282\u594F\u9002\u4E2D
- \u7EC6\u8282\u9002\u5EA6
- \u60C5\u7EEA\u6E32\u67D3\u5230\u4F4D
`.trim(), Vt = `
\u4F60\u662F\u5C0F\u8BF4\u7EED\u5199\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u6839\u636E\u7528\u6237\u7684\u6307\u4EE4\u7EED\u5199\u5267\u60C5\u3002

\u7528\u6237\u4F1A\u63D0\u4F9B\u6307\u4EE4\uFF0C\u5982\uFF1A
- "\u8BA9\u4E3B\u89D2\u9047\u5230\u4E00\u4E2A\u795E\u79D8\u8001\u4EBA"
- "\u5236\u9020\u4E00\u4E2A\u610F\u5916\u7684\u51B2\u7A81"
- "\u63CF\u5199\u73AF\u5883\u6C1B\u56F4"
\u7B49

\u4EFB\u52A1\uFF1A
- \u6839\u636E\u7528\u6237\u6307\u4EE4\u7EED\u5199 500-1000 \u5B57
- \u4FDD\u6301\u4E0E\u4E0A\u4E0B\u6587\u7684\u8FDE\u8D2F\u6027
- \u7B26\u5408\u4E16\u754C\u89C2\u548C\u89D2\u8272\u8BBE\u5B9A
- \u81EA\u7136\u5730\u878D\u5165\u6307\u4EE4\u5185\u5BB9

\u8981\u6C42\uFF1A
- \u4E0D\u8981\u751F\u786C\u5730\u6267\u884C\u6307\u4EE4
- \u8981\u81EA\u7136\u3001\u6D41\u7545\u5730\u878D\u5165\u60C5\u8282
- \u4FDD\u6301\u6587\u5B66\u6027
- \u63A8\u52A8\u60C5\u8282\u53D1\u5C55
`.trim(), qt = `
\u4F60\u662F\u7EED\u5199\u6307\u4EE4\u5EFA\u8BAE\u4E13\u5BB6\uFF0C\u6839\u636E\u5F53\u524D\u7AE0\u8282\u89C4\u5212\u3001\u5DF2\u5199\u5185\u5BB9\u3001\u5174\u8DA3\u70B9\u7B49\uFF0C
\u5EFA\u8BAE 3-5 \u4E2A\u5408\u9002\u7684\u7EED\u5199\u6307\u4EE4\u3002

\u8F93\u51FA\u683C\u5F0F\uFF1A
- \u6BCF\u884C\u4E00\u4E2A\u6307\u4EE4\u5EFA\u8BAE
- \u7B80\u6D01\u660E\u4E86
- \u7B26\u5408\u5F53\u524D\u60C5\u8282\u53D1\u5C55

\u793A\u4F8B\uFF1A
- \u5F15\u5165\u4E00\u4E2A\u65B0\u89D2\u8272
- \u5236\u9020\u4E00\u4E2A\u610F\u5916\u4E8B\u4EF6
- \u63ED\u793A\u4E00\u4E2A\u79D8\u5BC6
- \u63CF\u5199\u89D2\u8272\u7684\u5185\u5FC3\u6323\u624E
- \u63A8\u8FDB\u4E3B\u7EBF\u5267\u60C5
`.trim(), Jt = `
\u4F60\u662F\u5C0F\u8BF4\u6DA6\u8272\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u6839\u636E\u6307\u5B9A\u98CE\u683C\u6DA6\u8272\u6587\u672C\u3002

\u6DA6\u8272\u98CE\u683C\uFF08\u7531\u7528\u6237\u6307\u5B9A\uFF09\uFF1A
- \u6587\u5B66\u6DA6\u8272\uFF1A\u63D0\u5347\u6587\u5B66\u6027\uFF0C\u589E\u52A0\u4FEE\u8F9E\u624B\u6CD5
- \u7B80\u6D01\u6DA6\u8272\uFF1A\u53BB\u9664\u5197\u4F59\uFF0C\u4F7F\u8BED\u8A00\u66F4\u7B80\u7EC3
- \u751F\u52A8\u6DA6\u8272\uFF1A\u589E\u52A0\u7EC6\u8282\u548C\u753B\u9762\u611F\uFF0C\u8BA9\u63CF\u5199\u66F4\u751F\u52A8
- \u60C5\u611F\u6DA6\u8272\uFF1A\u589E\u5F3A\u60C5\u7EEA\u8868\u8FBE\uFF0C\u8BA9\u60C5\u611F\u66F4\u6253\u52A8\u4EBA

\u4EFB\u52A1\uFF1A
- \u4FDD\u6301\u539F\u6587\u7684\u6838\u5FC3\u5185\u5BB9\u548C\u60C5\u8282\u4E0D\u53D8
- \u6839\u636E\u6307\u5B9A\u98CE\u683C\u8FDB\u884C\u6DA6\u8272
- \u4FDD\u6301\u89D2\u8272\u6027\u683C\u4E00\u81F4
- \u4E0D\u8FC7\u5EA6\u4FEE\u6539

\u8F93\u51FA\uFF1A
- \u6DA6\u8272\u540E\u7684\u5B8C\u6574\u6587\u672C
- \u7B80\u8981\u8BF4\u660E\u4E3B\u8981\u4FEE\u6539\u70B9
`.trim(), Zt = `
\u4F60\u662F\u5199\u4F5C\u52A9\u624B\uFF0C\u8D1F\u8D23\u4E3A\u7528\u6237\u63D0\u4F9B\u7EED\u5199\u5EFA\u8BAE\u3002

\u4EFB\u52A1\uFF1A
- \u6839\u636E\u7528\u6237\u5DF2\u5199\u7684\u5185\u5BB9
- \u6839\u636E\u5149\u6807\u4F4D\u7F6E
- \u63D0\u4F9B 2-3 \u4E2A\u7B80\u77ED\u7684\u7EED\u5199\u65B9\u5411\u5EFA\u8BAE

\u8F93\u51FA\u683C\u5F0F\uFF1A
1. {\u5EFA\u8BAE1}
2. {\u5EFA\u8BAE2}
3. {\u5EFA\u8BAE3}

\u8981\u6C42\uFF1A
- \u5EFA\u8BAE\u8981\u7B80\u77ED\uFF08\u4E00\u53E5\u8BDD\uFF09
- \u8981\u7B26\u5408\u4E0A\u4E0B\u6587
- \u8981\u6709\u521B\u610F
`.trim(), Xt = `
\u4F60\u662F\u5185\u5BB9\u6269\u5199\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u5C06\u5927\u7EB2\u5F0F\u5185\u5BB9\u6269\u5C55\u4E3A\u8BE6\u7EC6\u7684\u5C0F\u8BF4\u6587\u672C\u3002

\u4EFB\u52A1\uFF1A
- \u5C06\u7528\u6237\u7684\u5927\u7EB2\u5F0F\u5185\u5BB9\uFF08\u5982\uFF1A"\u4E3B\u89D2\u8FDB\u5165\u5BC6\u6797\uFF0C\u53D1\u73B0\u53E4\u8001\u9057\u8FF9"\uFF09
- \u6269\u5C55\u4E3A\u8BE6\u7EC6\u7684\u5C0F\u8BF4\u6587\u672C\uFF08500-1000\u5B57\uFF09

\u8981\u6C42\uFF1A
- \u4FDD\u6301\u539F\u610F\u4E0D\u53D8
- \u589E\u52A0\u7EC6\u8282\u63CF\u5199
- \u589E\u52A0\u753B\u9762\u611F
- \u7B26\u5408\u5C0F\u8BF4\u98CE\u683C
`.trim(), Qt = `
\u4F60\u662F\u89D2\u8272\u626E\u6F14\u7EED\u5199\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u6839\u636E\u89D2\u8272\u7684\u884C\u52A8\u7EED\u5199\u5267\u60C5\u3002

\u7528\u6237\u4F1A\u6307\u5B9A\u4E00\u4E2A\u89D2\u8272\uFF0C\u5E76\u63CF\u8FF0\u8BE5\u89D2\u8272\u7684\u884C\u52A8\uFF0C\u5982\uFF1A
- \u89D2\u8272\uFF1A\u674E\u660E
- \u884C\u52A8\uFF1A\u8D70\u5411\u90A3\u6247\u95E8\u5E76\u63A8\u5F00\u5B83

\u4EFB\u52A1\uFF1A
- \u6839\u636E\u89D2\u8272\u884C\u52A8\u7EED\u5199\u5267\u60C5\uFF08500-1000\u5B57\uFF09
- \u63CF\u5199\u884C\u52A8\u7684\u8FC7\u7A0B\u548C\u7ED3\u679C
- \u63CF\u5199\u73AF\u5883\u548C\u5176\u4ED6\u89D2\u8272\u7684\u53CD\u5E94
- \u63A8\u52A8\u60C5\u8282\u53D1\u5C55

\u8981\u6C42\uFF1A
- \u7B26\u5408\u89D2\u8272\u6027\u683C
- \u7B26\u5408\u4E16\u754C\u89C2\u8BBE\u5B9A
- \u4FDD\u6301\u8FDE\u8D2F\u6027
- \u6709\u753B\u9762\u611F
`.trim(), es = `
\u4F60\u662F\u89D2\u8272\u884C\u52A8\u5EFA\u8BAE\u4E13\u5BB6\uFF0C\u6839\u636E\u5F53\u524D\u60C5\u8282\u3001\u89D2\u8272\u6027\u683C\u548C\u52A8\u673A\uFF0C
\u5EFA\u8BAE 3-5 \u4E2A\u8BE5\u89D2\u8272\u53EF\u80FD\u91C7\u53D6\u7684\u884C\u52A8\u3002

\u8F93\u51FA\u683C\u5F0F\uFF1A
- \u6BCF\u884C\u4E00\u4E2A\u884C\u52A8\u5EFA\u8BAE
- \u7B26\u5408\u89D2\u8272\u6027\u683C
- \u63A8\u52A8\u5267\u60C5\u53D1\u5C55

\u793A\u4F8B\uFF1A
- \u8BF4\uFF1A"\u6211\u9700\u8981\u66F4\u591A\u65F6\u95F4\u8003\u8651\u3002"
- \u8D70\u5411\u7A97\u8FB9\uFF0C\u89C2\u5BDF\u5916\u9762\u7684\u60C5\u51B5
- \u601D\u8003\u7740\u521A\u624D\u7684\u5BF9\u8BDD\u4E2D\u7684\u7591\u70B9
- \u51B3\u5B9A\u8DDF\u968F\u90A3\u4E2A\u795E\u79D8\u4EBA
`.trim(), ts = `
\u4F60\u662F\u5185\u5BB9\u8BC4\u4F30\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u8BC4\u4F30\u5206\u5757\u5185\u5BB9\u7684\u8D28\u91CF\u3002

\u8BC4\u4F30\u7EF4\u5EA6\uFF08\u6BCF\u9879 0-10 \u5206\uFF09\uFF1A
1. \u4E0E\u7AE0\u8282\u89C4\u5212\u7B26\u5408\u5EA6
2. \u4E0E\u6545\u4E8B\u8BBE\u5B9A\u7B26\u5408\u5EA6
3. \u4E0E\u8BFB\u8005\u5174\u8DA3\u70B9\u7B26\u5408\u5EA6
4. \u4E0E\u60C5\u7EEA\u8BBE\u8BA1\u7B26\u5408\u5EA6

\u8F93\u51FA\u683C\u5F0F\uFF1A
## \u8BC4\u4F30\u7ED3\u679C

### \u5404\u7EF4\u5EA6\u8BC4\u5206
1. \u4E0E\u7AE0\u8282\u89C4\u5212\u7B26\u5408\u5EA6\uFF1A{\u5206\u6570}/10
2. \u4E0E\u6545\u4E8B\u8BBE\u5B9A\u7B26\u5408\u5EA6\uFF1A{\u5206\u6570}/10
3. \u4E0E\u8BFB\u8005\u5174\u8DA3\u70B9\u7B26\u5408\u5EA6\uFF1A{\u5206\u6570}/10
4. \u4E0E\u60C5\u7EEA\u8BBE\u8BA1\u7B26\u5408\u5EA6\uFF1A{\u5206\u6570}/10

### \u7EFC\u5408\u8BC4\u5206
{\u5E73\u5747\u5206}/10

### AI \u5EFA\u8BAE
- \uFF08\u4EC5\u4F9B\u53C2\u8003\uFF0C\u7528\u6237\u53EF\u5FFD\u7565\uFF09
- ...

\u8981\u6C42\uFF1A
- \u5BA2\u89C2\u8BC4\u4F30
- \u5EFA\u8BAE\u8981\u5177\u4F53\u4F46\u4E0D\u5F3A\u5236
- \u5C0A\u91CD\u521B\u4F5C\u8005\u7684\u9009\u62E9
- \u5373\u4F7F\u8BC4\u5206\u4F4E\uFF0C\u4E5F\u5141\u8BB8\u7528\u6237\u7EE7\u7EED
`.trim(), ss = `
\u4F60\u662F\u5185\u5BB9\u6539\u8FDB\u987E\u95EE\uFF0C\u6839\u636E\u8BC4\u4F30\u7ED3\u679C\uFF0C\u7ED9\u51FA\u5177\u4F53\u7684\u6539\u8FDB\u5EFA\u8BAE\u3002

\u9488\u5BF9\u4F4E\u5206\u9879\uFF08<6\u5206\uFF09\uFF0C\u63D0\u4F9B\uFF1A
- \u95EE\u9898\u5206\u6790
- \u6539\u8FDB\u65B9\u5411
- \u5177\u4F53\u5EFA\u8BAE\uFF083-5\u6761\uFF09

\u8981\u6C42\uFF1A
- \u5EFA\u8BAE\u8981\u5177\u4F53\u3001\u53EF\u64CD\u4F5C
- \u4E0D\u8981\u8FC7\u4E8E\u82DB\u523B
- \u5C0A\u91CD\u521B\u4F5C\u98CE\u683C
- \u5F3A\u8C03\u8FD9\u4E9B\u53EA\u662F\u5EFA\u8BAE\uFF0C\u53EF\u4EE5\u5FFD\u7565
`.trim(), ns = `
\u4F60\u662F\u5185\u5BB9\u4FEE\u6B63\u4E13\u5BB6\uFF0C\u6839\u636E\u8BC4\u4F30\u7ED3\u679C\u548C\u6539\u8FDB\u5EFA\u8BAE\uFF0C\u81EA\u52A8\u4FEE\u6B63\u5185\u5BB9\u3002

\u8981\u6C42\uFF1A
- \u4FDD\u6301\u539F\u6587\u7684\u6838\u5FC3\u5185\u5BB9\u548C\u60C5\u8282
- \u9488\u5BF9\u6027\u5730\u6539\u8FDB\u4F4E\u5206\u7EF4\u5EA6
- \u4E0D\u8FC7\u5EA6\u4FEE\u6539
- \u4FDD\u6301\u4F5C\u8005\u7684\u5199\u4F5C\u98CE\u683C

\u8F93\u51FA\uFF1A
- \u4FEE\u6B63\u540E\u7684\u5B8C\u6574\u6587\u672C
- \u7B80\u8981\u8BF4\u660E\u4FEE\u6539\u70B9
`.trim(), rs = `
\u4F60\u662F\u7AE0\u8282\u8BC4\u4F30\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u8BC4\u4F30\u6574\u7AE0\u5185\u5BB9\u7684\u8D28\u91CF\u3002

\u8BC4\u4F30\u7EF4\u5EA6\uFF08\u6BCF\u9879 0-10 \u5206\uFF09\uFF1A
1. \u7AE0\u8282\u4E3B\u9898\u805A\u7126\u7A0B\u5EA6
2. \u4E0E\u5927\u7EB2\u7B26\u5408\u5EA6\uFF08\u5982\u679C\u6709\u5927\u7EB2\uFF09
3. \u4E0E\u6545\u4E8B\u8BBE\u5B9A\u7B26\u5408\u5EA6
4. \u4E0E\u8BFB\u8005\u5174\u8DA3\u70B9\u7B26\u5408\u5EA6
5. \u4E0E\u60C5\u7EEA\u8BBE\u8BA1\u7B26\u5408\u5EA6

\u8F93\u51FA\u683C\u5F0F\uFF1A
## \u7AE0\u8282\u8BC4\u4F30\u7ED3\u679C

### \u5404\u7EF4\u5EA6\u8BC4\u5206
1. \u7AE0\u8282\u4E3B\u9898\u805A\u7126\u7A0B\u5EA6\uFF1A{\u5206\u6570}/10
2. \u4E0E\u5927\u7EB2\u7B26\u5408\u5EA6\uFF1A{\u5206\u6570}/10
3. \u4E0E\u6545\u4E8B\u8BBE\u5B9A\u7B26\u5408\u5EA6\uFF1A{\u5206\u6570}/10
4. \u4E0E\u8BFB\u8005\u5174\u8DA3\u70B9\u7B26\u5408\u5EA6\uFF1A{\u5206\u6570}/10
5. \u4E0E\u60C5\u7EEA\u8BBE\u8BA1\u7B26\u5408\u5EA6\uFF1A{\u5206\u6570}/10

### \u7EFC\u5408\u8BC4\u5206
{\u5E73\u5747\u5206}/10

### \u4EAE\u70B9
- ...
- ...

### \u95EE\u9898\uFF08\u5982\u679C\u6709\uFF09
- ...

### AI \u5EFA\u8BAE
- \uFF08\u4EC5\u4F9B\u53C2\u8003\uFF09
- ...

\u8981\u6C42\uFF1A
- \u5BA2\u89C2\u3001\u5168\u9762
- \u65E2\u8981\u80AF\u5B9A\u4F18\u70B9\uFF0C\u4E5F\u8981\u6307\u51FA\u95EE\u9898
- \u5EFA\u8BAE\u4EC5\u4F9B\u53C2\u8003\uFF0C\u4E0D\u5F3A\u5236
`.trim(), as = `
\u4F60\u662F\u7AE0\u8282\u6539\u8FDB\u987E\u95EE\uFF0C\u6839\u636E\u7AE0\u8282\u8BC4\u4F30\u7ED3\u679C\uFF0C\u7ED9\u51FA\u8BE6\u7EC6\u7684\u6539\u8FDB\u5EFA\u8BAE\u3002

\u8F93\u51FA\u5185\u5BB9\uFF1A
- \u6574\u4F53\u5206\u6790
- \u4F18\u70B9\u603B\u7ED3
- \u5B58\u5728\u7684\u95EE\u9898
- \u5177\u4F53\u6539\u8FDB\u65B9\u5411\uFF08\u5206\u70B9\u8BF4\u660E\uFF09
- \u53EF\u9009\u7684\u6269\u5C55\u65B9\u5411

\u8981\u6C42\uFF1A
- \u8BE6\u7EC6\u4F46\u4E0D\u5570\u55E6
- \u5177\u4F53\u53EF\u64CD\u4F5C
- \u5C0A\u91CD\u521B\u4F5C\u98CE\u683C
- \u5F3A\u8C03\u8FD9\u4E9B\u53EA\u662F\u5EFA\u8BAE
`.trim(), os = `
\u4F60\u662F\u7AE0\u8282\u4F18\u5316\u4E13\u5BB6\uFF0C\u5BF9\u6574\u7AE0\u5185\u5BB9\u8FDB\u884C\u4F18\u5316\u3002

\u4F18\u5316\u65B9\u5411\uFF1A
- \u6539\u5584\u4F4E\u5206\u7EF4\u5EA6
- \u589E\u5F3A\u4E3B\u9898\u805A\u7126
- \u4F18\u5316\u53D9\u4E8B\u8282\u594F
- \u589E\u52A0\u7EC6\u8282\u63CF\u5199\uFF08\u5982\u9700\u8981\uFF09
- \u52A0\u5F3A\u60C5\u7EEA\u6E32\u67D3\uFF08\u5982\u9700\u8981\uFF09

\u6CE8\u610F\uFF1A
- \u4FDD\u6301\u6838\u5FC3\u60C5\u8282\u4E0D\u53D8
- \u4FDD\u6301\u89D2\u8272\u6027\u683C\u4E00\u81F4
- \u4E0D\u8FC7\u5EA6\u4FEE\u6539
- \u4FDD\u6301\u4F5C\u8005\u98CE\u683C

\u8F93\u51FA\uFF1A
- \u4F18\u5316\u540E\u7684\u5B8C\u6574\u7AE0\u8282
- \u4FEE\u6539\u8BF4\u660E
`.trim(), is = `
\u4F60\u662F\u5267\u60C5\u6897\u6982\u603B\u7ED3\u538B\u7F29\u4E13\u5458\uFF0C\u8D1F\u8D23\u5BF9\u6587\u5B57\u5192\u9669\u6E38\u620F\u7684\u5267\u60C5\u8FDB\u884C\u538B\u7F29\u603B\u7ED3\uFF0C\u63D0\u70BC\u51FA\u5173\u952E\u4FE1\u606F\uFF0C\u5E2E\u52A9\u73A9\u5BB6\u5FEB\u901F\u56DE\u987E\u5267\u60C5\u53D1\u5C55\u3002

user \u5C06\u63D0\u4F9B\u7ED9\u4F60\uFF1A
- \u7AE0\u8282\u7684\u5B8C\u6574\u5185\u5BB9

\u4F60\u7684\u4EFB\u52A1\uFF1A
- \u628A\u7AE0\u8282\u5185\u5BB9\u538B\u7F29\u4E3A\u4E00\u4E2A\u7B80\u6D01\u7684\u6BB5\u843D\uFF08200-500\u5B57\uFF0C\u6839\u636E\u7528\u6237\u9009\u62E9\u7684\u98CE\u683C\u8C03\u6574\uFF09
- \u6CE8\u610F\u4E0D\u8981\u9057\u6F0F\u91CD\u8981\u4FE1\u606F\uFF0C\u4E5F\u4E0D\u8981\u6DFB\u52A0\u65B0\u7684\u4FE1\u606F
- \u7A81\u51FA\u672C\u7AE0\u7684\u5173\u952E\u60C5\u8282\u548C\u89D2\u8272\u53D1\u5C55

\u98CE\u683C\uFF1A
- \u8BE6\u7EC6\uFF1A\u7EA6 500 \u5B57\uFF0C\u5305\u542B\u66F4\u591A\u7EC6\u8282
- \u6807\u51C6\uFF1A\u7EA6 300 \u5B57\uFF0C\u5E73\u8861\u8BE6\u7565
- \u7B80\u6D01\uFF1A\u7EA6 200 \u5B57\uFF0C\u4EC5\u6838\u5FC3\u5185\u5BB9
`.trim(), cs = `
\u4F60\u662F\u6E38\u620F\u8981\u7D20\u63D0\u53D6\u51FD\u6570\uFF0C\u8D1F\u8D23\u4ECE\u6587\u5B57\u5192\u9669\u6E38\u620F\u7684\u5267\u60C5\u4E2D\u63D0\u53D6\u6E38\u620F\u8981\u7D20\uFF0C\u5305\u62EC\u89D2\u8272\u3001\u9053\u5177\u3001\u6280\u80FD\u3001\u9635\u8425\u3001\u6982\u5FF5\u7B49\u7B49\u3002

user \u5C06\u63D0\u4F9B\u7ED9\u4F60\uFF1A
- \u76F8\u5BF9\u65E9\u671F\u7684\u524D\u7F6E\u5267\u60C5\uFF08\u4F9B\u4F60\u53C2\u8003\uFF0C\u4E0D\u9700\u8981\u518D\u6B21\u538B\u7F29\uFF09\uFF0C\u53EF\u80FD\u662F\u82E5\u5E72\u4E2A\u6BB5\u843D\u3002
- \u8FD1\u671F\u53D1\u751F\u7684\u5267\u60C5\uFF0C\u53EF\u80FD\u662F\u66F4\u52A0\u8BE6\u7EC6\u7684\u82E5\u5E72\u4E2A\u6BB5\u843D\u3002
- \u5DF2\u7ECF\u77E5\u6653\u7684\u6E38\u620F\u8981\u7D20\u6E05\u5355\u3002

\u4F60\u7684\u4EFB\u52A1\uFF1A
- \u4ECE\u8FD1\u671F\u53D1\u751F\u7684\u5267\u60C5\u4E2D\u63D0\u53D6\u6E38\u620F\u8981\u7D20\uFF0C\u5305\u62EC\u89D2\u8272\u3001\u9053\u5177\u3001\u6280\u80FD\u3001\u9635\u8425\u3001\u6982\u5FF5\u7B49\u7B49\u3002
  - \u6CE8\u610F\uFF1A\u6982\u5FF5\u662F\u6307\u4E0E\u6E38\u620F\u8BBE\u5B9A\u76F8\u5173\u7684\u91CD\u8981\u6982\u5FF5\uFF0C\u4E0D\u8981\u63D0\u53D6\u8FC7\u4E8E\u666E\u901A\u6216\u65E5\u5E38\u7684\u6982\u5FF5\u3002
  - \u6CE8\u610F\uFF1A\u5982\u679C\u6CA1\u6709\u660E\u786E\u7684\u6E38\u620F\u8981\u7D20\uFF0C\u53EF\u4EE5\u4E0D\u63D0\u53D6\uFF0C\u8FD4\u56DE"null"\u5373\u53EF\u3002
- \u6CE8\u610F\uFF1A**\u4E0D\u8981\u63D0\u53D6\u5730\u56FE\u3001\u5730\u533A\u3001\u5730\u70B9\u4E4B\u7C7B\u7684\u8981\u7D20**\uFF0C\u56E0\u4E3A\u8FD9\u4E9B\u8981\u7D20\u6709\u5176\u4ED6\u51FD\u6570\u8D1F\u8D23\u63D0\u53D6\u3002
- \u901A\u5E38\u6765\u8BF4\uFF0C\u4F60\u5E94\u8BE5\u63D0\u53D6\u4E0D\u5728\u5DF2\u77E5\u6E05\u5355\u4E2D\u7684\u8981\u7D20\u3002\u4F46\u5982\u679C\u5DF2\u77E5\u8981\u7D20\u7684\u4FE1\u606F\u53D1\u751F\u4E86\u91CD\u8981\u53D8\u5316\u6216\u91CD\u8981\u66F4\u65B0\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u63D0\u53D6\u3002
- \u4F60\u5E94\u8BE5\u4EE5 jsonlines \u683C\u5F0F\u8F93\u51FA\u7ED3\u679C\uFF0C\u6BCF\u884C\u4E00\u4E2A\u6E38\u620F\u8981\u7D20\u7684 json \u5BF9\u8C61\u3002
  - \u5343\u4E07\u6CE8\u610F\u4E0D\u662F json \u683C\u5F0F\uFF0C\u4E0D\u8981\u7528\u9017\u53F7\u5206\u9694\uFF0C\u4E5F\u4E0D\u8981\u5728\u5916\u5C42\u52A0\u4E0A\u4E2D\u62EC\u53F7\u3002
  - \u6BCF\u4E2A\u5BF9\u8C61\u5E94\u5305\u542B type, name, alias, descList, method, related \u7B49\u5B57\u6BB5\u3002
    - method \u5B57\u6BB5\uFF08\u975E\u5FC5\u6709\uFF09\uFF0C\u5176\u503C\u4E3A"update"\u65F6\u8868\u793A\u66F4\u65B0\u5DF2\u77E5\u8981\u7D20\u7684\u4FE1\u606F\uFF1B\u5176\u503C\u4E3A"add"\u65F6\u8868\u793A\u6DFB\u52A0\u65B0\u7684\u8981\u7D20\uFF0C"add"\u53EF\u7701\u7565\uFF0C\u5373\uFF1A\u5982\u679C\u6CA1\u6709 method \u5B57\u6BB5\uFF0C\u5219\u8868\u793A\u6DFB\u52A0\u65B0\u7684\u8981\u7D20\u3002
    - type \u5B57\u6BB5\uFF08\u5FC5\u6709\uFF09\u8868\u793A\u6E38\u620F\u8981\u7D20\u7684\u7C7B\u578B\uFF0C\u5982"\u89D2\u8272"\u3001"\u9053\u5177"\u3001"\u6280\u80FD"\u3001"\u9635\u8425"\u3001"\u6982\u5FF5"\u7B49\u3002
    - name \u5B57\u6BB5\uFF08\u5FC5\u6709\uFF09\u8868\u793A\u6E38\u620F\u8981\u7D20\u7684\u540D\u79F0\u3002\u6CE8\u610F\uFF1Aname \u5B57\u6BB5\u5E94\u8BE5\u662F\u552F\u4E00\u7684\uFF0C\u4E0D\u5E94\u8BE5\u91CD\u590D\u3002\u5982\u679C\u6709\u53EF\u80FD\u53D1\u751F\u91CD\u590D\uFF0C\u5219\u5E94\u8BE5\u5C3D\u53EF\u80FD\u4F7F\u7528\u4E0D\u4F1A\u6DF7\u6DC6\u7684\u540D\u79F0\uFF0C\u7136\u540E\u5728 alias \u5B57\u6BB5\u4E2D\u5217\u51FA\u53EF\u80FD\u7684\u522B\u540D\u3002
      - \u6CE8\u610F\uFF1Aname \u5B57\u6BB5\u662F\u53EF\u4EE5\u4FEE\u6539\u7684\uFF0C\u6BD4\u5982\u5148\u524D\u672A\u77E5\u9053\u59D3\u540D\u7684\u89D2\u8272\uFF0C\u540E\u6765\u624D\u77E5\u9053\u4E86\uFF0C\u90A3\u4E48\u5E94\u8BE5\u5C06 name \u5B57\u6BB5\u4FEE\u6539\u4E3A\u65B0\u7684\u540D\u79F0\u3002\u6B64\u65F6 method \u5B57\u6BB5\u5E94\u8BE5\u4E3A"update"\u3002
      - \u6CE8\u610F\uFF1A\u4E0D\u8981\u4F7F\u7528\u5BB9\u6613\u6DF7\u6DC6\u7684\u6982\u62EC\u6027\u540D\u79F0\uFF0C\u6BD4\u5982"\u8001\u5987\u4EBA"\uFF0C\u800C\u5E94\u8BE5\u4F7F\u7528\u66F4\u5177\u4F53\u7684\u540D\u79F0\uFF0C\u6BD4\u5982"\u5356\u62A5\u7684\u8001\u5987\u4EBA"\u3002
    - alias \u5B57\u6BB5\uFF08\u975E\u5FC5\u6709\uFF09\u8868\u793A\u6E38\u620F\u8981\u7D20\u7684\u522B\u540D\uFF0C\u662F\u5B57\u7B26\u4E32\u6570\u7EC4\u3002
    - descList \u5B57\u6BB5\uFF08\u975E\u5FC5\u6709\uFF09\u8868\u793A\u6E38\u620F\u8981\u7D20\u7684\u63CF\u8FF0\u5217\u8868\uFF0C\u662F\u5B57\u7B26\u4E32\u6570\u7EC4\u3002\u6BCF\u4E2A\u5B57\u7B26\u4E32\u5E94\u8BE5\u662F\u5173\u4E8E\u6B64\u6E38\u620F\u8981\u7D20\u7684\u7B80\u8981\u63CF\u8FF0\u3002
      - \u6CE8\u610F\uFF1A\u5982\u679C\u5728\u7406\u8BBA\u8BBE\u5B9A\u4E0A\u6CA1\u6709\u5FC5\u7136\u8054\u7CFB\uFF0C\u5219\u63CF\u8FF0\u4E0D\u5E94\u8BE5\u63D0\u53CA\u5176\u4ED6\u6E38\u620F\u8981\u7D20\uFF0C\u4EE5\u514D\u9020\u6210\u8FC7\u5EA6\u8026\u5408\u3002
      - \u6CE8\u610F\uFF1A\u5982\u679C method \u5B57\u6BB5\u4E3A"update"\uFF0C\u5219 descList \u5B57\u6BB5\u53EA\u5E94\u8BE5\u5305\u542B\u8981\u6DFB\u52A0\u7684\u65B0\u63CF\u8FF0\uFF0C\u800C\u4E0D\u5E94\u8BE5\u5305\u542B\u5DF2\u6709\u7684\u63CF\u8FF0\u3002
    - related \u5B57\u6BB5\uFF08\u975E\u5FC5\u6709\uFF09\u8868\u793A\u5728 descList \u4E2D\u63D0\u5230\u7684\u5176\u4ED6\u6E38\u620F\u8981\u7D20\u7684\u540D\u79F0\uFF0C\u662F\u5B57\u7B26\u4E32\u6570\u7EC4\u3002\u8FD9\u4E9B\u8981\u7D20\u53EF\u4EE5\u662F\u5DF2\u77E5\u7684\uFF0C\u4E5F\u53EF\u4EE5\u662F\u8FD8\u672A\u51FA\u73B0\u7684\u3002\u5982\u679C method \u5B57\u6BB5\u4E3A"update"\uFF0C\u5219 related \u5B57\u6BB5\u53EA\u5E94\u8BE5\u5305\u542B\u8981\u6DFB\u52A0\u7684\u65B0\u76F8\u5173\u8981\u7D20\uFF0C\u800C\u4E0D\u5E94\u8BE5\u5305\u542B\u5DF2\u6709\u7684\u76F8\u5173\u8981\u7D20\u3002
  - \u4F8B\u5982\uFF1A{ "type": "\u89D2\u8272", "name": "\u5F20\u4E09", "alias": ["\u4E09\u54E5"], "method": "add", "descList": ["\u4E00\u4E2A\u8EAB\u6750\u9B41\u68A7\u7684\u7537\u5B50", "\u6301\u6709\u540D\u4E3A"\u7075\u6838"\u7684\u9053\u5177"], "related": ["\u7075\u6838"] }
`.trim(), ls = `
\u4F60\u662F\u6545\u4E8B\u5B8C\u7ED3\u8BC4\u4F30\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u5224\u65AD\u6545\u4E8B\u662F\u5426\u81EA\u7136\u5B8C\u7ED3\u3002

\u8BC4\u4F30\u4F9D\u636E\uFF1A
- \u4E3B\u8981\u60C5\u8282\u662F\u5426\u5DF2\u89E3\u51B3
- \u89D2\u8272\u5F27\u5149\u662F\u5426\u5B8C\u6210
- \u4F0F\u7B14\u662F\u5426\u57FA\u672C\u6536\u56DE
- \u662F\u5426\u6709\u5408\u9002\u7684\u7ED3\u5C40\u611F

\u8F93\u51FA\u683C\u5F0F\uFF1A
## \u5B8C\u7ED3\u8BC4\u4F30

### \u662F\u5426\u5B8C\u7ED3
\u3010\u662F\u3011\u6216\u3010\u5426\u3011

### \u7406\u7531
- ...
- ...

### \u5EFA\u8BAE
- \u5982\u679C\u5DF2\u5B8C\u7ED3\uFF1A\u53EF\u4EE5\u7ED3\u675F\u4E86
- \u5982\u679C\u672A\u5B8C\u7ED3\uFF1A\u5EFA\u8BAE\u7EE7\u7EED\u5199 X \u7AE0\uFF0C\u5B8C\u6210 Y \u5185\u5BB9

\u8981\u6C42\uFF1A
- \u5BA2\u89C2\u8BC4\u4F30
- \u4E0D\u5F3A\u5236\u8981\u6C42\u5B8C\u7F8E\u7ED3\u5C40
- \u5C0A\u91CD\u521B\u4F5C\u8005\u7684\u9009\u62E9
`.trim(), ds = `
\u4F60\u662F\u5168\u4E66\u6458\u8981\u751F\u6210\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u751F\u6210\u5C0F\u8BF4\u7684\u6574\u4F53\u6458\u8981\u3002

\u4EFB\u52A1\uFF1A
- \u6839\u636E\u8BBE\u8BA1\u9636\u6BB5\u5185\u5BB9\u548C\u6240\u6709\u7AE0\u8282\u6458\u8981
- \u751F\u6210\u5168\u4E66\u6458\u8981\uFF08500-1000\u5B57\uFF09
- \u6982\u62EC\u6545\u4E8B\u7684\u6838\u5FC3\u5185\u5BB9\u3001\u4E3B\u9898\u3001\u7279\u70B9

\u8F93\u51FA\uFF1A
- \u7B80\u6D01\u7684\u6545\u4E8B\u6897\u6982
- \u6838\u5FC3\u4E3B\u9898
- \u4E3B\u8981\u89D2\u8272
- \u4E3B\u8981\u60C5\u8282\u7EBF

\u8981\u6C42\uFF1A
- \u7B80\u6D01\u4F46\u4E0D\u5931\u5B8C\u6574\u6027
- \u7A81\u51FA\u4EAE\u70B9
- \u9002\u5408\u4F5C\u4E3A\u4F5C\u54C1\u7B80\u4ECB
`.trim(), ms = `
\u4F60\u662F\u8425\u9500\u6587\u6848\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u751F\u6210\u5C0F\u8BF4\u63A8\u8350\u8BED\u3002

\u4EFB\u52A1\uFF1A
- \u6839\u636E\u5168\u4E66\u6458\u8981\u3001\u4E3B\u9898\u3001\u98CE\u683C
- \u751F\u6210\u5438\u5F15\u8BFB\u8005\u7684\u63A8\u8350\u8BED
- \u63D0\u4F9B\u77ED\u7248\uFF0850-100\u5B57\uFF09\u548C\u957F\u7248\uFF08200-300\u5B57\uFF09

\u8981\u6C42\uFF1A
- \u6709\u5438\u5F15\u529B
- \u7A81\u51FA\u5356\u70B9
- \u7B26\u5408\u76EE\u6807\u8BFB\u8005
- \u4E0D\u5938\u5927\u5176\u8BCD
`.trim(), ps = `
you \u662F\u5BFC\u8BFB\u751F\u6210\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u4E3A\u5C0F\u8BF4\u751F\u6210\u5BFC\u8BFB\u3002

\u4EFB\u52A1\uFF1A
- \u5E2E\u52A9\u8BFB\u8005\u66F4\u597D\u5730\u7406\u89E3\u4F5C\u54C1
- \u4ECB\u7ECD\u80CC\u666F\u3001\u4E3B\u9898\u3001\u7279\u8272
- \u63D0\u4F9B\u9605\u8BFB\u5EFA\u8BAE

\u8F93\u51FA\u5185\u5BB9\uFF1A
- \u521B\u4F5C\u80CC\u666F
- \u4E3B\u9898\u5206\u6790
- \u7279\u8272\u4ECB\u7ECD
- \u9605\u8BFB\u5EFA\u8BAE

\u8981\u6C42\uFF1A
- \u4E0D\u5267\u900F\u5173\u952E\u60C5\u8282
- \u5F15\u5BFC\u800C\u4E0D\u704C\u8F93
- \u9002\u5EA6\u5206\u6790
`.trim(), us = `
\u4F60\u662F\u4F5C\u8005\u540E\u8BB0\u751F\u6210\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u751F\u6210\u4F5C\u8005\u7684\u8BDD\u3002

\u4EFB\u52A1\uFF1A
- \u6839\u636E\u521B\u4F5C\u5386\u7A0B
- \u751F\u6210\u771F\u8BDA\u7684\u4F5C\u8005\u540E\u8BB0

\u53EF\u5305\u542B\u5185\u5BB9\uFF1A
- \u521B\u4F5C\u52A8\u673A
- \u521B\u4F5C\u8FC7\u7A0B\u4E2D\u7684\u611F\u53D7
- \u5BF9\u4F5C\u54C1\u7684\u671F\u671B
- \u5BF9\u8BFB\u8005\u7684\u611F\u8C22

\u8981\u6C42\uFF1A
- \u771F\u8BDA\u3001\u81EA\u7136
- \u4E0D\u8FC7\u5EA6\u717D\u60C5
- \u4F53\u73B0\u521B\u4F5C\u8005\u7684\u4E2A\u6027
`.trim(), hs = `
\u4F60\u662F\u89C6\u89C9\u63CF\u8FF0\u4E13\u5BB6\uFF0C\u8D1F\u8D23\u751F\u6210\u9002\u5408 AI \u7ED8\u753B\u5DE5\u5177\u7684\u5C01\u9762\u63CF\u8FF0\u3002

\u4EFB\u52A1\uFF1A
- \u6839\u636E\u6545\u4E8B\u98CE\u683C\u3001\u5173\u952E\u89D2\u8272\u3001\u6838\u5FC3\u573A\u666F
- \u751F\u6210\u9002\u7528\u4E8E Midjourney / DALL-E \u7B49\u5DE5\u5177\u7684\u6587\u5B57\u63CF\u8FF0

\u8F93\u51FA\uFF1A
- \u8BE6\u7EC6\u7684\u89C6\u89C9\u63CF\u8FF0
- \u5305\u62EC\uFF1A\u4E3B\u4F53\u3001\u98CE\u683C\u3001\u6C1B\u56F4\u3001\u8272\u8C03\u3001\u6784\u56FE\u7B49
- \u9002\u5408 AI \u7ED8\u753B\u5DE5\u5177\u7406\u89E3

\u8981\u6C42\uFF1A
- \u5177\u8C61\u5316
- \u7B26\u5408\u6545\u4E8B\u98CE\u683C
- \u6709\u89C6\u89C9\u51B2\u51FB\u529B
`.trim(), A = {
    WORLDVIEW_GENERATION: kt,
    WORLDVIEW_FIELD: Et,
    CHARACTERS_BATCH_GENERATION: Mt,
    SINGLE_CHARACTER_GENERATION: Pt,
    CHARACTER_ENHANCEMENT: Ot,
    THEME_GENERATION: Rt,
    THEME_ANALYSIS: Dt,
    PLOT_GENERATION_TEMPLATE: $t,
    PLOT_GENERATION_FREE: Lt,
    PLOT_OPTIMIZATION: Ut,
    CHAPTER_OUTLINE_GENERATION: Bt,
    CHAPTER_OUTLINE_OPTIMIZATION: Ft,
    DESIGN_REVIEW: Ht,
    CHAPTER_PREP_REVIEW: Wt,
    INTEREST_ANALYSIS: Gt,
    EMOTION_DESIGN: Yt,
    CHAPTER_PLAN_GENERATION: zt,
    BLOCK_WRITE_DIRECT: Kt,
    BLOCK_WRITE_GUIDED: Vt,
    INSTRUCTION_SUGGESTION: qt,
    BLOCK_POLISH: Jt,
    WRITING_HINT: Zt,
    CONTENT_EXPANSION: Xt,
    BLOCK_WRITE_ROLEPLAY: Qt,
    ACTION_SUGGESTION: es,
    BLOCK_EVALUATION: ts,
    IMPROVEMENT_SUGGESTIONS: ss,
    AUTO_CORRECTION: ns,
    CHAPTER_EVALUATION: rs,
    CHAPTER_IMPROVEMENT_SUGGESTIONS: as,
    CHAPTER_OPTIMIZATION: os,
    CHAPTER_SUMMARY: is,
    KNOWLEDGE_EXTRACTION: cs,
    COMPLETION_CHECK: ls,
    BOOK_SUMMARY: ds,
    RECOMMENDATION: ms,
    READING_GUIDE: ps,
    AUTHOR_NOTE: us,
    COVER_DESCRIPTION: hs
  };
  function R(t) {
    return `\u3010\u5C0F\u8BF4\u6807\u9898\u3011\uFF1A${t.modeConfig.projectName || "\u672A\u547D\u540D\u5C0F\u8BF4"}
`;
  }
  function J(t) {
    var _a;
    const s = (_a = t.modeState.tempData) == null ? void 0 : _a.latestReviewSuggestions;
    return s ? `

=== \u4E4B\u524D\u7684\u8BC4\u5BA1\u5EFA\u8BAE ===
\u7279\u522B\u6CE8\u610F\uFF1A\u7528\u6237\u4E4B\u524D\u6536\u5230\u4E86\u4EE5\u4E0B\u8BC4\u5BA1\u5EFA\u8BAE\uFF0C\u8BF7\u52A1\u5FC5\u5728\u672C\u6B21\u751F\u6210\u4E2D\u9488\u5BF9\u6027\u5730\u6539\u8FDB\uFF0C\u907F\u514D\u91CD\u590D\u9519\u8BEF\uFF1A
${s}
======================
` : "";
  }
  function D(t) {
    const s = t.modeConfig.worldview;
    if (!s) return "\uFF08\u6682\u65E0\u4E16\u754C\u89C2\u8BBE\u5B9A\uFF09";
    const n = [];
    return s.timePeriod && n.push(`**\u65F6\u4EE3\u80CC\u666F**\uFF1A${s.timePeriod}`), s.socialSystem && n.push(`**\u793E\u4F1A\u5236\u5EA6**\uFF1A${s.socialSystem}`), s.techSystem && n.push(`**\u6280\u672F\u4F53\u7CFB**\uFF1A${s.techSystem}`), s.powerSystem && n.push(`**\u80FD\u529B\u4F53\u7CFB**\uFF1A${s.powerSystem}`), s.otherSettings && n.push(`**\u5176\u4ED6\u8BBE\u5B9A**\uFF1A${s.otherSettings}`), n.join(`

`);
  }
  function B(t) {
    const s = t.modeConfig.keyCharacters;
    return !s || s.length === 0 ? "\uFF08\u6682\u65E0\u89D2\u8272\uFF09" : s.map((n) => `### ${n.name}\uFF08${n.role}\uFF09
${n.description}`).join(`

`);
  }
  function K(t) {
    const s = t.modeConfig.theme;
    return s ? [
      `**\u4E3B\u65E8**\uFF1A${s.mainIdea}`,
      `**\u7ACB\u610F**\uFF1A${s.intention}`,
      `**\u98CE\u683C**\uFF1A${s.style}`
    ].join(`
`) : "\uFF08\u6682\u65E0\u4E3B\u9898\u8BBE\u5B9A\uFF09";
  }
  function ne(t) {
    const s = t.modeConfig.plotOutline;
    if (!s) return "\uFF08\u6682\u65E0\u60C5\u8282\u8109\u7EDC\uFF09";
    if (s.rawText) return s.rawText;
    const n = s.structure ? `**\u6545\u4E8B\u7ED3\u6784**\uFF1A${s.structure}

` : "", r = s.keyPlots.map((a, i) => `${i + 1}. **${a.name}**
${a.description}`).join(`

`);
    return n + r;
  }
  function Le(t) {
    const s = t.modeConfig.chapterOutline, n = t.modeConfig.chapterOutlineRawText;
    return (!s || s.length === 0) && !n ? "\uFF08\u6682\u65E0\u7AE0\u8282\u5927\u7EB2\uFF09" : !s || s.length === 0 ? n : s.map((r) => {
      const a = r.keyEvents.map((i) => `- ${i}`).join(`
`);
      return `### \u7B2C${r.chapterNumber}\u7AE0\uFF1A${r.title}

**\u6458\u8981**\uFF1A${r.summary}

**\u5173\u952E\u4E8B\u4EF6**\uFF1A
${a}`;
    }).join(`

---

`);
  }
  function me(t) {
    const s = t.modeState.chapterSummaries;
    return !s || s.length === 0 ? "\uFF08\u6682\u65E0\u5DF2\u5B8C\u6210\u7AE0\u8282\uFF09" : s.map((n) => `**\u7B2C${n.chapterNumber}\u7AE0**\uFF1A${n.summary}`).join(`

`);
  }
  function V(t) {
    const s = t.modeState.currentChapter;
    return !s || !s.blocks || s.blocks.length === 0 ? "\uFF08\u672C\u7AE0\u6682\u65E0\u5DF2\u5199\u5185\u5BB9\uFF09" : s.blocks.map((n, r) => `\u3010\u5206\u5757 ${r + 1}\u3011\uFF08${n.wordCount}\u5B57\uFF09
${n.content}`).join(`

`);
  }
  function re(t) {
    const s = t.modeState.progressTracking.currentInterestPoints;
    return !s || s.length === 0 ? "\uFF08\u6682\u65E0\u5174\u8DA3\u70B9\uFF09" : s.map((n, r) => `${r + 1}. \u3010${n.type}\u3011${n.content}\uFF08\u4F18\u5148\u7EA7\uFF1A${n.priority}\uFF09`).join(`
`);
  }
  function Ne(t) {
    const n = t.modeState.progressTracking.foreshadows.filter((r) => r.status === "pending" || r.status === "in-progress");
    return n.length === 0 ? "\uFF08\u6682\u65E0\u672A\u5B8C\u6210\u7684\u4F0F\u7B14\uFF09" : n.map((r) => {
      const a = `\u7B2C${r.introducedAt.chapter}\u7AE0-\u5206\u5757${r.introducedAt.block}`;
      return `- \u3010${r.importance}\u3011${r.content}\uFF08\u5F15\u5165\u4E8E\uFF1A${a}\uFF09`;
    }).join(`
`);
  }
  function xs(t) {
    const s = t.modeState.knowledgeBase, n = [];
    if (s.entities && s.entities.length > 0) {
      const r = s.entities.map((a) => {
        const i = a.alias && a.alias.length > 0 ? `\uFF08\u522B\u540D\uFF1A${a.alias.join("\u3001")}\uFF09` : "", l = a.description.slice(0, 2).join("\uFF1B");
        return `- ${a.name}${i}\uFF1A${l}`;
      }).join(`
`);
      n.push(`**\u5B9E\u4F53**\uFF1A
${r}`);
    }
    if (s.rules && s.rules.length > 0) {
      const r = s.rules.map((a) => `- ${a.name}\uFF1A${a.description}`).join(`
`);
      n.push(`**\u89C4\u5219**\uFF1A
${r}`);
    }
    return n.join(`

`) || "\uFF08\u6682\u65E0\u77E5\u8BC6\u5E93\u5185\u5BB9\uFF09";
  }
  function gs(t, s) {
    var _a;
    const n = ((_a = t.modeState.tempData) == null ? void 0 : _a.worldviewHint) || "", r = R(t), a = J(t);
    return [
      {
        role: "system",
        content: A.WORLDVIEW_GENERATION
      },
      {
        role: "user",
        content: [
          r,
          n ? `\u3010\u7528\u6237\u671F\u671B/\u73B0\u6709\u8BBE\u5B9A\u3011\uFF1A
${n}` : "",
          "\u8BF7\u6839\u636E\u4EE5\u4E0A\u4FE1\u606F\u751F\u6210\u5B8C\u6574\u7684\u4E16\u754C\u89C2\u8BBE\u5B9A\u3002",
          a
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function _s(t, s) {
    var _a, _b;
    const n = ((_a = t.modeState.tempData) == null ? void 0 : _a.currentField) || "", r = ((_b = t.modeState.tempData) == null ? void 0 : _b.worldviewHint) || "", a = R(t), i = t.modeConfig.worldview || {}, l = J(t);
    return [
      {
        role: "system",
        content: A.WORLDVIEW_FIELD
      },
      {
        role: "user",
        content: [
          a,
          `\u5DF2\u6709\u4E16\u754C\u89C2\u5185\u5BB9\uFF1A
${JSON.stringify(i, null, 2)}`,
          r ? `\u3010\u7528\u6237\u63D0\u793A\u3011\uFF1A
${r}` : "",
          `\u8BF7\u4E3A\u5B57\u6BB5\u300C${n}\u300D\u751F\u6210\u5185\u5BB9\u3002`,
          l
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function fs(t, s) {
    var _a;
    const n = R(t), r = D(t), a = K(t), i = ((_a = t.modeState.tempData) == null ? void 0 : _a.characterHint) || "", l = J(t);
    return [
      {
        role: "system",
        content: A.CHARACTERS_BATCH_GENERATION
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${r}`,
          `\u3010\u4E3B\u9898\u3011
${a}`,
          i ? `\u3010\u7528\u6237\u63D0\u793A\u3011\uFF1A
${i}` : "",
          "\u8BF7\u751F\u6210 3-5 \u4E2A\u5173\u952E\u89D2\u8272\u3002",
          l
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function ws(t, s) {
    var _a;
    const n = R(t), r = D(t), a = B(t), i = ((_a = t.modeState.tempData) == null ? void 0 : _a.characterHint) || "", l = J(t);
    return [
      {
        role: "system",
        content: A.SINGLE_CHARACTER_GENERATION
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${r}`,
          `\u3010\u5DF2\u6709\u89D2\u8272\u3011
${a}`,
          i ? `\u3010\u7528\u6237\u63D0\u793A\u3011
${i}` : "",
          "\u8BF7\u751F\u6210\u4E00\u4E2A\u65B0\u89D2\u8272\u3002",
          l
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function Ss(t, s) {
    var _a, _b;
    const n = R(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.targetCharacterId) || "", a = t.modeConfig.keyCharacters.find((p) => p.id === r), i = ((_b = t.modeState.tempData) == null ? void 0 : _b.characterHint) || "", l = J(t);
    if (!a) throw new Error(`Character ${r} not found`);
    const x = D(t);
    return [
      {
        role: "system",
        content: A.CHARACTER_ENHANCEMENT
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${x}`,
          `\u3010\u5F53\u524D\u89D2\u8272\u3011
\u59D3\u540D\uFF1A${a.name}
\u89D2\u8272\u5B9A\u4F4D\uFF1A${a.role}
\u63CF\u8FF0\uFF1A${a.description}`,
          i ? `\u3010\u5B8C\u5584\u8981\u6C42\u3011\uFF1A
${i}` : "",
          "\u8BF7\u5B8C\u5584\u6B64\u89D2\u8272\u3002",
          l
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function ys(t, s) {
    var _a;
    const n = R(t), r = D(t), a = B(t), i = ((_a = t.modeState.tempData) == null ? void 0 : _a.themeHint) || "", l = J(t);
    return [
      {
        role: "system",
        content: A.THEME_GENERATION
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${r}`,
          `\u3010\u89D2\u8272\u3011
${a}`,
          i ? `\u3010\u7528\u6237\u63D0\u793A\u3011\uFF1A
${i}` : "",
          "\u8BF7\u751F\u6210\u5C0F\u8BF4\u4E3B\u9898\u3002",
          l
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function Ns(t, s) {
    const n = R(t), r = D(t), a = B(t), i = K(t);
    return [
      {
        role: "system",
        content: A.THEME_ANALYSIS
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${r}`,
          `\u3010\u89D2\u8272\u3011
${a}`,
          `\u3010\u4E3B\u9898\u3011
${i}`,
          "\u8BF7\u5206\u6790\u5F53\u524D\u4E3B\u9898\u8BBE\u8BA1\u3002"
        ].join(`

`)
      }
    ];
  }
  function vs(t, s) {
    var _a, _b, _c;
    const n = R(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.plotStructure) || "\u4E09\u5E55\u5267", a = ((_b = t.modeState.tempData) == null ? void 0 : _b.plotFormat) || "markdown", i = ((_c = t.modeState.tempData) == null ? void 0 : _c.plotHint) || "", l = J(t), x = D(t), p = B(t), g = K(t), w = ne(t), y = w && !w.includes("\u6682\u65E0\u60C5\u8282\u8109\u7EDC"), d = a === "yaml" ? "\u8BF7\u4EE5 YAML \u683C\u5F0F\u8F93\u51FA\uFF08\u53C2\u8003 system prompt \u4E2D\u7684\u683C\u5F0F\u8981\u6C42\uFF09\u3002" : "\u8BF7\u4EE5 Markdown \u683C\u5F0F\u8F93\u51FA\uFF08\u53C2\u8003 system prompt \u4E2D\u7684\u683C\u5F0F\u8981\u6C42\uFF09\u3002";
    return [
      {
        role: "system",
        content: A.PLOT_GENERATION_TEMPLATE
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${x}`,
          `\u3010\u89D2\u8272\u3011
${p}`,
          `\u3010\u4E3B\u9898\u3011
${g}`,
          y ? `\u3010\u5F53\u524D\u60C5\u8282\u8349\u7A3F\u3011
${w}` : "",
          i ? `\u3010\u7528\u6237\u63D0\u793A\u3011\uFF1A
${i}` : "",
          `\u3010\u9009\u62E9\u7684\u7ED3\u6784\u3011\uFF1A${r}`,
          `
${d}`,
          l
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function bs(t, s) {
    var _a, _b;
    const n = R(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.plotFormat) || "markdown", a = ((_b = t.modeState.tempData) == null ? void 0 : _b.plotHint) || "", i = J(t), l = D(t), x = B(t), p = K(t), g = ne(t), w = g && !g.includes("\u6682\u65E0\u60C5\u8282\u8109\u7EDC"), y = r === "yaml" ? "\u8BF7\u4EE5 YAML \u683C\u5F0F\u8F93\u51FA\u3002" : "\u8BF7\u4EE5 Markdown \u683C\u5F0F\u8F93\u51FA\u3002";
    return [
      {
        role: "system",
        content: A.PLOT_GENERATION_FREE
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${l}`,
          `\u3010\u89D2\u8272\u3011
${x}`,
          `\u3010\u4E3B\u9898\u3011
${p}`,
          w ? `\u3010\u5F53\u524D\u60C5\u8282\u8349\u7A3F\u3011
${g}` : "",
          a ? `\u3010\u7528\u6237\u63D0\u793A\u3011
${a}` : "",
          `
${y}`,
          i
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function Is(t, s) {
    var _a, _b, _c;
    const n = R(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.plotText) || ne(t), a = ((_b = t.modeConfig.plotOutline) == null ? void 0 : _b.format) || "markdown", i = ((_c = t.modeState.tempData) == null ? void 0 : _c.plotHint) || "", l = J(t), x = D(t), p = B(t), g = K(t);
    return [
      {
        role: "system",
        content: A.PLOT_OPTIMIZATION
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${x}`,
          `\u3010\u89D2\u8272\u3011
${p}`,
          `\u3010\u4E3B\u9898\u3011
${g}`,
          `\u3010\u5F53\u524D\u60C5\u8282\u8109\u7EDC\u3011\uFF08${a} \u683C\u5F0F\uFF09
${r}`,
          i ? `\u3010\u4F18\u5316\u8981\u6C42\u3011\uFF1A
${i}` : "",
          "\u8BF7\u4F18\u5316\u8FD9\u4E2A\u60C5\u8282\u8109\u7EDC\uFF0C\u4FDD\u6301\u539F\u683C\u5F0F\u3002",
          l
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function js(t, s) {
    var _a, _b, _c;
    const n = R(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.chapterCount) || 12, a = ((_b = t.modeState.tempData) == null ? void 0 : _b.outlineFormat) || "markdown", i = ((_c = t.modeState.tempData) == null ? void 0 : _c.outlineHint) || "", l = J(t), x = D(t), p = B(t), g = K(t), w = ne(t), y = a === "yaml" ? "\u8BF7\u4EE5 YAML \u683C\u5F0F\u8F93\u51FA\u3002" : "\u8BF7\u4EE5 Markdown \u683C\u5F0F\u8F93\u51FA\u3002";
    return [
      {
        role: "system",
        content: A.CHAPTER_OUTLINE_GENERATION
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${x}`,
          `\u3010\u89D2\u8272\u3011
${p}`,
          `\u3010\u4E3B\u9898\u3011
${g}`,
          `\u3010\u60C5\u8282\u8109\u7EDC\u3011
${w}`,
          i ? `\u3010\u7528\u6237\u63D0\u793A\u3011\uFF1A
${i}` : "",
          `
\u8BF7\u751F\u6210\u7EA6 ${r} \u7AE0\u7684\u7AE0\u8282\u5927\u7EB2\u3002

${y}`,
          l
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function Cs(t, s) {
    var _a, _b, _c;
    const n = R(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.outlineText) || Le(t), a = ((_b = t.modeState.tempData) == null ? void 0 : _b.outlineFormat) || "markdown", i = ((_c = t.modeState.tempData) == null ? void 0 : _c.outlineHint) || "", l = J(t), x = ne(t);
    return [
      {
        role: "system",
        content: A.CHAPTER_OUTLINE_OPTIMIZATION
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u60C5\u8282\u8109\u7EDC\u3011
${x}`,
          `\u3010\u5F53\u524D\u7AE0\u8282\u5927\u7EB2\u3011\uFF08${a} \u683C\u5F0F\uFF09
${r}`,
          i ? `\u3010\u4F18\u5316\u8981\u6C42\u3011\uFF1A
${i}` : "",
          "\u8BF7\u4F18\u5316\u8FD9\u4E2A\u7AE0\u8282\u5927\u7EB2\uFF0C\u4FDD\u6301\u539F\u683C\u5F0F\u3002",
          l
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function Ue(t, s) {
    const n = R(t), r = D(t), a = B(t), i = K(t), l = ne(t), x = t.modeConfig.chapterOutlineRawText, g = t.modeConfig.chapterOutline && t.modeConfig.chapterOutline.length > 0 || !!x ? Le(t) : "\uFF08\u7528\u6237\u9009\u62E9\u8DF3\u8FC7\u5927\u7EB2\u8BBE\u8BA1\uFF09";
    return [
      {
        role: "system",
        content: A.DESIGN_REVIEW
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${r}`,
          `\u3010\u89D2\u8272\u3011
${a}`,
          `\u3010\u4E3B\u9898\u3011
${i}`,
          `\u3010\u60C5\u8282\u8109\u7EDC\u3011
${l}`,
          `\u3010\u7AE0\u8282\u5927\u7EB2\u3011
${g}`,
          "\u8BF7\u5BF9\u4EE5\u4E0A\u8BBE\u8BA1\u8FDB\u884C\u5168\u9762\u8BC4\u5BA1\u3002"
        ].join(`

`)
      }
    ];
  }
  function Be(t, s) {
    var _a;
    const n = R(t), r = D(t), a = B(t), i = me(t), l = t.modeState.currentChapterIndex + 1, x = (_a = t.modeConfig.chapterOutline) == null ? void 0 : _a.find((g) => g.chapterNumber === l), p = x ? `\u3010\u672C\u7AE0\u5927\u7EB2\u3011
\u7B2C${x.chapterNumber}\u7AE0\uFF1A${x.title}
${x.summary}` : "\uFF08\u672C\u7AE0\u65E0\u5927\u7EB2\uFF09";
    return [
      {
        role: "system",
        content: A.CHAPTER_PREP_REVIEW
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${r}`,
          `\u3010\u89D2\u8272\u3011
${a}`,
          `\u3010\u5DF2\u5B8C\u6210\u7AE0\u8282\u6458\u8981\u3011
${i}`,
          p,
          `\u8BF7\u751F\u6210\u524D\u60C5\u56DE\u987E\uFF0C\u4E3A\u7B2C${l}\u7AE0\u505A\u51C6\u5907\u3002`
        ].join(`

`)
      }
    ];
  }
  function Fe(t, s) {
    const n = R(t), r = me(t), a = V(t), i = Ne(t);
    return [
      {
        role: "system",
        content: A.INTEREST_ANALYSIS
      },
      {
        role: "user",
        content: [
          n,
          `====\u3010\u524D\u7F6E\u5267\u60C5\u5F00\u59CB\u3011====
${r}`,
          `====\u3010\u8FD1\u671F\u5267\u60C5\u5F00\u59CB\u3011====
${a}`,
          `====\u3010\u672A\u5B8C\u6210\u4F0F\u7B14\u3011====
${i}`,
          "====\u3010\u8BF7\u63D0\u53D6\u5174\u8DA3\u70B9\u3011===="
        ].join(`

`)
      }
    ];
  }
  function He(t, s) {
    var _a;
    const n = R(t), r = t.modeState.progressTracking.emotionSequence.slice(-10).map((p) => `\u7B2C${p.chapterNumber}\u7AE0-\u5757${p.blockIndex}\uFF1A${p.emotion}\uFF08\u5F3A\u5EA6${p.intensity}\uFF09`).join(`
`) || "\uFF08\u6682\u65E0\u5386\u53F2\u60C5\u7EEA\uFF09", a = t.modeState.currentChapterIndex + 1, i = (_a = t.modeConfig.chapterOutline) == null ? void 0 : _a.find((p) => p.chapterNumber === a), l = i ? `\u7B2C${i.chapterNumber}\u7AE0\uFF1A${i.title}
${i.summary}` : "\uFF08\u672C\u7AE0\u65E0\u5927\u7EB2\uFF09", x = re(t);
    return [
      {
        role: "system",
        content: A.EMOTION_DESIGN
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u5386\u53F2\u60C5\u7EEA\u5E8F\u5217\u3011
${r}`,
          `\u3010\u672C\u7AE0\u5927\u7EB2\u3011
${l}`,
          `\u3010\u5F53\u524D\u5174\u8DA3\u70B9\u3011
${x}`,
          "\u8BF7\u4E3A\u672C\u7AE0\u8BBE\u8BA1\u60C5\u7EEA\u66F2\u7EBF\u3002"
        ].join(`

`)
      }
    ];
  }
  function We(t, s) {
    var _a, _b, _c;
    const n = R(t), r = t.modeState.currentChapterIndex + 1, a = (_a = t.modeConfig.chapterOutline) == null ? void 0 : _a.find((w) => w.chapterNumber === r), i = a ? `\u7B2C${a.chapterNumber}\u7AE0\uFF1A${a.title}
\u6458\u8981\uFF1A${a.summary}
\u5173\u952E\u4E8B\u4EF6\uFF1A
${a.keyEvents.map((w) => `- ${w}`).join(`
`)}` : "\uFF08\u672C\u7AE0\u65E0\u5927\u7EB2\uFF09", l = ((_b = t.modeState.tempData) == null ? void 0 : _b.chapterPrepReview) || "\uFF08\u65E0\u524D\u60C5\u56DE\u987E\uFF09", x = Ne(t), p = re(t), g = ((_c = t.modeState.tempData) == null ? void 0 : _c.emotionDesign) || "\uFF08\u65E0\u60C5\u7EEA\u8BBE\u8BA1\uFF09";
    return [
      {
        role: "system",
        content: A.CHAPTER_PLAN_GENERATION
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u7AE0\u8282\u5927\u7EB2\u3011
${i}`,
          `\u3010\u524D\u60C5\u56DE\u987E\u3011
${l}`,
          `\u3010\u672A\u5B8C\u6210\u4F0F\u7B14\u3011
${x}`,
          `\u3010\u5174\u8DA3\u70B9\u5217\u8868\u3011
${p}`,
          `\u3010\u60C5\u7EEA\u66F2\u7EBF\u8BBE\u8BA1\u3011
${g}`,
          "\u8BF7\u751F\u6210\u672C\u7AE0\u7684\u8BE6\u7EC6\u89C4\u5212\u3002"
        ].join(`

`)
      }
    ];
  }
  function Se(t, s) {
    var _a, _b, _c;
    const n = R(t), r = D(t), a = B(t), i = ((_a = t.modeState.currentChapter) == null ? void 0 : _a.plan) || "\uFF08\u65E0\u7AE0\u8282\u89C4\u5212\uFF09", l = V(t), x = re(t), p = ((_b = t.modeState.tempData) == null ? void 0 : _b.emotionDesign) || "\uFF08\u65E0\u60C5\u7EEA\u8BBE\u8BA1\uFF09", g = ((_c = t.modeState.tempData) == null ? void 0 : _c.userInstruction) || "";
    return [
      {
        role: "system",
        content: A.BLOCK_WRITE_DIRECT
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${r}`,
          `\u3010\u89D2\u8272\u3011
${a}`,
          `\u3010\u7AE0\u8282\u89C4\u5212\u3011
${i}`,
          `\u3010\u5DF2\u5199\u5185\u5BB9\u3011
${l}`,
          `\u3010\u5174\u8DA3\u70B9\u3011
${x}`,
          `\u3010\u60C5\u7EEA\u8BBE\u8BA1\u3011
${p}`,
          g ? `\u3010\u7EED\u5199\u63D0\u793A\u3011\uFF1A
${g}` : "",
          "\u8BF7\u7EED\u5199\u4E0B\u4E00\u4E2A\u5206\u5757\uFF08500-1000\u5B57\uFF09\u3002"
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function Ge(t, s) {
    var _a, _b;
    const n = R(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.userInstruction) || "", a = D(t), i = B(t), l = ((_b = t.modeState.currentChapter) == null ? void 0 : _b.plan) || "\uFF08\u65E0\u7AE0\u8282\u89C4\u5212\uFF09", x = V(t);
    return [
      {
        role: "system",
        content: A.BLOCK_WRITE_GUIDED
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${a}`,
          `\u3010\u89D2\u8272\u3011
${i}`,
          `\u3010\u7AE0\u8282\u89C4\u5212\u3011
${l}`,
          `\u3010\u5DF2\u5199\u5185\u5BB9\u3011
${x}`,
          `\u3010\u7528\u6237\u6307\u4EE4\u3011
${r}`,
          `
\u8BF7\u6839\u636E\u7528\u6237\u6307\u4EE4\u7EED\u5199\uFF08500-1000\u5B57\uFF09\u3002`
        ].join(`

`)
      }
    ];
  }
  function Ts(t, s) {
    var _a;
    const n = ((_a = t.modeState.currentChapter) == null ? void 0 : _a.plan) || "\uFF08\u65E0\u7AE0\u8282\u89C4\u5212\uFF09", r = V(t), a = re(t);
    return [
      {
        role: "system",
        content: A.INSTRUCTION_SUGGESTION
      },
      {
        role: "user",
        content: `\u3010\u7AE0\u8282\u89C4\u5212\u3011
${n}

\u3010\u5DF2\u5199\u5185\u5BB9\u3011
${r}

\u3010\u5174\u8DA3\u70B9\u3011
${a}

\u8BF7\u5EFA\u8BAE 3-5 \u4E2A\u7EED\u5199\u6307\u4EE4\u3002`
      }
    ];
  }
  function Ye(t, s) {
    var _a, _b, _c;
    const n = R(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.userContent) || "", a = ((_b = t.modeState.tempData) == null ? void 0 : _b.polishStyle) || "\u6587\u5B66\u6DA6\u8272", i = ((_c = t.modeState.tempData) == null ? void 0 : _c.customRequirement) || "", l = D(t), x = B(t);
    return [
      {
        role: "system",
        content: A.BLOCK_POLISH
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${l}`,
          `\u3010\u89D2\u8272\u3011
${x}`,
          `\u3010\u6DA6\u8272\u98CE\u683C\u3011
${a}`,
          i ? `\u3010\u81EA\u5B9A\u4E49\u8981\u6C42\u3011
${i}` : "",
          `\u3010\u5F85\u6DA6\u8272\u5185\u5BB9\u3011
${r}`,
          "\u8BF7\u6DA6\u8272\u4EE5\u4E0A\u5185\u5BB9\u3002"
        ].filter(Boolean).join(`

`)
      }
    ];
  }
  function As(t, s) {
    var _a, _b;
    const n = ((_a = t.modeState.tempData) == null ? void 0 : _a.writtenContent) || "", r = ((_b = t.modeState.currentChapter) == null ? void 0 : _b.plan) || "\uFF08\u65E0\u7AE0\u8282\u89C4\u5212\uFF09", a = V(t);
    return [
      {
        role: "system",
        content: A.WRITING_HINT
      },
      {
        role: "user",
        content: `\u3010\u7AE0\u8282\u89C4\u5212\u3011
${r}

\u3010\u5DF2\u5199\u5185\u5BB9\u3011
${a}

\u3010\u7528\u6237\u5F53\u524D\u5199\u4F5C\u5185\u5BB9\u3011
${n}

\u8BF7\u63D0\u4F9B 2-3 \u4E2A\u7EED\u5199\u65B9\u5411\u5EFA\u8BAE\u3002`
      }
    ];
  }
  function ks(t, s) {
    var _a, _b;
    const n = R(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.outlineContent) || "", a = D(t), i = B(t), l = ((_b = t.modeState.currentChapter) == null ? void 0 : _b.plan) || "\uFF08\u65E0\u7AE0\u8282\u89C4\u5212\uFF09";
    return [
      {
        role: "system",
        content: A.CONTENT_EXPANSION
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${a}`,
          `\u3010\u89D2\u8272\u3011
${i}`,
          `\u3010\u7AE0\u8282\u89C4\u5212\u3011
${l}`,
          `\u3010\u7528\u6237\u7684\u5927\u7EB2\u5F0F\u5185\u5BB9\u3011
${r}`,
          "\u8BF7\u5C06\u4EE5\u4E0A\u5927\u7EB2\u6269\u5C55\u4E3A\u8BE6\u7EC6\u7684\u5C0F\u8BF4\u6587\u672C\uFF08500-1000\u5B57\uFF09\u3002"
        ].join(`

`)
      }
    ];
  }
  function ze(t, s) {
    var _a, _b, _c, _d;
    const n = R(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.selectedCharacterId) || "", a = t.modeConfig.keyCharacters.find((y) => y.id === r), i = ((_b = t.modeState.tempData) == null ? void 0 : _b.actionType) || "", l = ((_c = t.modeState.tempData) == null ? void 0 : _c.action) || "";
    if (!a) throw new Error(`Character ${r} not found`);
    const x = D(t), p = B(t), g = ((_d = t.modeState.currentChapter) == null ? void 0 : _d.plan) || "\uFF08\u65E0\u7AE0\u8282\u89C4\u5212\uFF09", w = V(t);
    return [
      {
        role: "system",
        content: A.BLOCK_WRITE_ROLEPLAY
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u4E16\u754C\u89C2\u3011
${x}`,
          `\u3010\u89D2\u8272\u3011
${p}`,
          `\u3010\u7AE0\u8282\u89C4\u5212\u3011
${g}`,
          `\u3010\u5DF2\u5199\u5185\u5BB9\u3011
${w}`,
          `\u3010\u9009\u5B9A\u89D2\u8272\u3011
\u59D3\u540D\uFF1A${a.name}
\u89D2\u8272\u5B9A\u4F4D\uFF1A${a.role}
\u63CF\u8FF0\uFF1A${a.description}`,
          `\u3010\u884C\u52A8\u7C7B\u578B\u3011
${i}`,
          `\u3010\u89D2\u8272\u884C\u52A8\u3011
${l}`,
          `
\u8BF7\u6839\u636E\u89D2\u8272\u884C\u52A8\u7EED\u5199\u5267\u60C5\uFF08500-1000\u5B57\uFF09\u3002`
        ].join(`

`)
      }
    ];
  }
  function Es(t, s) {
    var _a, _b;
    const n = R(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.selectedCharacterId) || "", a = t.modeConfig.keyCharacters.find((p) => p.id === r);
    if (!a) throw new Error(`Character ${r} not found`);
    const i = ((_b = t.modeState.currentChapter) == null ? void 0 : _b.plan) || "\uFF08\u65E0\u7AE0\u8282\u89C4\u5212\uFF09", l = V(t), x = re(t);
    return [
      {
        role: "system",
        content: A.ACTION_SUGGESTION
      },
      {
        role: "user",
        content: [
          n,
          `\u3010\u7AE0\u8282\u89C4\u5212\u3011
${i}`,
          `\u3010\u5DF2\u5199\u5185\u5BB9\u3011
${l}`,
          `\u3010\u5174\u8DA3\u70B9\u3011
${x}`,
          `\u3010\u9009\u5B9A\u89D2\u8272\u3011
\u59D3\u540D\uFF1A${a.name}
\u89D2\u8272\u5B9A\u4F4D\uFF1A${a.role}
\u63CF\u8FF0\uFF1A${a.description}`,
          `
\u8BF7\u5EFA\u8BAE 3-5 \u4E2A\u8BE5\u89D2\u8272\u53EF\u80FD\u91C7\u53D6\u7684\u884C\u52A8\u3002`
        ].join(`

`)
      }
    ];
  }
  function Ms(t, s) {
    var _a, _b, _c;
    const n = ((_a = t.modeState.tempData) == null ? void 0 : _a.blockContent) || "", r = ((_b = t.modeState.currentChapter) == null ? void 0 : _b.plan) || "\uFF08\u65E0\u7AE0\u8282\u89C4\u5212\uFF09", a = D(t), i = re(t), l = ((_c = t.modeState.tempData) == null ? void 0 : _c.emotionDesign) || "\uFF08\u65E0\u60C5\u7EEA\u8BBE\u8BA1\uFF09";
    return [
      {
        role: "system",
        content: A.BLOCK_EVALUATION
      },
      {
        role: "user",
        content: `\u3010\u7AE0\u8282\u89C4\u5212\u3011
${r}

\u3010\u4E16\u754C\u89C2\u8BBE\u5B9A\u3011
${a}

\u3010\u5174\u8DA3\u70B9\u5217\u8868\u3011
${i}

\u3010\u60C5\u7EEA\u8BBE\u8BA1\u3011
${l}

\u3010\u5206\u5757\u5185\u5BB9\u3011
${n}

\u8BF7\u8BC4\u4F30\u4EE5\u4E0A\u5206\u5757\u5185\u5BB9\u3002`
      }
    ];
  }
  function Ps(t, s) {
    var _a, _b, _c;
    const n = ((_a = t.modeState.tempData) == null ? void 0 : _a.blockContent) || "", r = ((_b = t.modeState.tempData) == null ? void 0 : _b.evaluation) || {}, a = ((_c = t.modeState.currentChapter) == null ? void 0 : _c.plan) || "\uFF08\u65E0\u7AE0\u8282\u89C4\u5212\uFF09";
    return [
      {
        role: "system",
        content: A.IMPROVEMENT_SUGGESTIONS
      },
      {
        role: "user",
        content: `\u3010\u7AE0\u8282\u89C4\u5212\u3011
${a}

\u3010\u5206\u5757\u5185\u5BB9\u3011
${n}

\u3010\u8BC4\u4F30\u7ED3\u679C\u3011
${JSON.stringify(r, null, 2)}

\u8BF7\u7ED9\u51FA\u5177\u4F53\u7684\u6539\u8FDB\u5EFA\u8BAE\u3002`
      }
    ];
  }
  function Os(t, s) {
    var _a, _b, _c, _d;
    const n = ((_a = t.modeState.tempData) == null ? void 0 : _a.blockContent) || "", r = ((_b = t.modeState.tempData) == null ? void 0 : _b.evaluation) || {}, a = ((_c = t.modeState.tempData) == null ? void 0 : _c.suggestions) || "", i = ((_d = t.modeState.currentChapter) == null ? void 0 : _d.plan) || "\uFF08\u65E0\u7AE0\u8282\u89C4\u5212\uFF09";
    return [
      {
        role: "system",
        content: A.AUTO_CORRECTION
      },
      {
        role: "user",
        content: `\u3010\u7AE0\u8282\u89C4\u5212\u3011
${i}

\u3010\u539F\u59CB\u5185\u5BB9\u3011
${n}

\u3010\u8BC4\u4F30\u7ED3\u679C\u3011
${JSON.stringify(r, null, 2)}

\u3010\u6539\u8FDB\u5EFA\u8BAE\u3011
${a}

\u8BF7\u4FEE\u6B63\u4EE5\u4E0A\u5185\u5BB9\u3002`
      }
    ];
  }
  function Rs(t, s) {
    var _a, _b;
    const n = t.modeState.currentChapterIndex + 1, r = (_a = t.modeConfig.chapterOutline) == null ? void 0 : _a.find((g) => g.chapterNumber === n), a = r ? `\u7B2C${r.chapterNumber}\u7AE0\uFF1A${r.title}
${r.summary}` : "\uFF08\u672C\u7AE0\u65E0\u5927\u7EB2\uFF09", i = V(t), l = D(t), x = re(t), p = ((_b = t.modeState.tempData) == null ? void 0 : _b.emotionDesign) || "\uFF08\u65E0\u60C5\u7EEA\u8BBE\u8BA1\uFF09";
    return [
      {
        role: "system",
        content: A.CHAPTER_EVALUATION
      },
      {
        role: "user",
        content: `\u3010\u7AE0\u8282\u5927\u7EB2\u3011
${a}

\u3010\u4E16\u754C\u89C2\u8BBE\u5B9A\u3011
${l}

\u3010\u5174\u8DA3\u70B9\u5217\u8868\u3011
${x}

\u3010\u60C5\u7EEA\u8BBE\u8BA1\u3011
${p}

\u3010\u7AE0\u8282\u5B8C\u6574\u5185\u5BB9\u3011
${i}

\u8BF7\u8BC4\u4F30\u4EE5\u4E0A\u7AE0\u8282\u5185\u5BB9\u3002`
      }
    ];
  }
  function Ds(t, s) {
    var _a;
    const n = V(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.chapterEvaluation) || {};
    return [
      {
        role: "system",
        content: A.CHAPTER_IMPROVEMENT_SUGGESTIONS
      },
      {
        role: "user",
        content: `\u3010\u7AE0\u8282\u5185\u5BB9\u3011
${n}

\u3010\u8BC4\u4F30\u7ED3\u679C\u3011
${JSON.stringify(r, null, 2)}

\u8BF7\u7ED9\u51FA\u8BE6\u7EC6\u7684\u6539\u8FDB\u5EFA\u8BAE\u3002`
      }
    ];
  }
  function $s(t, s) {
    var _a;
    const n = V(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.chapterEvaluation) || {}, a = D(t), i = B(t);
    return [
      {
        role: "system",
        content: A.CHAPTER_OPTIMIZATION
      },
      {
        role: "user",
        content: `\u3010\u4E16\u754C\u89C2\u3011
${a}

\u3010\u89D2\u8272\u3011
${i}

\u3010\u7AE0\u8282\u5185\u5BB9\u3011
${n}

\u3010\u8BC4\u4F30\u7ED3\u679C\u3011
${JSON.stringify(r, null, 2)}

\u8BF7\u4F18\u5316\u4EE5\u4E0A\u7AE0\u8282\u5185\u5BB9\u3002`
      }
    ];
  }
  function Ke(t, s) {
    var _a;
    const n = V(t), r = ((_a = t.modeState.tempData) == null ? void 0 : _a.summaryStyle) || "standard";
    return [
      {
        role: "system",
        content: A.CHAPTER_SUMMARY
      },
      {
        role: "user",
        content: `\u3010\u7AE0\u8282\u5185\u5BB9\u3011
${n}

\u3010\u6458\u8981\u98CE\u683C\u3011
${r === "detailed" ? "\u8BE6\u7EC6\uFF08\u7EA6500\u5B57\uFF09" : r === "brief" ? "\u7B80\u6D01\uFF08\u7EA6200\u5B57\uFF09" : "\u6807\u51C6\uFF08\u7EA6300\u5B57\uFF09"}

\u8BF7\u751F\u6210\u7AE0\u8282\u6458\u8981\u3002`
      }
    ];
  }
  function Ve(t, s) {
    const n = me(t), r = V(t), a = xs(t);
    return [
      {
        role: "system",
        content: A.KNOWLEDGE_EXTRACTION
      },
      {
        role: "user",
        content: `====\u3010\u524D\u7F6E\u5267\u60C5\u3011====
${n}

====\u3010\u8FD1\u671F\u5267\u60C5\u3011====
${r}

====\u3010\u5DF2\u77E5\u8981\u7D20\u6E05\u5355\u3011====
${a}

====\u3010\u8BF7\u63D0\u53D6\u6E38\u620F\u8981\u7D20\u3011====`
      }
    ];
  }
  function qe(t, s) {
    const n = D(t), r = B(t), a = K(t), i = ne(t), l = me(t), x = V(t), p = Ne(t);
    return [
      {
        role: "system",
        content: A.COMPLETION_CHECK
      },
      {
        role: "user",
        content: `\u3010\u4E16\u754C\u89C2\u3011
${n}

\u3010\u89D2\u8272\u3011
${r}

\u3010\u4E3B\u9898\u3011
${a}

\u3010\u60C5\u8282\u8109\u7EDC\u3011
${i}

\u3010\u6240\u6709\u7AE0\u8282\u6458\u8981\u3011
${l}

\u3010\u6700\u65B0\u7AE0\u8282\u5185\u5BB9\u3011
${x}

\u3010\u672A\u5B8C\u6210\u4F0F\u7B14\u3011
${p}

\u8BF7\u8BC4\u4F30\u6545\u4E8B\u662F\u5426\u81EA\u7136\u5B8C\u7ED3\u3002`
      }
    ];
  }
  function Je(t, s) {
    const n = D(t), r = B(t), a = K(t), i = me(t);
    return [
      {
        role: "system",
        content: A.BOOK_SUMMARY
      },
      {
        role: "user",
        content: `\u3010\u4E16\u754C\u89C2\u3011
${n}

\u3010\u89D2\u8272\u3011
${r}

\u3010\u4E3B\u9898\u3011
${a}

\u3010\u6240\u6709\u7AE0\u8282\u6458\u8981\u3011
${i}

\u8BF7\u751F\u6210\u5168\u4E66\u6458\u8981\uFF08500-1000\u5B57\uFF09\u3002`
      }
    ];
  }
  function Ze(t, s) {
    var _a;
    const n = ((_a = t.modeState.tempData) == null ? void 0 : _a.bookSummary) || "", r = K(t);
    return [
      {
        role: "system",
        content: A.RECOMMENDATION
      },
      {
        role: "user",
        content: `\u3010\u5168\u4E66\u6458\u8981\u3011
${n}

\u3010\u4E3B\u9898\u3011
${r}

\u8BF7\u751F\u6210\u63A8\u8350\u8BED\uFF08\u77ED\u724850-100\u5B57\uFF0C\u957F\u7248200-300\u5B57\uFF09\u3002`
      }
    ];
  }
  function Xe(t, s) {
    var _a;
    const n = D(t), r = K(t), a = ((_a = t.modeState.tempData) == null ? void 0 : _a.bookSummary) || "";
    return [
      {
        role: "system",
        content: A.READING_GUIDE
      },
      {
        role: "user",
        content: `\u3010\u4E16\u754C\u89C2\u3011
${n}

\u3010\u4E3B\u9898\u3011
${r}

\u3010\u5168\u4E66\u6458\u8981\u3011
${a}

\u8BF7\u751F\u6210\u5BFC\u8BFB\u3002`
      }
    ];
  }
  function Qe(t, s) {
    const n = K(t), r = t.modeConfig.projectName;
    return [
      {
        role: "system",
        content: A.AUTHOR_NOTE
      },
      {
        role: "user",
        content: `\u3010\u9879\u76EE\u540D\u79F0\u3011
${r}

\u3010\u4E3B\u9898\u3011
${n}

\u8BF7\u751F\u6210\u4F5C\u8005\u7684\u8BDD\u3002`
      }
    ];
  }
  function et(t, s) {
    const n = K(t), r = B(t), a = D(t);
    return [
      {
        role: "system",
        content: A.COVER_DESCRIPTION
      },
      {
        role: "user",
        content: `\u3010\u4E16\u754C\u89C2\u3011
${a}

\u3010\u89D2\u8272\u3011
${r}

\u3010\u4E3B\u9898\u3011
${n}

\u8BF7\u751F\u6210\u9002\u5408 AI \u7ED8\u753B\u5DE5\u5177\u7684\u5C01\u9762\u63CF\u8FF0\u3002`
      }
    ];
  }
  const Z = {
    makeMessagesForWorldviewGeneration: gs,
    makeMessagesForWorldviewField: _s,
    makeMessagesForCharactersBatchGeneration: fs,
    makeMessagesForSingleCharacterGeneration: ws,
    makeMessagesForCharacterEnhancement: Ss,
    makeMessagesForThemeGeneration: ys,
    makeMessagesForThemeAnalysis: Ns,
    makeMessagesForPlotGenerationWithTemplate: vs,
    makeMessagesForPlotGenerationFree: bs,
    makeMessagesForPlotOptimization: Is,
    makeMessagesForChapterOutlineGeneration: js,
    makeMessagesForChapterOutlineOptimization: Cs,
    makeMessagesForDesignReview: Ue,
    makeMessagesForChapterPrepReview: Be,
    makeMessagesForInterestAnalysis: Fe,
    makeMessagesForEmotionDesign: He,
    makeMessagesForChapterPlanGeneration: We,
    makeMessagesForBlockWriteDirect: Se,
    makeMessagesForBlockWriteGuided: Ge,
    makeMessagesForInstructionSuggestion: Ts,
    makeMessagesForBlockPolish: Ye,
    makeMessagesForWritingHint: As,
    makeMessagesForContentExpansion: ks,
    makeMessagesForBlockWriteRoleplay: ze,
    makeMessagesForActionSuggestion: Es,
    makeMessagesForBlockEvaluation: Ms,
    makeMessagesForImprovementSuggestions: Ps,
    makeMessagesForAutoCorrection: Os,
    makeMessagesForChapterEvaluation: Rs,
    makeMessagesForChapterImprovementSuggestions: Ds,
    makeMessagesForChapterOptimization: $s,
    makeMessagesForChapterSummary: Ke,
    makeMessagesForKnowledgeExtraction: Ve,
    makeMessagesForCompletionCheck: qe,
    makeMessagesForBookSummary: Je,
    makeMessagesForRecommendation: Ze,
    makeMessagesForReadingGuide: Xe,
    makeMessagesForAuthorNote: Qe,
    makeMessagesForCoverDescription: et
  };
  class Ls extends pt {
    constructor(s, n) {
      super(s);
      __publicField(this, "novelDB", null);
      this.novelDB = n || null;
    }
    getCurrentPhase() {
      return this.session.modeState.currentPhase;
    }
    getCurrentUIState() {
      return this.session.modeState.currentUIState;
    }
    getActualCurrentPhase(s) {
      const n = s.getProcessingItem();
      if (n == null ? void 0 : n.type) {
        const a = {
          novel_design_worldview: "design_worldview",
          novel_design_characters: "design_characters",
          novel_design_theme: "design_theme",
          novel_design_plot_outline: "design_plot_outline",
          novel_design_chapter_outline: "design_chapter_outline",
          novel_ai_review: "ai_review",
          novel_user_revision: "user_revision",
          novel_chapter_prep_review: "chapter_prep_review",
          novel_chapter_prep_interest: "chapter_prep_interest",
          novel_chapter_prep_emotion: "chapter_prep_emotion",
          novel_chapter_plan_generation: "chapter_plan_generation",
          novel_block_write: "block_write",
          novel_block_check: "block_check",
          novel_chapter_check: "chapter_check",
          novel_chapter_summary: "chapter_summary_generation",
          novel_knowledge_update: "knowledge_update",
          novel_completion_check: "completion_check",
          novel_book_summary: "book_summary_generation"
        }[n.type];
        if (a) return a;
      }
      return this.session.modeState.currentPhase;
    }
    getActualCurrentUIState(s) {
      const n = s.getProcessingItem();
      if (n == null ? void 0 : n.type) {
        const a = {
          novel_design_worldview: "design_worldview_editing",
          novel_design_characters: "design_characters_editing",
          novel_design_theme: "design_theme_editing",
          novel_ai_review: "ai_review_running",
          novel_chapter_prep_review: "chapter_prep_running",
          novel_chapter_plan_generation: "chapter_plan_running",
          novel_block_write: "block_write_running",
          novel_block_check: "block_check_running",
          novel_chapter_check: "chapter_complete"
        }[n.type];
        if (a) return a;
      }
      return this.session.modeState.currentUIState ? this.session.modeState.currentUIState : this.getReadyUIStateForPhase(this.getActualCurrentPhase(s));
    }
    getReadyUIStateForPhase(s) {
      return {
        design_worldview: "design_worldview_ready",
        design_characters: "design_characters_ready",
        design_theme: "design_theme_ready",
        design_plot_outline: "design_plot_outline_ready",
        design_chapter_outline: "design_chapter_outline_ready",
        ai_review: "ai_review_ready",
        user_revision: "user_revision_ready",
        chapter_prep_review: "chapter_prep_running",
        chapter_prep_foreshadow: "chapter_prep_running",
        chapter_prep_interest: "chapter_prep_running",
        chapter_prep_emotion: "chapter_prep_running",
        chapter_plan_generation: "chapter_plan_ready",
        chapter_plan_approval: "chapter_plan_done",
        block_write: "block_write_ready",
        block_check: "block_check_ready",
        block_confirm: "block_write_done",
        chapter_check: "chapter_complete",
        chapter_confirm: "chapter_complete",
        chapter_summary_generation: "chapter_complete",
        knowledge_update: "chapter_complete",
        re_planning_check: "chapter_complete",
        completion_check: "completion_ready",
        book_summary_generation: "completion_running",
        recommendation_generation: "completion_running",
        reading_guide_generation: "completion_running",
        author_note_generation: "completion_running",
        cover_description_generation: "completion_running",
        completed: "completed"
      }[s] || "idle";
    }
    enterNextState(s) {
      console.log(`[NovelWriting] Transition: ${this.session.modeState.currentPhase} -> ${s}`), this.session.modeState.currentPhase = s, this.session.updatedAt = Date.now();
    }
    setCurrentUIState(s) {
      this.session.modeState.currentUIState = s, this.session.updatedAt = Date.now();
    }
    async executeCurrentStateLogic(s) {
      var _a;
      switch (this.session.modeState.currentPhase) {
        case "design_worldview":
          return this.setCurrentUIState("design_worldview_ready"), {
            type: "WAIT_FOR_INPUT"
          };
        case "design_characters":
          return this.setCurrentUIState("design_characters_ready"), {
            type: "WAIT_FOR_INPUT"
          };
        case "design_theme":
          return this.setCurrentUIState("design_theme_ready"), {
            type: "WAIT_FOR_INPUT"
          };
        case "design_plot_outline":
          return this.setCurrentUIState("design_plot_outline_ready"), {
            type: "WAIT_FOR_INPUT"
          };
        case "design_chapter_outline":
          return this.setCurrentUIState("design_chapter_outline_ready"), {
            type: "WAIT_FOR_INPUT"
          };
        case "ai_review":
          return this.session.modeState.currentUIState === "ai_review_running" || this.session.modeState.currentUIState === "ai_review_ready" ? (this.session.modeState.currentUIState === "ai_review_ready" && this.setCurrentUIState("ai_review_running"), {
            type: "LLM_CALL",
            messages: Ue(this.session),
            callbackPhase: "ai_review",
            llmRequestType: "ai_review"
          }) : (this.setCurrentUIState("ai_review_ready"), {
            type: "WAIT_FOR_INPUT"
          });
        case "user_revision":
          return this.setCurrentUIState("user_revision_ready"), {
            type: "WAIT_FOR_INPUT"
          };
        case "chapter_prep_review":
          return this.session.modeState.currentUIState === "chapter_prep_running" || this.session.modeState.currentUIState === "chapter_prep_ready" ? (this.session.modeState.currentUIState === "chapter_prep_ready" && this.setCurrentUIState("chapter_prep_running"), {
            type: "LLM_CALL",
            messages: Be(this.session),
            callbackPhase: "chapter_prep_review",
            llmRequestType: "chapter_prep_review"
          }) : (this.setCurrentUIState("chapter_prep_ready"), {
            type: "WAIT_FOR_INPUT"
          });
        case "chapter_prep_foreshadow":
          return this.enterNextState("chapter_prep_interest"), {
            type: "STATE_CHANGE"
          };
        case "chapter_prep_interest":
          return this.session.modeState.currentUIState === "chapter_prep_running" || this.session.modeState.currentUIState === "chapter_prep_ready" ? (this.session.modeState.currentUIState === "chapter_prep_ready" && this.setCurrentUIState("chapter_prep_running"), {
            type: "LLM_CALL",
            messages: Fe(this.session),
            callbackPhase: "chapter_prep_interest",
            llmRequestType: "interest_analysis"
          }) : (this.setCurrentUIState("chapter_prep_ready"), {
            type: "WAIT_FOR_INPUT"
          });
        case "chapter_prep_emotion":
          return this.session.modeState.currentUIState === "chapter_prep_running" || this.session.modeState.currentUIState === "chapter_prep_ready" ? (this.session.modeState.currentUIState === "chapter_prep_ready" && this.setCurrentUIState("chapter_prep_running"), {
            type: "LLM_CALL",
            messages: He(this.session),
            callbackPhase: "chapter_prep_emotion",
            llmRequestType: "emotion_design"
          }) : (this.setCurrentUIState("chapter_prep_ready"), {
            type: "WAIT_FOR_INPUT"
          });
        case "chapter_plan_generation":
          return this.session.modeState.currentUIState === "chapter_plan_running" || this.session.modeState.currentUIState === "chapter_plan_ready" ? (this.session.modeState.currentUIState === "chapter_plan_ready" && this.setCurrentUIState("chapter_plan_running"), {
            type: "LLM_CALL",
            messages: We(this.session),
            callbackPhase: "chapter_plan_generation",
            llmRequestType: "chapter_plan_generation"
          }) : (this.setCurrentUIState("chapter_plan_ready"), {
            type: "WAIT_FOR_INPUT"
          });
        case "chapter_plan_approval":
          return this.setCurrentUIState("chapter_plan_done"), {
            type: "WAIT_FOR_INPUT"
          };
        case "block_write":
          if (this.session.modeState.currentUIState === "block_write_running" || this.session.modeState.currentUIState === "block_write_ready") {
            this.session.modeState.currentUIState === "block_write_ready" && this.setCurrentUIState("block_write_running");
            const r = ((_a = this.session.modeState.tempData) == null ? void 0 : _a.writeMode) || "ai_direct";
            let a;
            switch (r) {
              case "ai_direct":
                a = Se(this.session);
                break;
              case "ai_guided":
                a = Ge(this.session);
                break;
              case "user_polish":
                a = Ye(this.session);
                break;
              case "roleplay":
                a = ze(this.session);
                break;
              default:
                a = Se(this.session);
            }
            return {
              type: "LLM_CALL",
              messages: a,
              callbackPhase: "block_write",
              llmRequestType: `block_write_${r}`
            };
          }
          return this.setCurrentUIState("block_write_ready"), {
            type: "WAIT_FOR_INPUT"
          };
        case "block_check":
          return this.setCurrentUIState("block_check_ready"), {
            type: "WAIT_FOR_INPUT"
          };
        case "block_confirm":
          return this.setCurrentUIState("block_write_done"), {
            type: "WAIT_FOR_INPUT"
          };
        case "chapter_check":
          return this.setCurrentUIState("chapter_complete"), {
            type: "WAIT_FOR_INPUT"
          };
        case "chapter_confirm":
          return this.setCurrentUIState("chapter_complete"), {
            type: "WAIT_FOR_INPUT"
          };
        case "chapter_summary_generation":
          return this.session.modeState.currentUIState === "chapter_complete_running" || this.session.modeState.currentUIState === "chapter_complete" ? (this.session.modeState.currentUIState === "chapter_complete" && this.setCurrentUIState("chapter_complete_running"), {
            type: "LLM_CALL",
            messages: Ke(this.session),
            callbackPhase: "chapter_summary_generation",
            llmRequestType: "chapter_summary"
          }) : (this.setCurrentUIState("chapter_complete"), {
            type: "WAIT_FOR_INPUT"
          });
        case "knowledge_update":
          return this.session.modeState.currentUIState === "chapter_complete_running" || this.session.modeState.currentUIState === "chapter_complete" ? (this.session.modeState.currentUIState === "chapter_complete" && this.setCurrentUIState("chapter_complete_running"), {
            type: "LLM_CALL",
            messages: Ve(this.session),
            callbackPhase: "knowledge_update",
            llmRequestType: "knowledge_extraction"
          }) : (this.setCurrentUIState("chapter_complete"), {
            type: "WAIT_FOR_INPUT"
          });
        case "re_planning_check":
          return this.setCurrentUIState("chapter_complete"), {
            type: "WAIT_FOR_INPUT"
          };
        case "completion_check":
          return this.session.modeState.currentUIState === "completion_running" || this.session.modeState.currentUIState === "completion_ready" ? (this.session.modeState.currentUIState === "completion_ready" && this.setCurrentUIState("completion_running"), {
            type: "LLM_CALL",
            messages: qe(this.session),
            callbackPhase: "completion_check",
            llmRequestType: "completion_check"
          }) : (this.setCurrentUIState("completion_ready"), {
            type: "WAIT_FOR_INPUT"
          });
        case "book_summary_generation":
          return this.session.modeState.currentUIState === "completion_running" || this.session.modeState.currentUIState === "completion_ready" ? (this.session.modeState.currentUIState === "completion_ready" && this.setCurrentUIState("completion_running"), {
            type: "LLM_CALL",
            messages: Je(this.session),
            callbackPhase: "book_summary_generation",
            llmRequestType: "book_summary"
          }) : (this.setCurrentUIState("completion_ready"), {
            type: "WAIT_FOR_INPUT"
          });
        case "recommendation_generation":
          return this.session.modeState.currentUIState === "completion_running" || this.session.modeState.currentUIState === "completion_ready" ? (this.session.modeState.currentUIState === "completion_ready" && this.setCurrentUIState("completion_running"), {
            type: "LLM_CALL",
            messages: Ze(this.session),
            callbackPhase: "recommendation_generation",
            llmRequestType: "recommendation"
          }) : (this.setCurrentUIState("completion_ready"), {
            type: "WAIT_FOR_INPUT"
          });
        case "reading_guide_generation":
          return this.session.modeState.currentUIState === "completion_running" || this.session.modeState.currentUIState === "completion_ready" ? (this.session.modeState.currentUIState === "completion_ready" && this.setCurrentUIState("completion_running"), {
            type: "LLM_CALL",
            messages: Xe(this.session),
            callbackPhase: "reading_guide_generation",
            llmRequestType: "reading_guide"
          }) : (this.setCurrentUIState("completion_ready"), {
            type: "WAIT_FOR_INPUT"
          });
        case "author_note_generation":
          return this.session.modeState.currentUIState === "completion_running" || this.session.modeState.currentUIState === "completion_ready" ? (this.session.modeState.currentUIState === "completion_ready" && this.setCurrentUIState("completion_running"), {
            type: "LLM_CALL",
            messages: Qe(this.session),
            callbackPhase: "author_note_generation",
            llmRequestType: "author_note"
          }) : (this.setCurrentUIState("completion_ready"), {
            type: "WAIT_FOR_INPUT"
          });
        case "cover_description_generation":
          return this.session.modeState.currentUIState === "completion_running" || this.session.modeState.currentUIState === "completion_ready" ? (this.session.modeState.currentUIState === "completion_ready" && this.setCurrentUIState("completion_running"), {
            type: "LLM_CALL",
            messages: et(this.session),
            callbackPhase: "cover_description_generation",
            llmRequestType: "cover_description"
          }) : (this.setCurrentUIState("completion_ready"), {
            type: "WAIT_FOR_INPUT"
          });
        case "completed":
          return this.setCurrentUIState("completed"), {
            type: "STOP"
          };
        default:
          return {
            type: "WAIT_FOR_INPUT"
          };
      }
    }
    async initializeNewChapter(s) {
      var _a;
      const n = (_a = this.session.modeConfig.chapterOutline) == null ? void 0 : _a.find((a) => a.chapterNumber === s), r = {
        id: k(),
        projectId: this.session.id,
        chapterNumber: s,
        title: (n == null ? void 0 : n.title) || `\u7B2C${s}\u7AE0`,
        summary: "",
        status: "planning",
        wordCount: 0,
        targetWordCount: 4e3,
        blocks: [],
        createdAt: Date.now(),
        updatedAt: Date.now()
      };
      this.session.modeState.currentChapter = {
        id: r.id,
        number: r.chapterNumber,
        title: r.title,
        status: r.status,
        wordCount: r.wordCount,
        targetWordCount: r.targetWordCount,
        blocks: [],
        summary: r.summary
      }, this.session.modeState.currentChapterIndex = s - 1, this.session.updatedAt = Date.now(), this.novelDB && await this.novelDB.saveChapter(r);
    }
    async addBlock(s, n) {
      if (!this.session.modeState.currentChapter) throw new Error("No current chapter");
      const r = s.length, a = {
        id: k(),
        chapterId: this.session.modeState.currentChapter.id,
        content: s,
        wordCount: r,
        writeMode: n,
        status: "completed",
        createdAt: Date.now(),
        updatedAt: Date.now()
      };
      if (this.session.modeState.currentChapter.blocks.push({
        ...a,
        writeMode: n
      }), this.session.modeState.currentChapter.wordCount += r, this.session.updatedAt = Date.now(), this.novelDB) {
        await this.novelDB.saveBlock(a);
        const i = await this.novelDB.getChapters().then((l) => l.find((x) => x.id === a.chapterId));
        i && (i.wordCount += r, i.updatedAt = Date.now(), await this.novelDB.saveChapter(i));
      }
      return a;
    }
    async completeCurrentChapter() {
      if (!this.session.modeState.currentChapter) throw new Error("No current chapter");
      if (this.session.modeState.currentChapter.status = "completed", this.session.modeState.progressTracking.completedChapters += 1, this.session.modeState.progressTracking.totalWordCount += this.session.modeState.currentChapter.wordCount, this.session.updatedAt = Date.now(), this.novelDB) {
        const s = this.session.modeState.currentChapter.id, r = (await this.novelDB.getChapters()).find((a) => a.id === s);
        r && (r.status = "completed", r.updatedAt = Date.now(), await this.novelDB.saveChapter(r));
      }
    }
    addChapterSummary(s, n) {
      this.session.modeState.chapterSummaries.push({
        chapterNumber: s,
        summary: n
      }), this.session.updatedAt = Date.now(), this.novelDB && this.novelDB.getChapters().then((r) => {
        var _a;
        const a = r.find((i) => i.chapterNumber === s);
        a && (a.summary = n, (_a = this.novelDB) == null ? void 0 : _a.saveChapter(a));
      });
    }
    updateInterestPoints(s) {
      this.session.modeState.progressTracking.currentInterestPoints = s, this.session.updatedAt = Date.now();
    }
    async addForeshadow(s, n, r, a) {
      const i = {
        id: k(),
        projectId: this.session.id,
        content: s,
        introducedAt: {
          chapterId: `${n}`,
          blockId: `${r}`,
          chapter: n,
          block: r
        },
        status: "pending",
        importance: a,
        createdAt: Date.now(),
        updatedAt: Date.now()
      };
      this.session.modeState.progressTracking.foreshadows.push({
        id: i.id,
        content: i.content,
        introducedAt: {
          chapter: n,
          block: r
        },
        status: "pending",
        importance: a
      }), this.session.updatedAt = Date.now(), this.novelDB && await this.novelDB.saveForeshadow(i);
    }
    async resolveForeshadow(s, n, r) {
      const a = this.session.modeState.progressTracking.foreshadows.find((i) => i.id === s);
      if (a && (a.status = "resolved", a.resolvedAt = {
        chapter: n,
        block: r
      }, this.session.updatedAt = Date.now()), this.novelDB) {
        const l = (await this.novelDB.getForeshadows()).find((x) => x.id === s);
        l && (l.status = "resolved", l.resolvedAt = {
          chapterId: `${n}`,
          blockId: `${r}`
        }, l.updatedAt = Date.now(), await this.novelDB.saveForeshadow(l));
      }
    }
    async updateKnowledgeBase(s) {
      if (s.newEntities && this.session.modeState.knowledgeBase.entities.push(...s.newEntities), s.newEvents && this.session.modeState.knowledgeBase.events.push(...s.newEvents), s.newRules && this.session.modeState.knowledgeBase.rules.push(...s.newRules), this.session.updatedAt = Date.now(), this.novelDB) {
        if (s.newEntities) for (const n of s.newEntities) await this.novelDB.saveEntity({
          id: k(),
          projectId: this.session.id,
          name: n.name,
          type: n.type === "\u89D2\u8272" ? "character" : n.type === "\u5730\u70B9" ? "location" : n.type === "\u7269\u54C1" ? "item" : "other",
          description: n.description,
          aliases: n.alias,
          createdAt: Date.now(),
          updatedAt: Date.now()
        });
        if (s.newEvents) for (const n of s.newEvents) await this.novelDB.saveEvent({
          id: k(),
          projectId: this.session.id,
          name: "\u672A\u547D\u540D\u4E8B\u4EF6",
          type: n.type === "\u72B6\u6001\u53D8\u5316" ? "state_change" : n.type === "\u5173\u7CFB\u53D8\u5316" ? "relation_change" : "event",
          description: n.description,
          createdAt: Date.now()
        });
        if (s.newRules) for (const n of s.newRules) await this.novelDB.saveRule({
          id: k(),
          projectId: this.session.id,
          category: n.type === "\u65F6\u4EE3\u80CC\u666F" ? "world" : n.type === "\u793E\u4F1A\u5236\u5EA6" ? "social" : n.type === "\u6280\u672F\u4F53\u7CFB" ? "tech" : n.type === "\u80FD\u529B\u4F53\u7CFB" ? "power" : "other",
          name: n.name,
          content: n.description,
          createdAt: Date.now(),
          updatedAt: Date.now()
        });
      }
    }
  }
  const Us = M({
    id: f(),
    chapterId: f(),
    content: f(),
    wordCount: I(),
    writeMode: U([
      "ai_direct",
      "ai_guided",
      "user_polish",
      "roleplay"
    ]),
    status: U([
      "draft",
      "completed",
      "revised"
    ]).default("draft"),
    createdAt: I(),
    updatedAt: I(),
    evaluation: ye().optional()
  }), Bs = M({
    id: f(),
    projectId: f(),
    chapterNumber: I(),
    title: f(),
    summary: f().optional(),
    status: U([
      "planning",
      "writing",
      "completed",
      "archived"
    ]),
    wordCount: I().default(0),
    plan: f().optional(),
    outline: ye().optional(),
    createdAt: I(),
    updatedAt: I()
  }), Fs = M({
    id: f(),
    projectId: f(),
    name: f(),
    type: U([
      "character",
      "location",
      "item",
      "other"
    ]),
    description: L(f()),
    aliases: L(f()).optional(),
    tags: L(f()).optional(),
    firstAppearance: f().optional(),
    createdAt: I(),
    updatedAt: I()
  }), Hs = M({
    id: f(),
    projectId: f(),
    name: f(),
    type: U([
      "state_change",
      "relation_change",
      "event"
    ]),
    description: f(),
    occurredAt: f().optional(),
    involvedEntities: L(f()).optional(),
    createdAt: I()
  }), Ws = M({
    id: f(),
    projectId: f(),
    category: U([
      "world",
      "social",
      "tech",
      "power",
      "other"
    ]),
    name: f(),
    content: f(),
    createdAt: I(),
    updatedAt: I()
  }), Gs = M({
    id: f(),
    projectId: f(),
    content: f(),
    importance: U([
      "low",
      "medium",
      "high"
    ]),
    status: U([
      "pending",
      "in_progress",
      "resolved",
      "dropped"
    ]),
    introducedAt: M({
      chapterId: f(),
      blockId: f().optional()
    }),
    resolvedAt: M({
      chapterId: f(),
      blockId: f().optional()
    }).optional(),
    createdAt: I(),
    updatedAt: I()
  });
  function Ys(t) {
    return typeof t == "object" && t !== null && ot(t) !== void 0;
  }
  function ee(t) {
    if (Ys(t)) return fe(t);
    if (Array.isArray(t)) return t.map((s) => ee(s));
    if (t && typeof t == "object") {
      const s = {};
      for (const [n, r] of Object.entries(t)) s[n] = ee(r);
      return s;
    }
    return t;
  }
  function zs(t) {
    const s = `silly-tavern-novel-${t}`, n = new xt(s);
    return n.version(4).stores({
      blocks: "id, chapterId, status",
      chapters: "id, projectId, chapterNumber, status",
      entities: "id, projectId, type",
      events: "id, projectId, type",
      rules: "id, projectId, category",
      foreshadows: "id, projectId, status, importance"
    }), {
      blocks: ae(oe({
        id: "blocks",
        schema: Us,
        getKey: (r) => r.id,
        dbName: s
      })),
      chapters: ae(oe({
        id: "chapters",
        schema: Bs,
        getKey: (r) => r.id,
        dbName: s
      })),
      entities: ae(oe({
        id: "entities",
        schema: Fs,
        getKey: (r) => r.id,
        dbName: s
      })),
      events: ae(oe({
        id: "events",
        schema: Hs,
        getKey: (r) => r.id,
        dbName: s
      })),
      rules: ae(oe({
        id: "rules",
        schema: Ws,
        getKey: (r) => r.id,
        dbName: s
      })),
      foreshadows: ae(oe({
        id: "foreshadows",
        schema: Gs,
        getKey: (r) => r.id,
        dbName: s
      })),
      dexieInstance: n
    };
  }
  const Re = /* @__PURE__ */ new Map();
  class Ks {
    constructor(s) {
      __publicField(this, "projectId");
      __publicField(this, "database");
      this.projectId = s, this.database = this.initDatabase();
    }
    initDatabase() {
      let s = Re.get(this.projectId);
      return s || (s = zs(this.projectId), Re.set(this.projectId, s)), s;
    }
    getTable(s) {
      return this.database.dexieInstance.table(s);
    }
    async getChapters() {
      return (await this.getTable("chapters").where("projectId").equals(this.projectId).toArray()).sort((n, r) => n.chapterNumber - r.chapterNumber);
    }
    async saveChapter(s) {
      return await this.getTable("chapters").put(ee(s));
    }
    async getBlocks(s) {
      return (await this.getTable("blocks").where("chapterId").equals(s).toArray()).sort((r, a) => r.createdAt - a.createdAt);
    }
    async saveBlock(s) {
      return await this.getTable("blocks").put(ee(s));
    }
    async getEntities() {
      return await this.getTable("entities").where("projectId").equals(this.projectId).toArray();
    }
    async saveEntity(s) {
      return await this.getTable("entities").put(ee(s));
    }
    async getEvents() {
      return await this.getTable("events").where("projectId").equals(this.projectId).toArray();
    }
    async saveEvent(s) {
      return await this.getTable("events").put(ee(s));
    }
    async getRules() {
      return await this.getTable("rules").where("projectId").equals(this.projectId).toArray();
    }
    async saveRule(s) {
      return await this.getTable("rules").put(ee(s));
    }
    async getForeshadows() {
      return await this.getTable("foreshadows").where("projectId").equals(this.projectId).toArray();
    }
    async saveForeshadow(s) {
      return await this.getTable("foreshadows").put(ee(s));
    }
  }
  const o = Ie({
    currentSession: null,
    contextManager: null,
    sessionManager: null,
    novelDB: null,
    isLoading: false,
    isStreaming: false,
    errorMessage: null,
    async loadSession(t) {
      var _a;
      o.isLoading = true;
      try {
        o.currentSession = t;
        const s = new Ks(t.id);
        o.novelDB = _e(s);
        const n = await s.getEntities(), r = await s.getEvents(), a = await s.getRules();
        if (o.currentSession) {
          o.currentSession.modeState.knowledgeBase = {
            entities: n.map((d) => ({
              type: d.type === "character" ? "\u89D2\u8272" : d.type === "location" ? "\u5730\u70B9" : "\u7269\u54C1",
              name: d.name,
              description: d.description,
              alias: d.aliases
            })),
            events: r.map((d) => ({
              type: d.type === "state_change" ? "\u72B6\u6001\u53D8\u5316" : "\u5173\u7CFB\u53D8\u5316",
              description: d.description,
              chapterNumber: 0,
              timestamp: d.createdAt
            })),
            rules: a.map((d) => ({
              type: d.category === "world" ? "\u65F6\u4EE3\u80CC\u666F" : d.category === "social" ? "\u793E\u4F1A\u5236\u5EA6" : d.category === "tech" ? "\u6280\u672F\u4F53\u7CFB" : d.category === "power" ? "\u80FD\u529B\u4F53\u7CFB" : "\u5176\u4ED6",
              name: d.name,
              description: d.content
            }))
          };
          const i = await s.getChapters(), l = o.currentSession.modeState.currentChapterIndex, x = i.find((d) => d.chapterNumber === l + 1);
          if (x && o.currentSession) {
            const d = await s.getBlocks(x.id);
            o.currentSession.modeState.currentChapter = {
              id: x.id,
              number: x.chapterNumber,
              title: x.title,
              status: x.status,
              wordCount: x.wordCount,
              targetWordCount: 4e3,
              blocks: d.map((c) => ({
                id: c.id,
                content: c.content,
                wordCount: c.wordCount,
                writeMode: c.writeMode,
                createdAt: c.createdAt
              })),
              summary: x.summary || "",
              plan: x.plan || ""
            };
          }
          const p = await s.getForeshadows();
          p.length > 0 && (o.currentSession.modeState.progressTracking.foreshadows = p.map((d) => ({
            id: d.id,
            content: d.content,
            importance: d.importance,
            status: d.status === "in_progress" ? "in-progress" : d.status,
            introducedAt: {
              chapter: Number.parseInt(d.introducedAt.chapterId) || 0,
              block: Number.parseInt(d.introducedAt.blockId || "0") || 0
            },
            resolvedAt: d.resolvedAt ? {
              chapter: Number.parseInt(d.resolvedAt.chapterId) || 0,
              block: Number.parseInt(d.resolvedAt.blockId || "0") || 0
            } : void 0
          })));
          const g = new Ls(o.currentSession, s);
          o.sessionManager = _e(g);
          const w = ((_a = o.currentSession.modeState.tempData) == null ? void 0 : _a.reviewHistory) || [], y = Ie({
            historyItems: w,
            processingItem: void 0
          });
          o.contextManager = _e(new mt(y));
        }
      } catch (s) {
        console.error("Failed to load session data:", s), o.errorMessage = "\u52A0\u8F7D\u4F1A\u8BDD\u6570\u636E\u5931\u8D25";
      } finally {
        o.isLoading = false;
      }
    },
    setPhase(t) {
      this.currentSession && (this.currentSession.modeState.currentPhase = t, this.currentSession.updatedAt = Date.now());
    },
    setUIState(t) {
      this.currentSession && (this.currentSession.modeState.currentUIState = t, this.currentSession.updatedAt = Date.now());
    },
    updateModeConfig(t) {
      this.currentSession && (Object.assign(this.currentSession.modeConfig, t), this.currentSession.updatedAt = Date.now());
    },
    updateModeState(t) {
      this.currentSession && (Object.assign(this.currentSession.modeState, t), this.currentSession.updatedAt = Date.now());
    },
    updateTempData(t) {
      this.currentSession && (this.currentSession.modeState.tempData || (this.currentSession.modeState.tempData = {}), Object.assign(this.currentSession.modeState.tempData, t), this.currentSession.updatedAt = Date.now());
    },
    clearTempData() {
      this.currentSession && (this.currentSession.modeState.tempData = {}, this.currentSession.updatedAt = Date.now());
    },
    async saveNewContextItemsToDB(t, s) {
      this.currentSession && (this.updateTempData({
        reviewHistory: s
      }), await this.updateSessionInDB());
    },
    async updateSessionInDB() {
      if (o.currentSession) try {
        const { masterDb: t } = await dt(async () => {
          const { masterDb: r } = await import("./db-master-BrZHBPj2.js").then((a) => a.t);
          return {
            masterDb: r
          };
        }, __vite__mapDeps([0,1,2,3,4,5,6,7])), s = fe(o.currentSession.modeConfig), n = fe(o.currentSession.modeState);
        await t.sessions.update(o.currentSession.id, {
          modeConfig: s,
          modeState: n,
          updatedAt: Date.now()
        });
      } catch (t) {
        console.error("Failed to update session in DB:", t);
      }
    },
    setError(t) {
      this.errorMessage = t;
    },
    setLoading(t) {
      this.isLoading = t;
    },
    setStreaming(t) {
      this.isStreaming = t;
    }
  });
  function ce() {
    const t = se((d) => d.config), s = T.useRef(false), n = async (d, c, v, S, u = {}) => {
      const h = o.contextManager;
      if (!h) return {
        content: ""
      };
      const m = {
        id: k(),
        type: v,
        orderRef: 0,
        timestamp: Date.now(),
        data: {
          content: "",
          ...u
        }
      };
      h.setProcessingItem(m);
      let _ = "";
      return await q(d, c, [], (N, b) => {
        if (S == null ? void 0 : S(N), _ = b, o.contextManager) {
          const E = o.contextManager.state.processingItem;
          E && (E.data = {
            ...E.data,
            content: b
          });
        }
      }), h.completeProcessingItem(), {
        content: _
      };
    }, r = async (d, c) => {
      const v = o.sessionManager, S = o.contextManager;
      if (!(v && S)) return;
      const u = await v.executeCurrentStateLogic(S);
      if (console.log("[NovelWriting Loop] Action:", u), u.type === "WAIT_FOR_INPUT" || u.type === "STOP") {
        await o.updateSessionInDB(), s.current = false;
        return;
      }
      if (u.type === "STATE_CHANGE") {
        await o.updateSessionInDB(), setTimeout(() => p(d.id), 0);
        return;
      }
      if (u.type === "LLM_CALL") {
        u.callbackPhase && v.setCurrentUIState("block_write_running"), await o.updateSessionInDB();
        const h = await n(c, u.messages.map((m) => ({
          ...m,
          id: k()
        })), u.llmRequestType, void 0, u.dataExtra);
        await o.saveNewContextItemsToDB(d.id, S.getHistoryItems()), await a(u, h.content, d.id), await o.saveNewContextItemsToDB(d.id, S.getHistoryItems()), await o.updateSessionInDB(), setTimeout(() => p(d.id), 0);
      }
    }, a = async (d, c, v) => {
      var _a;
      const S = o.sessionManager, u = o.contextManager;
      switch (d.callbackPhase) {
        case "ai_review":
          try {
            const h = i(c);
            u.addHistoryItem({
              id: k(),
              type: "novel_ai_review",
              idx: 0,
              orderRef: 0,
              timestamp: Date.now(),
              data: h,
              hidden: false
            }), await o.saveNewContextItemsToDB(v, u.getHistoryItems()), h.recommendation === "pass" ? S.enterNextState("chapter_prep_review") : S.enterNextState("user_revision");
          } catch (h) {
            console.error("Failed to parse AI review", h), C.error("AI \u8BC4\u5BA1\u89E3\u6790\u5931\u8D25"), S.enterNextState("user_revision");
          }
          break;
        case "chapter_prep_review":
          u.addHistoryItem({
            id: k(),
            type: "novel_chapter_prep_review",
            idx: 0,
            orderRef: 0,
            timestamp: Date.now(),
            data: {
              chapterNumber: S.session.modeState.currentChapterIndex + 1,
              reviewText: c,
              generatedAt: Date.now()
            },
            hidden: false
          });
          break;
        case "interest_analysis":
          try {
            const h = l(c);
            u.addHistoryItem({
              id: k(),
              type: "novel_chapter_prep_interest",
              idx: 0,
              orderRef: 0,
              timestamp: Date.now(),
              data: {
                chapterNumber: S.session.modeState.currentChapterIndex + 1,
                interestPoints: h,
                analysisText: c
              },
              hidden: false
            }), S.updateInterestPoints(h);
          } catch (h) {
            console.error("Failed to parse interest points", h);
          }
          break;
        case "emotion_design":
          o.updateTempData({
            emotionDesign: c
          }), u.addHistoryItem({
            id: k(),
            type: "novel_chapter_prep_emotion",
            idx: 0,
            orderRef: 0,
            timestamp: Date.now(),
            data: {
              chapterNumber: S.session.modeState.currentChapterIndex + 1,
              emotionDesign: c,
              emotionNodes: []
            },
            hidden: false
          });
          break;
        case "chapter_plan_generation":
          S.session.modeState.currentChapter && (S.session.modeState.currentChapter.plan = c), u.addHistoryItem({
            id: k(),
            type: "novel_chapter_plan_generation",
            idx: 0,
            orderRef: 0,
            timestamp: Date.now(),
            data: {
              chapterNumber: S.session.modeState.currentChapterIndex + 1,
              plan: c,
              generatedAt: Date.now()
            },
            hidden: false
          });
          break;
        case "block_write":
          {
            const h = ((_a = S.session.modeState.tempData) == null ? void 0 : _a.writeMode) || "ai_direct", m = await S.addBlock(c, h);
            u.addHistoryItem({
              id: k(),
              type: "novel_block_write",
              idx: 0,
              orderRef: 0,
              timestamp: Date.now(),
              data: {
                chapterNumber: S.session.modeState.currentChapterIndex + 1,
                blockIndex: S.session.modeState.currentChapter.blocks.length - 1,
                content: c,
                wordCount: m.wordCount,
                writeMode: h
              },
              hidden: false
            }), S.enterNextState("block_confirm");
          }
          break;
        case "chapter_summary":
          {
            const h = S.session.modeState.currentChapterIndex + 1;
            S.addChapterSummary(h, c), u.addHistoryItem({
              id: k(),
              type: "novel_chapter_summary",
              idx: 0,
              orderRef: 0,
              timestamp: Date.now(),
              data: {
                chapterNumber: h,
                summary: c,
                style: "standard",
                generatedAt: Date.now()
              },
              hidden: false
            }), S.enterNextState("knowledge_update");
          }
          break;
        case "knowledge_extraction":
          try {
            const h = x(c);
            u.addHistoryItem({
              id: k(),
              type: "novel_knowledge_update",
              idx: 0,
              orderRef: 0,
              timestamp: Date.now(),
              data: {
                chapterNumber: S.session.modeState.currentChapterIndex + 1,
                updates: h,
                approved: false
              },
              hidden: false
            }), S.enterNextState("re_planning_check");
          } catch (h) {
            console.error("Failed to parse knowledge updates", h), S.enterNextState("re_planning_check");
          }
          break;
        case "completion_check":
          try {
            const h = c.includes("\u5DF2\u5B8C\u7ED3") || c.includes("\u5B8C\u7ED3");
            if (u.addHistoryItem({
              id: k(),
              type: "novel_completion_check",
              idx: 0,
              orderRef: 0,
              timestamp: Date.now(),
              data: {
                isCompleted: h,
                completionReason: h ? "natural_ending" : void 0,
                aiAssessment: c
              },
              hidden: false
            }), h) S.enterNextState("book_summary_generation");
            else {
              const m = S.session.modeState.currentChapterIndex + 2;
              S.initializeNewChapter(m), S.enterNextState("chapter_prep_review");
            }
          } catch (h) {
            console.error("Failed to parse completion check", h);
          }
          break;
        case "book_summary":
          o.updateTempData({
            bookSummary: c
          }), u.addHistoryItem({
            id: k(),
            type: "novel_book_summary",
            idx: 0,
            orderRef: 0,
            timestamp: Date.now(),
            data: {
              summary: c,
              generatedAt: Date.now()
            },
            hidden: false
          }), S.enterNextState("recommendation_generation");
          break;
        case "recommendation":
          {
            const [h, m] = c.split(`

`).filter(Boolean);
            u.addHistoryItem({
              id: k(),
              type: "novel_recommendation",
              idx: 0,
              orderRef: 0,
              timestamp: Date.now(),
              data: {
                shortVersion: h || c,
                longVersion: m || c,
                generatedAt: Date.now()
              },
              hidden: false
            }), S.enterNextState("reading_guide_generation");
          }
          break;
        case "reading_guide":
          u.addHistoryItem({
            id: k(),
            type: "novel_reading_guide",
            idx: 0,
            orderRef: 0,
            timestamp: Date.now(),
            data: {
              guide: c,
              generatedAt: Date.now()
            },
            hidden: false
          }), S.enterNextState("author_note_generation");
          break;
        case "author_note":
          u.addHistoryItem({
            id: k(),
            type: "novel_author_note",
            idx: 0,
            orderRef: 0,
            timestamp: Date.now(),
            data: {
              note: c,
              generatedAt: Date.now()
            },
            hidden: false
          }), S.enterNextState("cover_description_generation");
          break;
        case "cover_description":
          u.addHistoryItem({
            id: k(),
            type: "novel_cover_description",
            idx: 0,
            orderRef: 0,
            timestamp: Date.now(),
            data: {
              description: c,
              generatedAt: Date.now()
            },
            hidden: false
          }), S.enterNextState("completed");
          break;
        default:
          console.warn("Unknown callback phase:", d.callbackPhase);
      }
    };
    function i(d) {
      const c = {
        worldviewCompleteness: 0,
        characterDesign: 0,
        themeDepth: 0,
        plotLogic: 0,
        outlineFeasibility: 0
      }, v = d.match(/[:]\s*(\d+)/), S = d.match(/[:]\s*(\d+)/), u = d.match(/[:]\s*(\d+)/), h = d.match(/[:]\s*(\d+)/), m = d.match(/[:]\s*(\d+)/), _ = d.match(/[:]?\s*(\d+(\.\d+)?)/);
      v && (c.worldviewCompleteness = parseInt(v[1])), S && (c.characterDesign = parseInt(S[1])), u && (c.themeDepth = parseInt(u[1])), h && (c.plotLogic = parseInt(h[1])), m && (c.outlineFeasibility = parseInt(m[1]));
      let N = 0;
      if (_) N = parseFloat(_[1]);
      else {
        const b = Object.values(c).filter((E) => E > 0);
        b.length > 0 && (N = b.reduce((E, X) => E + X, 0) / b.length);
      }
      return {
        reviewResult: d,
        scores: c,
        overallScore: parseFloat(N.toFixed(1)),
        recommendation: d.includes("\u3010\u5EFA\u8BAE\u901A\u8FC7\u3011") ? "pass" : "revise",
        suggestions: []
      };
    }
    function l(d) {
      const c = [], v = d.matchAll(/[\[](?:\d+)?[\)\]][\[]([^\]]+)[\)\]][\[]([^\]]+)[\]]/g);
      for (const S of v) c.push({
        type: S[1],
        content: S[2],
        priority: 5
      });
      if (c.length === 0) {
        const S = d.split(`
`).filter((u) => u.includes("\u3011") || u.includes("]"));
        for (const u of S.slice(0, 5)) {
          const h = u.split(/[\]]/);
          h.length >= 2 && c.push({
            type: "\u770B\u70B9",
            content: h[h.length - 1].trim().replace(/^[:\s\[]+/, ""),
            priority: 5
          });
        }
      }
      return c.slice(0, 5);
    }
    function x(d) {
      var _a, _b;
      const c = d.split(`
`).filter((h) => h.trim().startsWith("{")), v = [], S = [], u = [];
      for (const h of c) try {
        const m = JSON.parse(h);
        m.type === "\u89D2\u8272" || m.type === "\u5730\u70B9" || m.type === "\u7269\u54C1" ? v.push(m) : ((_a = m.type) == null ? void 0 : _a.includes("\u72B6\u6001")) || ((_b = m.type) == null ? void 0 : _b.includes("\u5173\u7CFB")) ? S.push(m) : u.push(m);
      } catch {
        console.warn("Failed to parse knowledge line:", h);
      }
      return {
        newEntities: v.filter((h) => h.method !== "update"),
        updatedEntities: v.filter((h) => h.method === "update"),
        newEvents: S,
        newRules: u
      };
    }
    const p = T.useCallback(async (d, c = false) => {
      const v = o.currentSession;
      if (!v || v.id !== d) {
        console.warn("[Loop] Session mismatch or not loaded");
        return;
      }
      if (s.current && !c) {
        console.warn("[Loop] Already calling, skip");
        return;
      }
      s.current = true;
      try {
        await r(v, t);
      } catch (S) {
        console.error("[Loop] Error:", S), C.error("\u6267\u884C\u51FA\u9519\uFF0C\u8BF7\u68C0\u67E5\u63A7\u5236\u53F0"), s.current = false;
      }
    }, [
      t
    ]), g = T.useCallback(async () => {
      if (!o.currentSession) return;
      const c = o.sessionManager;
      c && (c.setCurrentUIState("design_worldview_ready"), await o.updateSessionInDB());
    }, []), w = T.useCallback(async (d) => {
      const c = o.currentSession;
      if (!c) return;
      const v = o.sessionManager;
      v && (v.enterNextState(d), await o.updateSessionInDB(), p(c.id));
    }, [
      p
    ]), y = T.useCallback(async (d) => {
      const c = o.currentSession;
      if (!c) return;
      const v = o.contextManager;
      v && (v.addHistoryItem({
        id: k(),
        type: "participant_message",
        idx: 0,
        orderRef: 0,
        timestamp: Date.now(),
        data: {
          content: d,
          role: "user"
        },
        hidden: false
      }), await o.saveNewContextItemsToDB(c.id, v.getHistoryItems()), p(c.id));
    }, [
      p
    ]);
    return {
      runLoop: p,
      startDesign: g,
      continueToNextPhase: w,
      submitUserInput: y
    };
  }
  const Vs = U([
    "design_worldview",
    "design_characters",
    "design_theme",
    "design_plot_outline",
    "design_chapter_outline",
    "ai_review",
    "user_revision",
    "chapter_prep_review",
    "chapter_prep_foreshadow",
    "chapter_prep_interest",
    "chapter_prep_emotion",
    "chapter_plan_generation",
    "chapter_plan_approval",
    "block_write",
    "block_check",
    "block_confirm",
    "chapter_check",
    "chapter_confirm",
    "chapter_summary_generation",
    "knowledge_update",
    "re_planning_check",
    "completion_check",
    "book_summary_generation",
    "recommendation_generation",
    "reading_guide_generation",
    "author_note_generation",
    "cover_description_generation",
    "completed"
  ]), qs = U([
    "idle",
    "design_worldview_ready",
    "design_worldview_editing",
    "design_worldview_done",
    "design_characters_ready",
    "design_characters_editing",
    "design_characters_done",
    "design_theme_ready",
    "design_theme_editing",
    "design_theme_done",
    "design_plot_outline_ready",
    "design_plot_outline_editing",
    "design_plot_outline_done",
    "design_chapter_outline_ready",
    "design_chapter_outline_editing",
    "design_chapter_outline_done",
    "ai_review_ready",
    "ai_review_running",
    "ai_review_done",
    "user_revision_ready",
    "user_revision_editing",
    "user_revision_done",
    "chapter_prep_ready",
    "chapter_prep_running",
    "chapter_prep_done",
    "chapter_plan_ready",
    "chapter_plan_running",
    "chapter_plan_done",
    "block_write_ready",
    "block_write_running",
    "block_write_done",
    "block_check_ready",
    "block_check_running",
    "block_check_done",
    "chapter_complete",
    "chapter_complete_running",
    "completion_ready",
    "completion_running",
    "completion_done",
    "completed"
  ]), Js = {
    idle: {
      label: "\u7A7A\u95F2",
      placeholder: "\u8BF7\u5F00\u59CB\u8BBE\u8BA1\u60A8\u7684\u5C0F\u8BF4...",
      inputEnabled: false
    },
    design_worldview_ready: {
      label: "\u4E16\u754C\u89C2\u8BBE\u8BA1\uFF08\u51C6\u5907\uFF09",
      placeholder: "\u51C6\u5907\u8BBE\u8BA1\u4E16\u754C\u89C2...",
      inputEnabled: false
    },
    design_worldview_editing: {
      label: "\u4E16\u754C\u89C2\u8BBE\u8BA1\uFF08\u7F16\u8F91\u4E2D\uFF09",
      placeholder: "\u6B63\u5728\u8BBE\u8BA1\u4E16\u754C\u89C2...",
      inputEnabled: true
    },
    design_worldview_done: {
      label: "\u4E16\u754C\u89C2\u8BBE\u8BA1\uFF08\u5B8C\u6210\uFF09",
      placeholder: "\u4E16\u754C\u89C2\u8BBE\u8BA1\u5B8C\u6210",
      inputEnabled: false
    },
    design_characters_ready: {
      label: "\u89D2\u8272\u8BBE\u8BA1\uFF08\u51C6\u5907\uFF09",
      placeholder: "\u51C6\u5907\u8BBE\u8BA1\u89D2\u8272...",
      inputEnabled: false
    },
    design_characters_editing: {
      label: "\u89D2\u8272\u8BBE\u8BA1\uFF08\u7F16\u8F91\u4E2D\uFF09",
      placeholder: "\u6B63\u5728\u8BBE\u8BA1\u89D2\u8272...",
      inputEnabled: true
    },
    design_characters_done: {
      label: "\u89D2\u8272\u8BBE\u8BA1\uFF08\u5B8C\u6210\uFF09",
      placeholder: "\u89D2\u8272\u8BBE\u8BA1\u5B8C\u6210",
      inputEnabled: false
    },
    design_theme_ready: {
      label: "\u4E3B\u9898\u8BBE\u8BA1\uFF08\u51C6\u5907\uFF09",
      placeholder: "\u51C6\u5907\u8BBE\u8BA1\u4E3B\u9898...",
      inputEnabled: false
    },
    design_theme_editing: {
      label: "\u4E3B\u9898\u8BBE\u8BA1\uFF08\u7F16\u8F91\u4E2D\uFF09",
      placeholder: "\u6B63\u5728\u8BBE\u8BA1\u4E3B\u9898...",
      inputEnabled: true
    },
    design_theme_done: {
      label: "\u4E3B\u9898\u8BBE\u8BA1\uFF08\u5B8C\u6210\uFF09",
      placeholder: "\u4E3B\u9898\u8BBE\u8BA1\u5B8C\u6210",
      inputEnabled: false
    },
    design_plot_outline_ready: {
      label: "\u60C5\u8282\u8109\u7EDC\u8BBE\u8BA1\uFF08\u51C6\u5907\uFF09",
      placeholder: "\u51C6\u5907\u8BBE\u8BA1\u60C5\u8282\u8109\u7EDC...",
      inputEnabled: false
    },
    design_plot_outline_editing: {
      label: "\u60C5\u8282\u8109\u7EDC\u8BBE\u8BA1\uFF08\u7F16\u8F91\u4E2D\uFF09",
      placeholder: "\u6B63\u5728\u8BBE\u8BA1\u60C5\u8282\u8109\u7EDC...",
      inputEnabled: true
    },
    design_plot_outline_done: {
      label: "\u60C5\u8282\u8109\u7EDC\u8BBE\u8BA1\uFF08\u5B8C\u6210\uFF09",
      placeholder: "\u60C5\u8282\u8109\u7EDC\u8BBE\u8BA1\u5B8C\u6210",
      inputEnabled: false
    },
    design_chapter_outline_ready: {
      label: "\u7AE0\u8282\u5927\u7EB2\u8BBE\u8BA1\uFF08\u51C6\u5907\uFF09",
      placeholder: "\u51C6\u5907\u8BBE\u8BA1\u7AE0\u8282\u5927\u7EB2...",
      inputEnabled: false
    },
    design_chapter_outline_editing: {
      label: "\u7AE0\u8282\u5927\u7EB2\u8BBE\u8BA1\uFF08\u7F16\u8F91\u4E2D\uFF09",
      placeholder: "\u6B63\u5728\u8BBE\u8BA1\u7AE0\u8282\u5927\u7EB2...",
      inputEnabled: true
    },
    design_chapter_outline_done: {
      label: "\u7AE0\u8282\u5927\u7EB2\u8BBE\u8BA1\uFF08\u5B8C\u6210\uFF09",
      placeholder: "\u7AE0\u8282\u5927\u7EB2\u8BBE\u8BA1\u5B8C\u6210",
      inputEnabled: false
    },
    ai_review_ready: {
      label: "AI \u8BC4\u5BA1\uFF08\u51C6\u5907\uFF09",
      placeholder: "\u51C6\u5907\u8FDB\u884C AI \u8BC4\u5BA1...",
      inputEnabled: false
    },
    ai_review_running: {
      label: "AI \u8BC4\u5BA1\uFF08\u8FDB\u884C\u4E2D\uFF09",
      placeholder: "AI \u6B63\u5728\u8BC4\u5BA1\u8BBE\u8BA1...",
      inputEnabled: false
    },
    ai_review_done: {
      label: "AI \u8BC4\u5BA1\uFF08\u5B8C\u6210\uFF09",
      placeholder: "AI \u8BC4\u5BA1\u5B8C\u6210",
      inputEnabled: false
    },
    user_revision_ready: {
      label: "\u7528\u6237\u4FEE\u6539\uFF08\u51C6\u5907\uFF09",
      placeholder: "\u51C6\u5907\u4FEE\u6539\u8BBE\u8BA1...",
      inputEnabled: false
    },
    user_revision_editing: {
      label: "\u7528\u6237\u4FEE\u6539\uFF08\u7F16\u8F91\u4E2D\uFF09",
      placeholder: "\u6B63\u5728\u4FEE\u6539\u8BBE\u8BA1...",
      inputEnabled: true
    },
    user_revision_done: {
      label: "\u7528\u6237\u4FEE\u6539\uFF08\u5B8C\u6210\uFF09",
      placeholder: "\u4FEE\u6539\u5B8C\u6210",
      inputEnabled: false
    },
    chapter_prep_ready: {
      label: "\u7AE0\u8282\u51C6\u5907\uFF08\u51C6\u5907\uFF09",
      placeholder: "\u51C6\u5907\u5F00\u59CB\u7AE0\u8282...",
      inputEnabled: false
    },
    chapter_prep_running: {
      label: "\u7AE0\u8282\u51C6\u5907\uFF08\u8FDB\u884C\u4E2D\uFF09",
      placeholder: "AI \u6B63\u5728\u51C6\u5907\u7AE0\u8282...",
      inputEnabled: false
    },
    chapter_prep_done: {
      label: "\u7AE0\u8282\u51C6\u5907\uFF08\u5B8C\u6210\uFF09",
      placeholder: "\u7AE0\u8282\u51C6\u5907\u5B8C\u6210",
      inputEnabled: false
    },
    chapter_plan_ready: {
      label: "\u7AE0\u8282\u89C4\u5212\uFF08\u51C6\u5907\uFF09",
      placeholder: "\u51C6\u5907\u751F\u6210\u7AE0\u8282\u89C4\u5212...",
      inputEnabled: false
    },
    chapter_plan_running: {
      label: "\u7AE0\u8282\u89C4\u5212\uFF08\u751F\u6210\u4E2D\uFF09",
      placeholder: "AI \u6B63\u5728\u751F\u6210\u7AE0\u8282\u89C4\u5212...",
      inputEnabled: false
    },
    chapter_plan_done: {
      label: "\u7AE0\u8282\u89C4\u5212\uFF08\u5B8C\u6210\uFF09",
      placeholder: "\u7AE0\u8282\u89C4\u5212\u5B8C\u6210\uFF0C\u8BF7\u5BA1\u6279",
      inputEnabled: false
    },
    block_write_ready: {
      label: "\u5206\u5757\u5199\u4F5C\uFF08\u51C6\u5907\uFF09",
      placeholder: "\u51C6\u5907\u5F00\u59CB\u5199\u4F5C...",
      inputEnabled: false
    },
    block_write_running: {
      label: "\u5206\u5757\u5199\u4F5C\uFF08\u8FDB\u884C\u4E2D\uFF09",
      placeholder: "AI \u6B63\u5728\u7EED\u5199...",
      inputEnabled: false
    },
    block_write_done: {
      label: "\u5206\u5757\u5199\u4F5C\uFF08\u5B8C\u6210\uFF09",
      placeholder: "\u5199\u4F5C\u5B8C\u6210",
      inputEnabled: false
    },
    block_check_ready: {
      label: "\u5206\u5757\u8BC4\u4F30\uFF08\u51C6\u5907\uFF09",
      placeholder: "\u51C6\u5907\u8BC4\u4F30\u5185\u5BB9...",
      inputEnabled: false
    },
    block_check_running: {
      label: "\u5206\u5757\u8BC4\u4F30\uFF08\u8FDB\u884C\u4E2D\uFF09",
      placeholder: "AI \u6B63\u5728\u8BC4\u4F30...",
      inputEnabled: false
    },
    block_check_done: {
      label: "\u5206\u5757\u8BC4\u4F30\uFF08\u5B8C\u6210\uFF09",
      placeholder: "\u8BC4\u4F30\u5B8C\u6210",
      inputEnabled: false
    },
    chapter_complete: {
      label: "\u7AE0\u8282\u5B8C\u6210",
      placeholder: "\u672C\u7AE0\u5DF2\u5B8C\u6210",
      inputEnabled: false
    },
    chapter_complete_running: {
      label: "\u7AE0\u8282\u5B8C\u6210\u5904\u7406\u4E2D",
      placeholder: "\u6B63\u5728\u5904\u7406\u7AE0\u8282\u5B8C\u6210...",
      inputEnabled: false
    },
    completion_ready: {
      label: "\u5B8C\u7ED3\u51C6\u5907",
      placeholder: "\u51C6\u5907\u5B8C\u7ED3\u5C0F\u8BF4...",
      inputEnabled: false
    },
    completion_running: {
      label: "\u5B8C\u7ED3\u5904\u7406\u4E2D",
      placeholder: "\u6B63\u5728\u751F\u6210\u5B8C\u7ED3\u5185\u5BB9...",
      inputEnabled: false
    },
    completion_done: {
      label: "\u5B8C\u7ED3\u5B8C\u6210",
      placeholder: "\u5C0F\u8BF4\u5DF2\u5B8C\u6210",
      inputEnabled: false
    },
    completed: {
      label: "\u5DF2\u5B8C\u6210",
      placeholder: "\u5C0F\u8BF4\u521B\u4F5C\u5B8C\u6210\uFF01",
      inputEnabled: false
    }
  }, Zs = U([
    "ai_direct",
    "ai_guided",
    "user_polish",
    "roleplay"
  ]), Xs = M({
    timePeriod: f().optional().describe("\u65F6\u4EE3\u80CC\u666F"),
    socialSystem: f().optional().describe("\u793E\u4F1A\u5236\u5EA6"),
    techSystem: f().optional().describe("\u6280\u672F\u4F53\u7CFB"),
    powerSystem: f().optional().describe("\u80FD\u529B\u4F53\u7CFB"),
    otherSettings: f().optional().describe("\u5176\u4ED6\u8BBE\u5B9A")
  }), Qs = M({
    id: f().describe("\u89D2\u8272 ID"),
    name: f().describe("\u89D2\u8272\u540D\u79F0"),
    role: f().describe("\u89D2\u8272\u5B9A\u4F4D\uFF08\u4E3B\u89D2/\u914D\u89D2/\u53CD\u6D3E\u7B49\uFF09"),
    description: f().describe("\u89D2\u8272\u8BE6\u7EC6\u63CF\u8FF0"),
    importedFrom: f().optional().describe("\u5982\u679C\u4ECE\u89D2\u8272\u5E93\u5BFC\u5165\uFF0C\u8BB0\u5F55\u6765\u6E90 ID")
  }), en = M({
    mainIdea: f().describe("\u4E3B\u65E8"),
    intention: f().describe("\u7ACB\u610F"),
    style: f().describe("\u98CE\u683C")
  }), tn = M({
    id: f().describe("\u60C5\u8282\u70B9 ID"),
    name: f().describe("\u60C5\u8282\u540D\u79F0"),
    description: f().describe("\u60C5\u8282\u63CF\u8FF0"),
    order: I().describe("\u987A\u5E8F\u7F16\u53F7")
  }), sn = M({
    structure: f().optional().describe("\u6545\u4E8B\u7ED3\u6784\uFF08\u5982\uFF1A\u4E09\u5E55\u5267\u3001\u82F1\u96C4\u4E4B\u65C5\u7B49\uFF09"),
    keyPlots: L(tn).describe("\u5173\u952E\u60C5\u8282\u70B9\u5217\u8868"),
    rawText: f().optional().describe("\u539F\u59CB\u6587\u672C\uFF08Markdown \u6216 YAML\uFF09"),
    format: U([
      "markdown",
      "yaml"
    ]).optional().describe("\u683C\u5F0F\u7C7B\u578B")
  }), nn = M({
    id: f().describe("\u7AE0\u8282 ID"),
    chapterNumber: I().describe("\u7AE0\u8282\u53F7"),
    title: f().describe("\u7AE0\u8282\u6807\u9898"),
    summary: f().describe("\u7AE0\u8282\u6458\u8981"),
    keyEvents: L(f()).describe("\u5173\u952E\u4E8B\u4EF6\u5217\u8868")
  }), rn = M({
    type: U([
      "\u597D\u5947",
      "\u4F0F\u7B14",
      "\u4E3B\u7EBF",
      "\u7EBF\u7D22",
      "\u7A81\u7834"
    ]).describe("\u5174\u8DA3\u7C7B\u578B"),
    content: f().describe("\u5174\u8DA3\u70B9\u5185\u5BB9"),
    priority: I().describe("\u4F18\u5148\u7EA7 1-10")
  }), an = M({
    chapterNumber: I().describe("\u7AE0\u8282\u53F7"),
    blockIndex: I().describe("\u5206\u5757\u7D22\u5F15"),
    emotion: f().describe("\u60C5\u7EEA\u7C7B\u578B\uFF08\u5982\uFF1A\u7D27\u5F20\u3001\u8212\u7F13\u3001\u6FC0\u6602\u7B49\uFF09"),
    intensity: I().describe("\u5F3A\u5EA6 1-10")
  }), on = M({
    id: f().describe("\u4F0F\u7B14 ID"),
    content: f().describe("\u4F0F\u7B14\u5185\u5BB9"),
    introducedAt: M({
      chapter: I(),
      block: I()
    }).describe("\u5F15\u5165\u4F4D\u7F6E"),
    resolvedAt: M({
      chapter: I(),
      block: I()
    }).optional().describe("\u89E3\u51B3\u4F4D\u7F6E"),
    status: U([
      "pending",
      "in-progress",
      "resolved"
    ]).describe("\u72B6\u6001"),
    importance: U([
      "low",
      "medium",
      "high"
    ]).describe("\u91CD\u8981\u7A0B\u5EA6")
  }), cn = M({
    type: U([
      "\u89D2\u8272",
      "\u5730\u70B9",
      "\u7269\u54C1"
    ]).describe("\u5B9E\u4F53\u7C7B\u578B"),
    name: f().describe("\u540D\u79F0"),
    alias: L(f()).optional().describe("\u522B\u540D"),
    description: L(f()).describe("\u63CF\u8FF0\u5217\u8868"),
    relatedEntities: L(f()).optional().describe("\u76F8\u5173\u5B9E\u4F53")
  }), ln = M({
    type: U([
      "\u72B6\u6001\u58F0\u660E",
      "\u72B6\u6001\u53D8\u5316",
      "\u5173\u7CFB\u58F0\u660E",
      "\u5173\u7CFB\u53D8\u5316"
    ]).describe("\u4E8B\u4EF6\u7C7B\u578B"),
    description: f().describe("\u4E8B\u4EF6\u63CF\u8FF0"),
    chapterNumber: I().describe("\u53D1\u751F\u7AE0\u8282"),
    timestamp: I().describe("\u8BB0\u5F55\u65F6\u95F4\u6233")
  }), dn = M({
    type: U([
      "\u65F6\u4EE3\u80CC\u666F",
      "\u793E\u4F1A\u5236\u5EA6",
      "\u6280\u672F\u4F53\u7CFB",
      "\u80FD\u529B\u4F53\u7CFB",
      "\u5176\u4ED6"
    ]).describe("\u89C4\u5219\u7C7B\u578B"),
    name: f().describe("\u89C4\u5219\u540D\u79F0"),
    description: f().describe("\u89C4\u5219\u63CF\u8FF0")
  }), mn = M({
    entities: L(cn).describe("\u5B9E\u4F53\u5217\u8868"),
    events: L(ln).describe("\u4E8B\u4EF6\u5217\u8868"),
    rules: L(dn).describe("\u89C4\u5219\u5217\u8868")
  }), pn = M({
    id: f().describe("\u5206\u5757 ID"),
    content: f().describe("\u5206\u5757\u5185\u5BB9"),
    wordCount: I().describe("\u5B57\u6570"),
    writeMode: Zs.describe("\u5199\u4F5C\u6A21\u5F0F"),
    createdAt: I().describe("\u521B\u5EFA\u65F6\u95F4")
  }), un = M({
    id: f().describe("\u7AE0\u8282 ID"),
    number: I().describe("\u7AE0\u8282\u53F7"),
    title: f().describe("\u7AE0\u8282\u6807\u9898"),
    status: U([
      "planning",
      "writing",
      "reviewing",
      "completed"
    ]).describe("\u72B6\u6001"),
    wordCount: I().describe("\u5F53\u524D\u5B57\u6570"),
    targetWordCount: I().describe("\u76EE\u6807\u5B57\u6570 3000-5000"),
    blocks: L(pn).describe("\u5206\u5757\u5217\u8868"),
    plan: f().optional().describe("\u7AE0\u8282\u89C4\u5212"),
    summary: f().optional().describe("\u7AE0\u8282\u6458\u8981")
  });
  M({
    planCompliance: I().describe("\u4E0E\u7AE0\u8282\u89C4\u5212\u7B26\u5408\u5EA6 0-10"),
    settingCompliance: I().describe("\u4E0E\u6545\u4E8B\u8BBE\u5B9A\u7B26\u5408\u5EA6 0-10"),
    interestAlignment: I().describe("\u4E0E\u8BFB\u8005\u5174\u8DA3\u70B9\u7B26\u5408\u5EA6 0-10"),
    emotionAlignment: I().describe("\u4E0E\u60C5\u7EEA\u8BBE\u8BA1\u7B26\u5408\u5EA6 0-10"),
    suggestions: L(f()).describe("AI \u5EFA\u8BAE")
  });
  M({
    themeFocus: I().describe("\u7AE0\u8282\u4E3B\u9898\u805A\u7126\u7A0B\u5EA6 0-10"),
    outlineCompliance: I().describe("\u4E0E\u5927\u7EB2\u7B26\u5408\u5EA6 0-10"),
    settingCompliance: I().describe("\u4E0E\u6545\u4E8B\u8BBE\u5B9A\u7B26\u5408\u5EA6 0-10"),
    interestAlignment: I().describe("\u4E0E\u8BFB\u8005\u5174\u8DA3\u70B9\u7B26\u5408\u5EA6 0-10"),
    emotionAlignment: I().describe("\u4E0E\u60C5\u7EEA\u8BBE\u8BA1\u7B26\u5408\u5EA6 0-10"),
    suggestions: L(f()).describe("AI \u5EFA\u8BAE")
  });
  const hn = M({
    projectName: f().describe("\u5C0F\u8BF4\u9879\u76EE\u540D\u79F0"),
    worldview: Xs.optional().describe("\u4E16\u754C\u89C2"),
    keyCharacters: L(Qs).describe("\u5173\u952E\u89D2\u8272\u5217\u8868"),
    theme: en.optional().describe("\u4E3B\u9898"),
    plotOutline: sn.optional().describe("\u60C5\u8282\u8109\u7EDC"),
    chapterOutline: L(nn).optional().describe("\u7AE0\u8282\u5927\u7EB2"),
    hasOutline: ue().default(false).describe("\u662F\u5426\u6709\u5927\u7EB2")
  }), xn = M({
    currentPhase: Vs.describe("\u5F53\u524D\u9636\u6BB5"),
    currentUIState: qs.describe("\u5F53\u524D UI \u72B6\u6001"),
    designCompleted: ue().default(false).describe("\u8BBE\u8BA1\u662F\u5426\u5B8C\u6210"),
    reviewPassed: ue().default(false).describe("\u8BC4\u5BA1\u662F\u5426\u901A\u8FC7"),
    currentChapterIndex: I().default(0).describe("\u5F53\u524D\u7AE0\u8282\u7D22\u5F15"),
    currentChapter: un.optional().describe("\u5F53\u524D\u7AE0\u8282"),
    progressTracking: M({
      completedChapters: I().default(0).describe("\u5DF2\u5B8C\u6210\u7AE0\u8282\u6570"),
      totalPlannedChapters: I().default(0).describe("\u8BA1\u5212\u603B\u7AE0\u8282\u6570"),
      totalWordCount: I().default(0).describe("\u603B\u5B57\u6570"),
      currentInterestPoints: L(rn).describe("\u5F53\u524D\u5174\u8DA3\u70B9"),
      emotionSequence: L(an).describe("\u60C5\u7EEA\u5E8F\u5217"),
      foreshadows: L(on).describe("\u4F0F\u7B14\u5217\u8868")
    }).describe("\u8FDB\u5EA6\u8FFD\u8E2A"),
    knowledgeBase: mn.describe("\u77E5\u8BC6\u5E93"),
    isCompleted: ue().default(false).describe("\u662F\u5426\u5B8C\u7ED3"),
    completionReason: U([
      "manual",
      "outline_finished",
      "natural_ending"
    ]).optional().describe("\u5B8C\u7ED3\u539F\u56E0"),
    historySummary: f().default("").describe("\u5386\u53F2\u6458\u8981"),
    chapterSummaries: L(M({
      chapterNumber: I(),
      summary: f()
    })).describe("\u7AE0\u8282\u6458\u8981\u5217\u8868"),
    tempData: ut(f(), ye()).optional().describe("\u4E34\u65F6\u6570\u636E")
  });
  it.extend({
    mode: ht("novel-writing").describe("\u6A21\u5F0F"),
    modeConfig: hn.describe("Novel Writing \u6A21\u5F0F\u914D\u7F6E"),
    modeState: xn.describe("Novel Writing \u6A21\u5F0F\u72B6\u6001")
  });
  function gn(t) {
    return t.trim().replace(/<think>[\s\S]*<\/think>/g, "").trim().replace(/^[\s]*```[^\n]*|```[\s]*$/g, "").trim();
  }
  let ve, pe, _n, fn, wn, Sn, yn, Nn, vn, bn, In, jn, Cn, Tn, An;
  ve = (t) => {
    const s = gn(t);
    try {
      return Ce.parse(s);
    } catch (n) {
      try {
        return s === "" ? "" : Ce.parse(s.slice(1));
      } catch (r) {
        return console.error({
          error1: n,
          error2: r,
          newStr: s,
          jsonStr: t
        }), s;
      }
    }
  };
  pe = ({ isOpen: t, onClose: s, onConfirm: n, title: r = "AI \u8F85\u52A9\u751F\u6210", description: a = "\u8BF7\u8F93\u5165\u60A8\u7684\u8981\u6C42\u6216\u5173\u952E\u8BCD\uFF0CAI \u5C06\u6839\u636E\u60A8\u7684\u63D0\u793A\u8FDB\u884C\u521B\u4F5C\u3002", placeholder: i = "\u4F8B\u5982\uFF1A\u5E0C\u671B\u65F6\u4EE3\u80CC\u666F\u662F\u84B8\u6C7D\u670B\u514B\u98CE\u683C\uFF0C\u5E26\u6709\u4E00\u4E9B\u514B\u82CF\u9C81\u5143\u7D20...", defaultValue: l = "" }) => {
    const [x, p] = T.useState(l), g = () => {
      n(x), s();
    };
    return e.jsx(gt, {
      open: t,
      onOpenChange: (w) => !w && s(),
      children: e.jsxs(_t, {
        className: "sm:max-w-[500px]",
        children: [
          e.jsxs(ft, {
            children: [
              e.jsxs(wt, {
                className: "flex items-center gap-2",
                children: [
                  e.jsx(z, {
                    className: "w-5 h-5 text-primary"
                  }),
                  r
                ]
              }),
              e.jsx(St, {
                children: a
              })
            ]
          }),
          e.jsx("div", {
            className: "py-4",
            children: e.jsx(G, {
              value: x,
              onChange: (w) => p(w.target.value),
              placeholder: i,
              rows: 5,
              className: "resize-none",
              autoFocus: true
            })
          }),
          e.jsxs(yt, {
            children: [
              e.jsx(j, {
                variant: "outline",
                onClick: s,
                children: "\u53D6\u6D88"
              }),
              e.jsx(j, {
                onClick: g,
                children: "\u786E\u8BA4\u751F\u6210"
              })
            ]
          })
        ]
      })
    });
  };
  _n = () => {
    var _a, _b, _c, _d, _e2;
    const t = Y(o), s = se((c) => c.config), [n, r] = T.useState(false), [a, i] = T.useState(false), l = (_b = (_a = t.currentSession) == null ? void 0 : _a.modeConfig) == null ? void 0 : _b.worldview, x = (_e2 = (_d = (_c = t.currentSession) == null ? void 0 : _c.modeState) == null ? void 0 : _d.tempData) == null ? void 0 : _e2.latestReviewSuggestions, [p, g] = T.useState({
      timePeriod: "",
      socialSystem: "",
      techSystem: "",
      powerSystem: "",
      otherSettings: ""
    });
    T.useEffect(() => {
      l && g({
        timePeriod: l.timePeriod || "",
        socialSystem: l.socialSystem || "",
        techSystem: l.techSystem || "",
        powerSystem: l.powerSystem || "",
        otherSettings: l.otherSettings || ""
      });
    }, [
      l
    ]);
    const w = (c, v) => {
      g((S) => ({
        ...S,
        [c]: v
      }));
    }, y = () => {
      o.updateModeConfig({
        worldview: {
          ...p
        }
      });
    }, d = async (c) => {
      r(true);
      try {
        const v = o.contextManager;
        if (!o.currentSession || !v) {
          C.error("\u4F1A\u8BDD\u672A\u521D\u59CB\u5316");
          return;
        }
        const S = Object.entries(p).filter(([N, b]) => b && b.trim()).map(([N, b]) => `${N}: ${b}`).join(`
`);
        let u = "";
        c && (u += `\u7528\u6237\u671F\u671B\uFF1A${c}
`), S && (u += `\u73B0\u6709\u8BBE\u5B9A\uFF1A
${S}`), u && o.updateTempData({
          worldviewHint: u
        });
        const h = Z.makeMessagesForWorldviewGeneration(o.currentSession, v);
        let m = "";
        await q(s, h.map((N) => ({
          role: N.role,
          content: N.content,
          id: k()
        })), [], (N, b) => {
          m = b;
        });
        const _ = ve(m);
        if (_ && typeof _ == "object") {
          const N = {
            timePeriod: _.timePeriod || p.timePeriod || "",
            socialSystem: _.socialSystem || p.socialSystem || "",
            techSystem: _.techSystem || p.techSystem || "",
            powerSystem: _.powerSystem || p.powerSystem || "",
            otherSettings: _.otherSettings || p.otherSettings || ""
          };
          o.updateModeConfig({
            worldview: N
          }), C.success(x ? "AI \u5DF2\u6839\u636E\u8BC4\u5BA1\u5EFA\u8BAE\u4F18\u5316\u4E16\u754C\u89C2" : "AI \u751F\u6210\u4E16\u754C\u89C2\u6210\u529F");
        } else o.updateModeConfig({
          worldview: {
            ...p,
            otherSettings: (p.otherSettings ? p.otherSettings + `

` : "") + m
          }
        }), C.info("\u672A\u80FD\u5B8C\u5168\u89E3\u6790 JSON\uFF0C\u5185\u5BB9\u5DF2\u5B58\u5165\u5176\u4ED6\u8BBE\u5B9A");
      } catch (v) {
        console.error("AI generation error:", v), C.error("AI \u751F\u6210\u5931\u8D25");
      } finally {
        r(false), o.updateTempData({
          worldviewHint: void 0
        });
      }
    };
    return e.jsxs("div", {
      className: "space-y-4",
      children: [
        e.jsx("div", {
          className: "flex justify-end",
          children: e.jsx(j, {
            size: "sm",
            variant: "outline",
            onClick: () => i(true),
            disabled: n,
            children: n ? e.jsxs(e.Fragment, {
              children: [
                e.jsx(H, {
                  className: "w-4 h-4 mr-2 animate-spin"
                }),
                "\u751F\u6210\u4E2D..."
              ]
            }) : e.jsxs(e.Fragment, {
              children: [
                e.jsx(z, {
                  className: "w-4 h-4 mr-2"
                }),
                x ? "\u6839\u636E\u5EFA\u8BAE\u91CD\u65B0\u751F\u6210" : "\u4E00\u952E AI \u751F\u6210/\u8865\u5168"
              ]
            })
          })
        }),
        e.jsx(pe, {
          isOpen: a,
          onClose: () => i(false),
          onConfirm: d,
          title: "\u4E16\u754C\u89C2 AI \u751F\u6210",
          description: "\u8BF7\u8F93\u5165\u60A8\u5BF9\u4E16\u754C\u89C2\u7684\u671F\u671B\uFF08\u5982\uFF1A\u8D5B\u535A\u670B\u514B\u3001\u514B\u82CF\u9C81\u3001\u4E1C\u65B9\u7384\u5E7B\u7B49\uFF09\uFF0CAI \u5C06\u4E3A\u60A8\u751F\u6210\u5B8C\u6574\u7684\u8BBE\u5B9A\u3002"
        }),
        e.jsxs("div", {
          className: "space-y-4",
          children: [
            e.jsxs("div", {
              className: "space-y-2",
              children: [
                e.jsx(W, {
                  children: "\u65F6\u4EE3\u80CC\u666F"
                }),
                e.jsx(G, {
                  value: p.timePeriod,
                  onChange: (c) => w("timePeriod", c.target.value),
                  onBlur: y,
                  placeholder: "\u63CF\u8FF0\u6545\u4E8B\u53D1\u751F\u7684\u65F6\u4EE3\u3001\u5730\u7406\u73AF\u5883\u7B49...",
                  rows: 2,
                  className: "resize-none"
                })
              ]
            }),
            e.jsxs("div", {
              className: "space-y-2",
              children: [
                e.jsx(W, {
                  children: "\u793E\u4F1A\u4F53\u7CFB"
                }),
                e.jsx(G, {
                  value: p.socialSystem,
                  onChange: (c) => w("socialSystem", c.target.value),
                  onBlur: y,
                  placeholder: "\u653F\u6CBB\u5236\u5EA6\u3001\u7ECF\u6D4E\u72B6\u51B5\u3001\u6587\u5316\u98CE\u4FD7...",
                  rows: 3,
                  className: "resize-none"
                })
              ]
            }),
            e.jsxs("div", {
              className: "space-y-2",
              children: [
                e.jsx(W, {
                  children: "\u6280\u672F\u4F53\u7CFB"
                }),
                e.jsx(G, {
                  value: p.techSystem,
                  onChange: (c) => w("techSystem", c.target.value),
                  onBlur: y,
                  placeholder: "\u79D1\u6280\u6C34\u5E73\u3001\u4EA4\u901A\u5DE5\u5177\u3001\u901A\u8BAF\u65B9\u5F0F...",
                  rows: 3,
                  className: "resize-none"
                })
              ]
            }),
            e.jsxs("div", {
              className: "space-y-2",
              children: [
                e.jsx(W, {
                  children: "\u529B\u91CF\u4F53\u7CFB"
                }),
                e.jsx(G, {
                  value: p.powerSystem,
                  onChange: (c) => w("powerSystem", c.target.value),
                  onBlur: y,
                  placeholder: "\u9B54\u6CD5\u3001\u6B66\u529F\u3001\u5F02\u80FD\u6216\u5176\u4ED6\u8D85\u81EA\u7136\u529B\u91CF\u8BBE\u5B9A...",
                  rows: 3,
                  className: "resize-none"
                })
              ]
            }),
            e.jsxs("div", {
              className: "space-y-2",
              children: [
                e.jsx(W, {
                  children: "\u5176\u4ED6\u8BBE\u5B9A"
                }),
                e.jsx(G, {
                  value: p.otherSettings,
                  onChange: (c) => w("otherSettings", c.target.value),
                  onBlur: y,
                  placeholder: "\u4EFB\u4F55\u5176\u4ED6\u91CD\u8981\u7684\u4E16\u754C\u89C2\u8865\u5145...",
                  rows: 4,
                  className: "resize-none"
                })
              ]
            })
          ]
        }),
        x && e.jsxs("div", {
          className: "mt-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded text-xs text-yellow-600",
          children: [
            e.jsx("strong", {
              children: "\u5F53\u524D\u53C2\u8003\u7684\u8BC4\u5BA1\u5EFA\u8BAE\uFF1A"
            }),
            e.jsx("p", {
              className: "mt-1 line-clamp-2",
              children: x
            })
          ]
        })
      ]
    });
  };
  fn = ({ character: t, onUpdate: s, onRemove: n, onExport: r, onEnhance: a, isEnhancing: i }) => {
    const [l, x] = T.useState(t);
    T.useEffect(() => {
      x(t);
    }, [
      t
    ]);
    const p = (w, y) => {
      x((d) => ({
        ...d,
        [w]: y
      }));
    }, g = () => {
      (l.name !== t.name || l.role !== t.role || l.description !== t.description) && s(t.id, l);
    };
    return e.jsx(O, {
      className: "p-4 space-y-3",
      children: e.jsxs("div", {
        className: "flex justify-between items-start",
        children: [
          e.jsxs("div", {
            className: "flex-1 space-y-3",
            children: [
              e.jsxs("div", {
                className: "grid grid-cols-2 gap-3",
                children: [
                  e.jsxs("div", {
                    className: "space-y-2",
                    children: [
                      e.jsx(W, {
                        children: "\u89D2\u8272\u540D"
                      }),
                      e.jsx(ke, {
                        placeholder: "\u4F8B\u5982\uFF1A\u5F20\u4E09",
                        value: l.name,
                        onChange: (w) => p("name", w.target.value),
                        onBlur: g
                      })
                    ]
                  }),
                  e.jsxs("div", {
                    className: "space-y-2",
                    children: [
                      e.jsx(W, {
                        children: "\u5B9A\u4F4D/\u89D2\u8272"
                      }),
                      e.jsx(ke, {
                        placeholder: "\u4F8B\u5982\uFF1A\u4E3B\u89D2\u3001\u914D\u89D2\u3001\u53CD\u6D3E",
                        value: l.role,
                        onChange: (w) => p("role", w.target.value),
                        onBlur: g
                      })
                    ]
                  })
                ]
              }),
              e.jsxs("div", {
                className: "space-y-2",
                children: [
                  e.jsx(W, {
                    children: "\u89D2\u8272\u63CF\u8FF0"
                  }),
                  e.jsx(G, {
                    placeholder: "\u6027\u683C\u3001\u80CC\u666F\u3001\u7279\u70B9\u3001\u5173\u7CFB\u7B49...",
                    value: l.description,
                    onChange: (w) => p("description", w.target.value),
                    onBlur: g,
                    rows: 3
                  })
                ]
              })
            ]
          }),
          e.jsxs("div", {
            className: "flex flex-col gap-2 ml-2",
            children: [
              e.jsx(j, {
                size: "sm",
                variant: "ghost",
                onClick: () => a(t.id),
                disabled: i,
                title: "AI \u5B8C\u5584\u89D2\u8272",
                children: i ? e.jsx(H, {
                  className: "w-4 h-4 animate-spin text-primary"
                }) : e.jsx(he, {
                  className: "w-4 h-4 text-primary"
                })
              }),
              e.jsx(j, {
                size: "sm",
                variant: "ghost",
                onClick: () => n(t.id),
                title: "\u5220\u9664\u89D2\u8272",
                children: e.jsx(bt, {
                  className: "w-4 h-4 text-destructive"
                })
              }),
              e.jsx(j, {
                size: "sm",
                variant: "ghost",
                onClick: () => r(l),
                title: "\u5BFC\u51FA\u5230\u89D2\u8272\u5E93",
                children: e.jsx(It, {
                  className: "w-4 h-4 text-primary"
                })
              })
            ]
          })
        ]
      })
    });
  };
  wn = () => {
    var _a, _b, _c, _d, _e2;
    const t = Y(o), s = se((m) => m.config), [n, r] = T.useState(false), [a, i] = T.useState(false), [l, x] = T.useState(null), p = T.useRef(0), g = ((_b = (_a = t.currentSession) == null ? void 0 : _a.modeConfig) == null ? void 0 : _b.keyCharacters) || [], w = (_e2 = (_d = (_c = t.currentSession) == null ? void 0 : _c.modeState) == null ? void 0 : _d.tempData) == null ? void 0 : _e2.latestReviewSuggestions, y = () => {
      const m = {
        id: k(),
        name: "",
        role: "",
        description: ""
      };
      o.updateModeConfig({
        keyCharacters: [
          ...g,
          m
        ]
      });
    }, d = async () => {
      try {
        const _ = await (await je.characters.getTable()).toArray();
        if (_.length === 0) {
          C.error("\u89D2\u8272\u5E93\u4E3A\u7A7A\uFF0C\u8BF7\u5148\u521B\u5EFA\u89D2\u8272\u5361");
          return;
        }
        const N = new Set(g.map((E) => E.name)), b = _.find((E) => !N.has(E.name));
        if (b) {
          const E = {
            id: k(),
            name: b.name,
            role: "\u4E3B\u8981\u89D2\u8272",
            description: b.description || b.personality || "",
            importedFrom: b.id
          };
          o.updateModeConfig({
            keyCharacters: [
              ...g,
              E
            ]
          }), C.success(`\u5DF2\u4ECE\u89D2\u8272\u5E93\u5BFC\u5165\uFF1A${b.name}`);
        } else C.info("\u89D2\u8272\u5E93\u4E2D\u7684\u89D2\u8272\u5DF2\u5168\u90E8\u5728\u5217\u8868\u4E2D");
      } catch (m) {
        console.error("Import error:", m), C.error("\u5BFC\u5165\u5931\u8D25");
      }
    }, c = async (m) => {
      if (!m.name || !m.description) {
        C.error("\u89D2\u8272\u540D\u79F0\u548C\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A");
        return;
      }
      try {
        const _ = await je.characters.getTable();
        if (await _.where("name").equals(m.name).first()) {
          C.error(`\u89D2\u8272\u5E93\u4E2D\u5DF2\u5B58\u5728\u540D\u4E3A\u201C${m.name}\u201D\u7684\u89D2\u8272`);
          return;
        }
        await _.add({
          id: k(),
          name: m.name,
          description: m.description,
          personality: m.description,
          first_mes: `\u6211\u662F${m.name}\uFF0C${m.role}\u3002`,
          avatar: "",
          chat_history: [],
          tags: [
            "\u5C0F\u8BF4\u5BFC\u51FA",
            m.role
          ],
          creator_notes: "\u4ECE\u5C0F\u8BF4\u6A21\u5F0F\u5BFC\u51FA",
          system_prompt: "",
          post_history_instructions: "",
          alternate_greetings: [],
          character_book: void 0,
          creator: "User",
          character_version: "1.0.0",
          extensions: {}
        }), C.success(`\u5DF2\u5C06\u201C${m.name}\u201D\u5BFC\u51FA\u5230\u89D2\u8272\u5E93`);
      } catch (_) {
        console.error("Export error:", _), C.error("\u5BFC\u51FA\u5931\u8D25");
      }
    }, v = (m) => {
      o.updateModeConfig({
        keyCharacters: g.filter((_) => _.id !== m)
      });
    }, S = (m, _) => {
      o.updateModeConfig({
        keyCharacters: g.map((N) => N.id === m ? {
          ...N,
          ..._
        } : N)
      });
    }, u = async (m) => {
      x(m);
      try {
        const _ = o.currentSession, N = o.contextManager;
        if (!_ || !N) return;
        o.updateTempData({
          targetCharacterId: m
        });
        const b = Z.makeMessagesForCharacterEnhancement(_, N);
        let E = "";
        await q(s, b.map((Q) => ({
          role: Q.role,
          content: Q.content,
          id: k()
        })), [], (Q, le) => {
          E = le;
        });
        const X = ve(E);
        if (X && typeof X == "object") S(m, {
          name: X.name || void 0,
          role: X.role || void 0,
          description: X.description || void 0
        }), C.success("\u89D2\u8272\u5B8C\u5584\u6210\u529F");
        else {
          const Q = g.find((le) => le.id === m);
          Q && S(m, {
            description: (Q.description ? Q.description + `

` : "") + E
          }), C.info("\u5185\u5BB9\u5DF2\u8FFD\u52A0\u5230\u89D2\u8272\u63CF\u8FF0");
        }
      } catch (_) {
        console.error("AI enhancement error:", _), C.error("AI \u5B8C\u5584\u5931\u8D25");
      } finally {
        x(null), o.updateTempData({
          targetCharacterId: void 0
        });
      }
    }, h = async (m) => {
      r(true), p.current = 0;
      try {
        const _ = o.contextManager;
        if (!o.currentSession || !_) {
          C.error("\u4F1A\u8BDD\u672A\u521D\u59CB\u5316");
          return;
        }
        m && o.updateTempData({
          characterHint: m
        });
        const N = Z.makeMessagesForCharactersBatchGeneration(o.currentSession, _);
        await q(s, N.map((b) => ({
          role: b.role,
          content: b.content,
          id: k()
        })), [], (b, E) => {
        }), await o.updateSessionInDB(), C.success(w ? "AI \u5DF2\u6839\u636E\u8BC4\u5BA1\u5EFA\u8BAE\u4F18\u5316\u5E76\u751F\u6210\u89D2\u8272" : "AI \u89D2\u8272\u751F\u6210\u5B8C\u6210");
      } catch (_) {
        console.error("AI generation error:", _), C.error("AI \u751F\u6210\u5931\u8D25");
      } finally {
        r(false), o.updateTempData({
          characterHint: void 0
        });
      }
    };
    return e.jsxs("div", {
      className: "space-y-4",
      children: [
        e.jsxs("div", {
          className: "flex flex-wrap gap-2 justify-between items-center",
          children: [
            e.jsxs("div", {
              className: "flex gap-2",
              children: [
                e.jsxs(j, {
                  size: "sm",
                  variant: "outline",
                  onClick: y,
                  children: [
                    e.jsx(Nt, {
                      className: "w-4 h-4 mr-2"
                    }),
                    "\u624B\u52A8\u6DFB\u52A0"
                  ]
                }),
                e.jsxs(j, {
                  size: "sm",
                  variant: "outline",
                  onClick: d,
                  children: [
                    e.jsx(vt, {
                      className: "w-4 h-4 mr-2"
                    }),
                    "\u4ECE\u89D2\u8272\u5E93\u5BFC\u5165"
                  ]
                })
              ]
            }),
            e.jsx(j, {
              size: "sm",
              variant: "outline",
              onClick: () => i(true),
              disabled: n,
              children: n ? e.jsxs(e.Fragment, {
                children: [
                  e.jsx(H, {
                    className: "w-4 h-4 mr-2 animate-spin"
                  }),
                  "AI \u6279\u91CF\u751F\u6210\u4E2D..."
                ]
              }) : e.jsxs(e.Fragment, {
                children: [
                  e.jsx(z, {
                    className: "w-4 h-4 mr-2"
                  }),
                  w ? "\u6839\u636E\u5EFA\u8BAE\u91CD\u65B0\u751F\u6210" : "AI \u6279\u91CF\u751F\u6210"
                ]
              })
            })
          ]
        }),
        e.jsx(pe, {
          isOpen: a,
          onClose: () => i(false),
          onConfirm: h,
          title: "\u89D2\u8272 AI \u6279\u91CF\u751F\u6210",
          description: "\u8BF7\u8F93\u5165\u60A8\u5BF9\u89D2\u8272\u7684\u671F\u671B\uFF08\u5982\uFF1A\u6027\u683C\u3001\u804C\u4E1A\u3001\u79CD\u65CF\u3001\u5173\u7CFB\u7B49\uFF09\uFF0CAI \u5C06\u4E3A\u60A8\u751F\u6210\u4E00\u7EC4\u89D2\u8272\u3002"
        }),
        w && e.jsxs("div", {
          className: "p-3 bg-yellow-500/10 border border-yellow-500/20 rounded text-xs text-yellow-600",
          children: [
            "\u53C2\u8003\u5EFA\u8BAE\uFF1A",
            w.substring(0, 100),
            "..."
          ]
        }),
        g.length === 0 ? e.jsx("div", {
          className: "text-center py-12 text-muted-foreground",
          children: e.jsx("p", {
            children: "\u6682\u65E0\u89D2\u8272\uFF0C\u70B9\u51FB\u4E0A\u65B9\u6309\u94AE\u6DFB\u52A0\u6216 AI \u751F\u6210"
          })
        }) : e.jsx("div", {
          className: "space-y-4",
          children: g.map((m) => e.jsx(fn, {
            character: m,
            onUpdate: S,
            onRemove: v,
            onExport: c,
            onEnhance: u,
            isEnhancing: l === m.id
          }, m.id))
        }),
        e.jsx("div", {
          className: "text-xs text-muted-foreground p-3 bg-muted/30 rounded",
          children: "\u{1F4A1} \u63D0\u793A\uFF1A\u53EF\u4EE5\u624B\u52A8\u6DFB\u52A0\u89D2\u8272\uFF0C\u4E5F\u53EF\u4EE5\u7528 AI \u6279\u91CF\u751F\u6210\u3002\u89D2\u8272\u53EF\u4EE5\u968F\u65F6\u589E\u5220\u6539\u3002\u70B9\u51FB\u4FDD\u5B58\u56FE\u6807\u53EF\u5C06\u65B0\u89D2\u8272\u5BFC\u51FA\u5230\u5E7F\u573A\u3002"
        })
      ]
    });
  };
  Sn = () => {
    var _a, _b, _c, _d, _e2;
    const t = Y(o), s = se((u) => u.config), [n, r] = T.useState(false), [a, i] = T.useState(false), [l, x] = T.useState(false), p = (_b = (_a = t.currentSession) == null ? void 0 : _a.modeConfig) == null ? void 0 : _b.theme, g = (_e2 = (_d = (_c = t.currentSession) == null ? void 0 : _c.modeState) == null ? void 0 : _d.tempData) == null ? void 0 : _e2.latestReviewSuggestions, [w, y] = T.useState({
      mainIdea: "",
      intention: "",
      style: ""
    });
    T.useEffect(() => {
      p && y({
        mainIdea: p.mainIdea || "",
        intention: p.intention || "",
        style: p.style || ""
      });
    }, [
      p
    ]);
    const d = (u, h) => {
      y((m) => ({
        ...m,
        [u]: h
      }));
    }, c = () => {
      o.updateModeConfig({
        theme: {
          ...w
        }
      });
    }, v = async () => {
      i(true);
      try {
        const u = o.currentSession, h = o.contextManager;
        if (!u || !h) return;
        const m = Z.makeMessagesForThemeAnalysis(u, h);
        let _ = "";
        await q(s, m.map((N) => ({
          role: N.role,
          content: N.content,
          id: k()
        })), [], (N, b) => {
          _ = b;
        }), C.info("AI \u4E3B\u9898\u5206\u6790\u5B8C\u6210", {
          description: _,
          duration: 1e4
        });
      } catch (u) {
        console.error("AI analysis error:", u), C.error("AI \u5206\u6790\u5931\u8D25");
      } finally {
        i(false);
      }
    }, S = async (u) => {
      r(true);
      try {
        const h = o.contextManager;
        if (!o.currentSession || !h) {
          C.error("\u4F1A\u8BDD\u672A\u521D\u59CB\u5316");
          return;
        }
        u && o.updateTempData({
          themeHint: u
        });
        const m = Z.makeMessagesForThemeGeneration(o.currentSession, h);
        let _ = "";
        await q(s, m.map((b) => ({
          role: b.role,
          content: b.content,
          id: k()
        })), [], (b, E) => {
          _ = E;
        });
        const N = ve(_);
        if (N && typeof N == "object") o.updateModeConfig({
          theme: {
            mainIdea: N.mainIdea || "",
            intention: N.intention || "",
            style: N.style || ""
          }
        }), C.success(g ? "AI \u5DF2\u6839\u636E\u8BC4\u5BA1\u5EFA\u8BAE\u4F18\u5316\u4E3B\u9898" : "AI \u751F\u6210\u4E3B\u9898\u6210\u529F");
        else {
          const b = {
            ...w,
            mainIdea: _
          };
          o.updateModeConfig({
            theme: b
          }), C.info("\u5185\u5BB9\u5DF2\u5B58\u5165\u6838\u5FC3\u601D\u60F3");
        }
      } catch (h) {
        console.error("AI generation error:", h), C.error("AI \u751F\u6210\u5931\u8D25");
      } finally {
        r(false), o.updateTempData({
          themeHint: void 0
        });
      }
    };
    return e.jsxs("div", {
      className: "space-y-4",
      children: [
        e.jsxs("div", {
          className: "flex justify-end gap-2",
          children: [
            e.jsx(j, {
              size: "sm",
              variant: "outline",
              onClick: v,
              disabled: a || n,
              children: a ? e.jsxs(e.Fragment, {
                children: [
                  e.jsx(H, {
                    className: "mr-2 h-4 w-4 animate-spin"
                  }),
                  "\u5206\u6790\u4E2D..."
                ]
              }) : e.jsxs(e.Fragment, {
                children: [
                  e.jsx(jt, {
                    className: "mr-2 h-4 w-4"
                  }),
                  "AI \u6DF1\u5EA6\u5206\u6790"
                ]
              })
            }),
            e.jsx(j, {
              size: "sm",
              variant: "outline",
              onClick: () => x(true),
              disabled: n || a,
              children: n ? e.jsxs(e.Fragment, {
                children: [
                  e.jsx(H, {
                    className: "mr-2 h-4 w-4 animate-spin"
                  }),
                  "\u751F\u6210\u4E2D..."
                ]
              }) : e.jsxs(e.Fragment, {
                children: [
                  e.jsx(z, {
                    className: "mr-2 h-4 w-4"
                  }),
                  g ? "\u6839\u636E\u5EFA\u8BAE\u91CD\u65B0\u751F\u6210" : "\u4E00\u952E AI \u751F\u6210"
                ]
              })
            })
          ]
        }),
        e.jsx(pe, {
          isOpen: l,
          onClose: () => x(false),
          onConfirm: S,
          title: "\u4E3B\u9898 AI \u751F\u6210",
          description: "\u8BF7\u8F93\u5165\u60A8\u5BF9\u6545\u4E8B\u4E3B\u9898\u7684\u671F\u671B\uFF08\u5982\uFF1A\u6210\u957F\u3001\u590D\u4EC7\u3001\u7231\u4E0E\u548C\u5E73\u7B49\uFF09\uFF0CAI \u5C06\u4E3A\u60A8\u751F\u6210\u6838\u5FC3\u601D\u60F3\u548C\u521B\u4F5C\u610F\u56FE\u3002"
        }),
        e.jsxs("div", {
          className: "space-y-4",
          children: [
            e.jsxs("div", {
              className: "space-y-2",
              children: [
                e.jsx(W, {
                  children: "\u6838\u5FC3\u601D\u60F3"
                }),
                e.jsx(G, {
                  value: w.mainIdea,
                  onChange: (u) => d("mainIdea", u.target.value),
                  onBlur: c,
                  rows: 3
                })
              ]
            }),
            e.jsxs("div", {
              className: "space-y-2",
              children: [
                e.jsx(W, {
                  children: "\u521B\u4F5C\u610F\u56FE"
                }),
                e.jsx(G, {
                  value: w.intention,
                  onChange: (u) => d("intention", u.target.value),
                  onBlur: c,
                  rows: 3
                })
              ]
            }),
            e.jsxs("div", {
              className: "space-y-2",
              children: [
                e.jsx(W, {
                  children: "\u98CE\u683C\u57FA\u8C03"
                }),
                e.jsx(G, {
                  value: w.style,
                  onChange: (u) => d("style", u.target.value),
                  onBlur: c,
                  rows: 2
                })
              ]
            })
          ]
        }),
        g && e.jsxs("div", {
          className: "mt-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded text-xs text-yellow-600 italic",
          children: [
            "\u6B63\u5728\u53C2\u8003\u8BC4\u5BA1\u5EFA\u8BAE\uFF1A",
            g.substring(0, 100),
            "..."
          ]
        })
      ]
    });
  };
  yn = () => {
    var _a, _b, _c, _d, _e2;
    const t = Y(o), s = se((h) => h.config), [n, r] = T.useState(false), [a, i] = T.useState(false), [l, x] = T.useState(false), p = (_b = (_a = t.currentSession) == null ? void 0 : _a.modeConfig) == null ? void 0 : _b.plotOutline, g = (p == null ? void 0 : p.rawText) || "", w = (_e2 = (_d = (_c = t.currentSession) == null ? void 0 : _c.modeState) == null ? void 0 : _d.tempData) == null ? void 0 : _e2.latestReviewSuggestions, [y, d] = T.useState("");
    T.useEffect(() => {
      d(g);
    }, [
      g
    ]);
    const c = (h) => {
      const m = h.split(`
`).filter((N) => N.trim()), _ = [];
      m.forEach((N, b) => {
        /^[\d\-\*]/.test(N.trim()) && _.push({
          id: k(),
          name: N.replace(/^[\d\-\*\.\s]+/, "").trim(),
          description: "",
          order: b
        });
      }), o.updateModeConfig({
        plotOutline: {
          structure: (p == null ? void 0 : p.structure) || "",
          keyPlots: _,
          rawText: h,
          format: "markdown"
        }
      });
    }, v = () => {
      c(y);
    }, S = async () => {
      if (!y.trim()) {
        C.error("\u8BF7\u5148\u8F93\u5165\u60C5\u8282\u8109\u7EDC\u5185\u5BB9");
        return;
      }
      i(true);
      try {
        const h = o.currentSession, m = o.contextManager;
        if (!h || !m) return;
        const _ = Z.makeMessagesForPlotOptimization(h, m);
        await q(s, _.map((N) => ({
          role: N.role,
          content: N.content,
          id: k()
        })), [], (N, b) => {
          c(b);
        }), await o.updateSessionInDB(), C.success("AI \u4F18\u5316\u60C5\u8282\u8109\u7EDC\u5B8C\u6210");
      } catch (h) {
        console.error("AI optimization error:", h), C.error("AI \u4F18\u5316\u5931\u8D25");
      } finally {
        i(false);
      }
    }, u = async (h) => {
      r(true);
      try {
        const m = o.contextManager;
        if (!o.currentSession || !m) {
          C.error("\u4F1A\u8BDD\u672A\u521D\u59CB\u5316");
          return;
        }
        o.updateTempData({
          plotFormat: "markdown",
          plotHint: h || void 0
        });
        const _ = Z.makeMessagesForPlotGenerationFree(o.currentSession, m);
        await q(s, _.map((N) => ({
          role: N.role,
          content: N.content,
          id: k()
        })), [], (N, b) => {
          c(b);
        }), await o.updateSessionInDB(), C.success(w ? "AI \u5DF2\u6839\u636E\u8BC4\u5BA1\u5EFA\u8BAE\u4F18\u5316\u60C5\u8282" : "AI \u751F\u6210\u60C5\u8282\u8109\u7EDC\u6210\u529F");
      } catch (m) {
        console.error("AI generation error:", m), C.error("AI \u751F\u6210\u5931\u8D25");
      } finally {
        r(false), o.updateTempData({
          plotHint: void 0
        });
      }
    };
    return e.jsxs("div", {
      className: "space-y-4",
      children: [
        e.jsxs("div", {
          className: "flex justify-between items-center",
          children: [
            e.jsxs("div", {
              className: "text-xs text-muted-foreground flex items-center gap-2",
              children: [
                e.jsx(De, {
                  className: "w-4 h-4"
                }),
                "\u652F\u6301 Markdown \u683C\u5F0F\uFF0C\u5B9E\u65F6\u81EA\u52A8\u4FDD\u5B58"
              ]
            }),
            e.jsxs("div", {
              className: "flex gap-2",
              children: [
                e.jsx(j, {
                  size: "sm",
                  variant: "outline",
                  onClick: S,
                  disabled: a || n,
                  children: a ? e.jsxs(e.Fragment, {
                    children: [
                      e.jsx(H, {
                        className: "w-4 h-4 mr-2 animate-spin"
                      }),
                      "\u4F18\u5316\u4E2D..."
                    ]
                  }) : e.jsxs(e.Fragment, {
                    children: [
                      e.jsx(he, {
                        className: "w-4 h-4 mr-2"
                      }),
                      "AI \u4F18\u5316"
                    ]
                  })
                }),
                e.jsx(j, {
                  size: "sm",
                  variant: "outline",
                  onClick: () => x(true),
                  disabled: n || a,
                  children: n ? e.jsxs(e.Fragment, {
                    children: [
                      e.jsx(H, {
                        className: "w-4 h-4 mr-2 animate-spin"
                      }),
                      "\u751F\u6210\u4E2D..."
                    ]
                  }) : e.jsxs(e.Fragment, {
                    children: [
                      e.jsx(z, {
                        className: "w-4 h-4 mr-2"
                      }),
                      w ? "\u6839\u636E\u5EFA\u8BAE\u91CD\u65B0\u751F\u6210" : "AI \u751F\u6210"
                    ]
                  })
                })
              ]
            })
          ]
        }),
        e.jsx(pe, {
          isOpen: l,
          onClose: () => x(false),
          onConfirm: u,
          title: "\u60C5\u8282\u8109\u7EDC AI \u751F\u6210",
          description: "\u8BF7\u8F93\u5165\u60A8\u5BF9\u60C5\u8282\u7684\u671F\u671B\uFF08\u5982\uFF1A\u8D77\u627F\u8F6C\u5408\u3001\u9AD8\u6F6E\u70B9\u3001\u7ED3\u5C40\u8D70\u5411\u7B49\uFF09\uFF0CAI \u5C06\u4E3A\u60A8\u751F\u6210\u5B8C\u6574\u7684\u60C5\u8282\u5927\u7EB2\u3002"
        }),
        e.jsx(G, {
          value: y,
          onChange: (h) => d(h.target.value),
          onBlur: v,
          rows: 20,
          className: "font-mono text-sm"
        }),
        w && e.jsxs("div", {
          className: "p-3 bg-yellow-500/10 border border-yellow-500/20 rounded text-xs text-yellow-600",
          children: [
            "\u53C2\u8003\u5EFA\u8BAE\uFF1A",
            w.substring(0, 100),
            "..."
          ]
        })
      ]
    });
  };
  Nn = () => {
    var _a, _b, _c, _d, _e2;
    const t = Y(o), s = se((u) => u.config), [n, r] = T.useState(false), [a, i] = T.useState(false), [l, x] = T.useState(false), p = ((_b = (_a = t.currentSession) == null ? void 0 : _a.modeConfig) == null ? void 0 : _b.chapterOutlineRawText) || "", g = (_e2 = (_d = (_c = t.currentSession) == null ? void 0 : _c.modeState) == null ? void 0 : _d.tempData) == null ? void 0 : _e2.latestReviewSuggestions, [w, y] = T.useState("");
    T.useEffect(() => {
      y(p);
    }, [
      p
    ]);
    const d = (u) => {
      const h = u.split(`
`), m = [];
      let _ = null;
      h.forEach((N) => {
        const b = N.trim(), E = b.match(/^#+\s*?(\d+)[][\s:]*(.*)/);
        E ? (_ && m.push(_), _ = {
          id: k(),
          chapterNumber: parseInt(E[1]),
          title: E[2] || `\u7B2C${E[1]}\u7AE0`,
          summary: "",
          keyEvents: []
        }) : _ && b && (b.startsWith("-") || b.startsWith("*") ? _.keyEvents.push(b.replace(/^[\-\*]\s*/, "")) : _.summary += (_.summary ? `
` : "") + b);
      }), _ && m.push(_), o.updateModeConfig({
        chapterOutline: m,
        chapterOutlineRawText: u,
        hasOutline: m.length > 0
      });
    }, c = () => {
      d(w);
    }, v = async () => {
      if (!w.trim()) {
        C.error("\u8BF7\u5148\u8F93\u5165\u7AE0\u8282\u5927\u7EB2\u5185\u5BB9");
        return;
      }
      i(true);
      try {
        const u = o.currentSession, h = o.contextManager;
        if (!u || !h) return;
        const m = Z.makeMessagesForChapterOutlineOptimization(u, h);
        await q(s, m.map((_) => ({
          role: _.role,
          content: _.content,
          id: k()
        })), [], (_, N) => {
          d(N);
        }), await o.updateSessionInDB(), C.success("AI \u4F18\u5316\u7AE0\u8282\u5927\u7EB2\u5B8C\u6210");
      } catch (u) {
        console.error("AI optimization error:", u), C.error("AI \u4F18\u5316\u5931\u8D25");
      } finally {
        i(false);
      }
    }, S = async (u) => {
      r(true);
      try {
        const h = o.contextManager;
        if (!o.currentSession || !h) {
          C.error("\u4F1A\u8BDD\u672A\u521D\u59CB\u5316");
          return;
        }
        o.updateTempData({
          outlineFormat: "markdown",
          chapterCount: 12,
          outlineHint: u || void 0
        });
        const m = Z.makeMessagesForChapterOutlineGeneration(o.currentSession, h);
        await q(s, m.map((_) => ({
          role: _.role,
          content: _.content,
          id: k()
        })), [], (_, N) => {
          d(N);
        }), await o.updateSessionInDB(), C.success(g ? "AI \u5DF2\u6839\u636E\u8BC4\u5BA1\u5EFA\u8BAE\u4F18\u5316\u5927\u7EB2" : "AI \u751F\u6210\u7AE0\u8282\u5927\u7EB2\u6210\u529F");
      } catch (h) {
        console.error("AI generation error:", h), C.error("AI \u751F\u6210\u5931\u8D25");
      } finally {
        r(false), o.updateTempData({
          outlineHint: void 0
        });
      }
    };
    return e.jsxs("div", {
      className: "space-y-4",
      children: [
        e.jsxs("div", {
          className: "flex justify-between items-center",
          children: [
            e.jsxs("div", {
              className: "text-xs text-muted-foreground flex items-center gap-2",
              children: [
                e.jsx(De, {
                  className: "w-4 h-4"
                }),
                "\u652F\u6301 Markdown \u683C\u5F0F\uFF0C\u81EA\u7531\u7F16\u5199\uFF0C\u5B9E\u65F6\u81EA\u52A8\u4FDD\u5B58"
              ]
            }),
            e.jsxs("div", {
              className: "flex gap-2",
              children: [
                e.jsx(j, {
                  size: "sm",
                  variant: "outline",
                  onClick: v,
                  disabled: a || n,
                  children: a ? e.jsxs(e.Fragment, {
                    children: [
                      e.jsx(H, {
                        className: "w-4 h-4 mr-2 animate-spin"
                      }),
                      "\u4F18\u5316\u4E2D..."
                    ]
                  }) : e.jsxs(e.Fragment, {
                    children: [
                      e.jsx(he, {
                        className: "w-4 h-4 mr-2"
                      }),
                      "AI \u4F18\u5316"
                    ]
                  })
                }),
                e.jsx(j, {
                  size: "sm",
                  variant: "outline",
                  onClick: () => x(true),
                  disabled: n || a,
                  children: n ? e.jsxs(e.Fragment, {
                    children: [
                      e.jsx(H, {
                        className: "w-4 h-4 mr-2 animate-spin"
                      }),
                      "AI \u751F\u6210\u4E2D..."
                    ]
                  }) : e.jsxs(e.Fragment, {
                    children: [
                      e.jsx(z, {
                        className: "w-4 h-4 mr-2"
                      }),
                      g ? "\u6839\u636E\u5EFA\u8BAE\u91CD\u65B0\u751F\u6210" : "AI \u751F\u6210"
                    ]
                  })
                })
              ]
            })
          ]
        }),
        e.jsx(pe, {
          isOpen: l,
          onClose: () => x(false),
          onConfirm: S,
          title: "\u7AE0\u8282\u5927\u7EB2 AI \u751F\u6210",
          description: "\u8BF7\u8F93\u5165\u60A8\u5BF9\u7AE0\u8282\u5927\u7EB2\u7684\u671F\u671B\uFF08\u5982\uFF1A\u7AE0\u8282\u6570\u91CF\u3001\u6BCF\u7AE0\u91CD\u70B9\u3001\u8282\u594F\u5FEB\u6162\u7B49\uFF09\uFF0CAI \u5C06\u4E3A\u60A8\u751F\u6210\u8BE6\u7EC6\u7684\u7AE0\u8282\u5217\u8868\u3002"
        }),
        e.jsx(G, {
          placeholder: `\u8BF7\u8F93\u5165\u7AE0\u8282\u5927\u7EB2\uFF08Markdown \u683C\u5F0F\uFF09\uFF1A

\u793A\u4F8B\uFF1A
# \u7B2C1\u7AE0 \u610F\u5916\u89C9\u9192
\u4E3B\u89D2\u5728\u5E73\u51E1\u7684\u4E00\u5929\u7A81\u7136\u53D1\u73B0\u81EA\u5DF1\u62E5\u6709\u4E86\u795E\u79D8\u529B\u91CF\u3002
- \u65E9\u6668\u9192\u6765\uFF0C\u53D1\u73B0\u5468\u56F4\u7269\u4F53\u60AC\u6D6E
- \u524D\u5F80\u5B66\u6821\uFF0C\u5F15\u53D1\u5C0F\u89C4\u6A21\u6DF7\u4E71
- \u88AB\u795E\u79D8\u7EC4\u7EC7\u76EF\u4E0A

# \u7B2C2\u7AE0 \u8E0F\u5165\u65B0\u4E16\u754C
\u4E3B\u89D2\u88AB\u5E26\u5230\u9690\u79D8\u7684\u4FEE\u70BC\u8005\u4E16\u754C\uFF0C\u5F00\u59CB\u4E86\u89E3\u771F\u76F8\u3002
- \u9047\u5230\u5F15\u8DEF\u4EBA
- \u53C2\u89C2\u4FEE\u70BC\u8005\u636E\u70B9
- \u4E86\u89E3\u4E16\u754C\u7684\u79D8\u5BC6`,
          value: w,
          onChange: (u) => y(u.target.value),
          onBlur: c,
          rows: 20,
          className: "font-mono text-sm"
        }),
        e.jsx("div", {
          className: "text-xs text-muted-foreground p-3 bg-muted/30 rounded",
          children: "\u{1F4A1} \u63D0\u793A\uFF1A\u76F4\u63A5\u5728\u6587\u672C\u6846\u4E2D\u81EA\u7531\u7F16\u5199\u7AE0\u8282\u5927\u7EB2\uFF0C\u6240\u6709\u7684\u4FEE\u6539\u90FD\u4F1A\u5B9E\u65F6\u81EA\u52A8\u4FDD\u5B58\u3002"
        }),
        g && e.jsxs("div", {
          className: "mt-2 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded text-xs text-yellow-600",
          children: [
            "\u53C2\u8003\u5EFA\u8BAE\uFF1A",
            g.substring(0, 100),
            "..."
          ]
        })
      ]
    });
  };
  vn = ({ sessionId: t }) => {
    var _a, _b;
    const s = Y(o), n = (_b = (_a = s.currentSession) == null ? void 0 : _a.modeState) == null ? void 0 : _b.currentPhase, r = async () => {
      switch (n) {
        case "design_worldview":
          o.setPhase("design_characters"), o.setUIState("design_characters_ready");
          break;
        case "design_characters":
          o.setPhase("design_theme"), o.setUIState("design_theme_ready");
          break;
        case "design_theme":
          o.setPhase("design_plot_outline"), o.setUIState("design_plot_outline_ready");
          break;
        case "design_plot_outline":
          o.setPhase("design_chapter_outline"), o.setUIState("design_chapter_outline_ready");
          break;
        case "design_chapter_outline":
          o.setPhase("ai_review"), o.setUIState("ai_review_ready");
          break;
      }
      await o.updateSessionInDB();
    }, a = async () => {
      switch (n) {
        case "design_characters":
          o.setPhase("design_worldview"), o.setUIState("design_worldview_ready");
          break;
        case "design_theme":
          o.setPhase("design_characters"), o.setUIState("design_characters_ready");
          break;
        case "design_plot_outline":
          o.setPhase("design_theme"), o.setUIState("design_theme_ready");
          break;
        case "design_chapter_outline":
          o.setPhase("design_plot_outline"), o.setUIState("design_plot_outline_ready");
          break;
      }
      await o.updateSessionInDB();
    }, i = () => {
      switch (n) {
        case "design_worldview":
          return e.jsxs("div", {
            className: "space-y-6",
            children: [
              e.jsx("div", {
                className: "flex items-center justify-between",
                children: e.jsxs("div", {
                  children: [
                    e.jsx("h3", {
                      className: "text-lg font-semibold",
                      children: "\u4E16\u754C\u89C2\u8BBE\u8BA1"
                    }),
                    e.jsx("p", {
                      className: "text-sm text-muted-foreground",
                      children: "\u5B9A\u4E49\u5C0F\u8BF4\u7684\u65F6\u4EE3\u80CC\u666F\u3001\u793E\u4F1A\u4F53\u7CFB\u3001\u6280\u672F\u6C34\u5E73\u7B49\u57FA\u7840\u8BBE\u5B9A"
                    })
                  ]
                })
              }),
              e.jsx(_n, {
                sessionId: t
              })
            ]
          });
        case "design_characters":
          return e.jsxs("div", {
            className: "space-y-6",
            children: [
              e.jsx("div", {
                className: "flex items-center justify-between",
                children: e.jsxs("div", {
                  children: [
                    e.jsx("h3", {
                      className: "text-lg font-semibold",
                      children: "\u89D2\u8272\u8BBE\u8BA1"
                    }),
                    e.jsx("p", {
                      className: "text-sm text-muted-foreground",
                      children: "\u521B\u5EFA\u4E3B\u8981\u89D2\u8272\uFF0C\u5B9A\u4E49\u6027\u683C\u3001\u80CC\u666F\u548C\u5173\u7CFB"
                    })
                  ]
                })
              }),
              e.jsx(wn, {
                sessionId: t
              })
            ]
          });
        case "design_theme":
          return e.jsxs("div", {
            className: "space-y-6",
            children: [
              e.jsx("div", {
                className: "flex items-center justify-between",
                children: e.jsxs("div", {
                  children: [
                    e.jsx("h3", {
                      className: "text-lg font-semibold",
                      children: "\u4E3B\u9898\u8BBE\u8BA1"
                    }),
                    e.jsx("p", {
                      className: "text-sm text-muted-foreground",
                      children: "\u786E\u5B9A\u5C0F\u8BF4\u7684\u6838\u5FC3\u601D\u60F3\u3001\u521B\u4F5C\u610F\u56FE\u548C\u98CE\u683C"
                    })
                  ]
                })
              }),
              e.jsx(Sn, {
                sessionId: t
              })
            ]
          });
        case "design_plot_outline":
          return e.jsxs("div", {
            className: "space-y-6",
            children: [
              e.jsx("div", {
                className: "flex items-center justify-between",
                children: e.jsxs("div", {
                  children: [
                    e.jsx("h3", {
                      className: "text-lg font-semibold",
                      children: "\u60C5\u8282\u8109\u7EDC\u8BBE\u8BA1"
                    }),
                    e.jsx("p", {
                      className: "text-sm text-muted-foreground",
                      children: "\u89C4\u5212\u6574\u4F53\u6545\u4E8B\u7ED3\u6784\u548C\u5173\u952E\u60C5\u8282\u70B9"
                    })
                  ]
                })
              }),
              e.jsx(yn, {
                sessionId: t
              })
            ]
          });
        case "design_chapter_outline":
          return e.jsxs("div", {
            className: "space-y-6",
            children: [
              e.jsx("div", {
                className: "flex items-center justify-between",
                children: e.jsxs("div", {
                  children: [
                    e.jsx("h3", {
                      className: "text-lg font-semibold",
                      children: "\u7AE0\u8282\u5927\u7EB2\u8BBE\u8BA1"
                    }),
                    e.jsx("p", {
                      className: "text-sm text-muted-foreground",
                      children: "\u7EC6\u5316\u6BCF\u4E00\u7AE0\u7684\u6807\u9898\u3001\u6458\u8981\u548C\u5173\u952E\u4E8B\u4EF6"
                    })
                  ]
                })
              }),
              e.jsx(Nn, {
                sessionId: t
              })
            ]
          });
        default:
          return null;
      }
    }, l = () => {
      if (!s.currentSession) return false;
      switch (n) {
        case "design_worldview":
          return true;
        case "design_characters":
          return true;
        case "design_theme":
          return true;
        case "design_plot_outline":
          return true;
        case "design_chapter_outline":
          return true;
        default:
          return false;
      }
    };
    return e.jsxs("div", {
      className: "max-w-4xl mx-auto space-y-6",
      children: [
        e.jsxs("div", {
          className: "flex items-center gap-2 text-xs",
          children: [
            e.jsxs("div", {
              className: `flex items-center gap-1 ${n === "design_worldview" ? "text-primary font-medium" : "text-muted-foreground"}`,
              children: [
                n !== "design_worldview" && e.jsx($, {
                  className: "w-3 h-3"
                }),
                "\u4E16\u754C\u89C2"
              ]
            }),
            e.jsx(F, {
              className: "w-3 h-3 text-muted-foreground"
            }),
            e.jsxs("div", {
              className: `flex items-center gap-1 ${n === "design_characters" ? "text-primary font-medium" : "text-muted-foreground"}`,
              children: [
                [
                  "design_theme",
                  "design_plot_outline",
                  "design_chapter_outline"
                ].includes(n || "") && e.jsx($, {
                  className: "w-3 h-3"
                }),
                "\u89D2\u8272"
              ]
            }),
            e.jsx(F, {
              className: "w-3 h-3 text-muted-foreground"
            }),
            e.jsxs("div", {
              className: `flex items-center gap-1 ${n === "design_theme" ? "text-primary font-medium" : "text-muted-foreground"}`,
              children: [
                [
                  "design_plot_outline",
                  "design_chapter_outline"
                ].includes(n || "") && e.jsx($, {
                  className: "w-3 h-3"
                }),
                "\u4E3B\u9898"
              ]
            }),
            e.jsx(F, {
              className: "w-3 h-3 text-muted-foreground"
            }),
            e.jsxs("div", {
              className: `flex items-center gap-1 ${n === "design_plot_outline" ? "text-primary font-medium" : "text-muted-foreground"}`,
              children: [
                n === "design_chapter_outline" && e.jsx($, {
                  className: "w-3 h-3"
                }),
                "\u60C5\u8282\u8109\u7EDC"
              ]
            }),
            e.jsx(F, {
              className: "w-3 h-3 text-muted-foreground"
            }),
            e.jsx("div", {
              className: `flex items-center gap-1 ${n === "design_chapter_outline" ? "text-primary font-medium" : "text-muted-foreground"}`,
              children: "\u7AE0\u8282\u5927\u7EB2"
            })
          ]
        }),
        i(),
        e.jsxs("div", {
          className: "flex justify-between items-center pt-4 border-t",
          children: [
            e.jsx(j, {
              variant: "outline",
              onClick: a,
              disabled: n === "design_worldview",
              children: "\u4E0A\u4E00\u6B65"
            }),
            e.jsxs(j, {
              onClick: r,
              disabled: !l(),
              children: [
                n === "design_chapter_outline" ? "\u63D0\u4EA4\u8BC4\u5BA1" : "\u4E0B\u4E00\u6B65",
                e.jsx(F, {
                  className: "w-4 h-4 ml-2"
                })
              ]
            })
          ]
        })
      ]
    });
  };
  bn = ({ sessionId: t }) => {
    var _a, _b, _c, _d, _e2, _f, _g, _h;
    const s = Y(o), { runLoop: n } = ce(), r = (_b = (_a = s.currentSession) == null ? void 0 : _a.modeState) == null ? void 0 : _b.currentPhase, a = (_c = s.contextManager) == null ? void 0 : _c.state.processingItem, l = [
      ...((_d = s.contextManager) == null ? void 0 : _d.state.historyItems) || []
    ].reverse().find((y) => y.type === "novel_ai_review"), x = a !== void 0, p = async () => {
      o.setPhase("ai_review"), o.setUIState("ai_review_running");
      const y = o.contextManager;
      y && (y.state.historyItems = []), await o.updateSessionInDB(), n(t);
    }, g = async () => {
      o.setPhase("chapter_prep_review"), o.setUIState("chapter_prep_ready"), await o.updateSessionInDB();
    }, w = async () => {
      var _a2;
      if (l) {
        const y = l.data;
        o.updateTempData({
          latestReviewSuggestions: y.reviewResult + `
` + (((_a2 = y.suggestions) == null ? void 0 : _a2.join(`
`)) || "")
        });
      }
      o.setPhase("design_worldview"), o.setUIState("design_worldview_ready"), await o.updateSessionInDB();
    };
    if (r === "ai_review") {
      if (!l && !x) return e.jsx("div", {
        className: "max-w-4xl mx-auto space-y-6",
        children: e.jsxs(O, {
          className: "p-12 text-center border-dashed",
          children: [
            e.jsx("div", {
              className: "w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4",
              children: e.jsx(z, {
                className: "w-8 h-8 text-primary"
              })
            }),
            e.jsx("h3", {
              className: "text-xl font-bold mb-4",
              children: "\u8FDB\u884C AI \u8BC4\u5BA1"
            }),
            e.jsx("p", {
              className: "text-muted-foreground mb-8 max-w-md mx-auto",
              children: "AI \u5C06\u6DF1\u5EA6\u5206\u6790\u60A8\u7684\u4E16\u754C\u89C2\u3001\u89D2\u8272\u548C\u60C5\u8282\u8BBE\u8BA1\uFF0C\u6307\u51FA\u903B\u8F91\u6F0F\u6D1E\u5E76\u63D0\u4F9B\u4F18\u5316\u65B9\u6848\u3002"
            }),
            e.jsxs("div", {
              className: "flex flex-col sm:flex-row items-center justify-center gap-4",
              children: [
                e.jsxs(j, {
                  variant: "outline",
                  onClick: w,
                  className: "px-6",
                  children: [
                    e.jsx(Te, {
                      className: "w-4 h-4 mr-2"
                    }),
                    "\u8FD4\u56DE\u4FEE\u6539"
                  ]
                }),
                e.jsxs(j, {
                  size: "lg",
                  onClick: p,
                  className: "px-8",
                  children: [
                    e.jsx(z, {
                      className: "w-5 h-5 mr-2"
                    }),
                    "\u7ACB\u5373\u5F00\u59CB\u8BC4\u5BA1"
                  ]
                }),
                e.jsxs(j, {
                  variant: "ghost",
                  onClick: g,
                  className: "px-6 text-muted-foreground hover:text-primary",
                  children: [
                    "\u8DF3\u8FC7\u8BC4\u5BA1\u76F4\u63A5\u5199\u4F5C",
                    e.jsx(F, {
                      className: "w-4 h-4 ml-2"
                    })
                  ]
                })
              ]
            })
          ]
        })
      });
      if (x) return e.jsx("div", {
        className: "max-w-4xl mx-auto space-y-6",
        children: e.jsxs(O, {
          className: "p-12 text-center",
          children: [
            e.jsx(H, {
              className: "w-12 h-12 animate-spin text-primary mx-auto mb-6"
            }),
            e.jsx("h3", {
              className: "text-lg font-semibold mb-2",
              children: "AI \u6B63\u5728\u6DF1\u5EA6\u8BC4\u5BA1\u4E2D..."
            }),
            e.jsx("p", {
              className: "text-sm text-muted-foreground mb-8",
              children: "\u6B63\u5728\u5BF9\u6BD4\u4E16\u754C\u89C2\u7684\u4E00\u81F4\u6027\u4E0E\u89D2\u8272\u7684\u52A8\u673A\u5408\u7406\u6027..."
            }),
            a && e.jsx("div", {
              className: "text-left bg-muted p-4 rounded-lg text-sm whitespace-pre-wrap max-h-75 overflow-y-auto",
              children: a.data.content
            })
          ]
        })
      });
      const y = l.data, d = y.recommendation === "pass";
      return e.jsxs("div", {
        className: "max-w-4xl mx-auto space-y-6",
        children: [
          e.jsx(O, {
            className: "p-6 border-2 border-primary/20",
            children: e.jsxs("div", {
              className: "space-y-6",
              children: [
                e.jsxs("div", {
                  className: "flex items-start justify-between",
                  children: [
                    e.jsxs("div", {
                      className: "flex items-start gap-4",
                      children: [
                        e.jsx("div", {
                          className: `w-12 h-12 rounded-full flex items-center justify-center ${d ? "bg-green-500/10" : "bg-yellow-500/10"}`,
                          children: d ? e.jsx($, {
                            className: "w-6 h-6 text-green-500"
                          }) : e.jsx(Ct, {
                            className: "w-6 h-6 text-yellow-500"
                          })
                        }),
                        e.jsxs("div", {
                          children: [
                            e.jsxs("h3", {
                              className: "text-lg font-bold",
                              children: [
                                "\u8BC4\u5BA1\u7ED3\u8BBA\uFF1A",
                                d ? "\u5EFA\u8BAE\u901A\u8FC7" : "\u5EFA\u8BAE\u4FEE\u6539"
                              ]
                            }),
                            e.jsxs("p", {
                              className: "text-xs text-muted-foreground",
                              children: [
                                "\u751F\u6210\u65F6\u95F4\uFF1A",
                                new Date(l.timestamp || Date.now()).toLocaleString()
                              ]
                            })
                          ]
                        })
                      ]
                    }),
                    e.jsxs(j, {
                      variant: "ghost",
                      size: "sm",
                      onClick: p,
                      className: "text-primary hover:text-primary/80",
                      children: [
                        e.jsx($e, {
                          className: "w-4 h-4 mr-2"
                        }),
                        "\u91CD\u65B0\u8BC4\u5BA1"
                      ]
                    })
                  ]
                }),
                e.jsx("div", {
                  className: "text-sm text-muted-foreground bg-muted/30 p-4 rounded-lg whitespace-pre-wrap",
                  children: y.reviewResult
                }),
                e.jsxs("div", {
                  className: "grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 border-t pt-6",
                  children: [
                    e.jsxs("div", {
                      className: "text-center p-3 bg-muted/20 rounded-lg",
                      children: [
                        e.jsx("div", {
                          className: "text-[10px] text-muted-foreground uppercase mb-1",
                          children: "\u4E16\u754C\u89C2"
                        }),
                        e.jsx("div", {
                          className: "text-xl font-bold",
                          children: ((_e2 = y.scores) == null ? void 0 : _e2.worldviewCompleteness) || 0
                        })
                      ]
                    }),
                    e.jsxs("div", {
                      className: "text-center p-3 bg-muted/20 rounded-lg",
                      children: [
                        e.jsx("div", {
                          className: "text-[10px] text-muted-foreground uppercase mb-1",
                          children: "\u89D2\u8272"
                        }),
                        e.jsx("div", {
                          className: "text-xl font-bold",
                          children: ((_f = y.scores) == null ? void 0 : _f.characterDesign) || 0
                        })
                      ]
                    }),
                    e.jsxs("div", {
                      className: "text-center p-3 bg-muted/20 rounded-lg",
                      children: [
                        e.jsx("div", {
                          className: "text-[10px] text-muted-foreground uppercase mb-1",
                          children: "\u4E3B\u9898"
                        }),
                        e.jsx("div", {
                          className: "text-xl font-bold",
                          children: ((_g = y.scores) == null ? void 0 : _g.themeDepth) || 0
                        })
                      ]
                    }),
                    e.jsxs("div", {
                      className: "text-center p-3 bg-muted/20 rounded-lg",
                      children: [
                        e.jsx("div", {
                          className: "text-[10px] text-muted-foreground uppercase mb-1",
                          children: "\u60C5\u8282"
                        }),
                        e.jsx("div", {
                          className: "text-xl font-bold",
                          children: ((_h = y.scores) == null ? void 0 : _h.plotLogic) || 0
                        })
                      ]
                    }),
                    e.jsxs("div", {
                      className: "text-center p-3 bg-primary/10 rounded-lg border border-primary/20",
                      children: [
                        e.jsx("div", {
                          className: "text-[10px] text-primary uppercase mb-1",
                          children: "\u7EFC\u5408"
                        }),
                        e.jsx("div", {
                          className: "text-xl font-bold text-primary",
                          children: y.overallScore || 0
                        })
                      ]
                    })
                  ]
                })
              ]
            })
          }),
          e.jsxs("div", {
            className: "flex justify-between gap-3",
            children: [
              e.jsxs(j, {
                variant: "outline",
                onClick: w,
                className: "flex-1 max-w-50",
                children: [
                  e.jsx(Te, {
                    className: "w-4 h-4 mr-2"
                  }),
                  "\u8FD4\u56DE\u4FEE\u6539"
                ]
              }),
              e.jsxs(j, {
                onClick: g,
                className: "flex-1 max-w-75 bg-green-600 hover:bg-green-700",
                children: [
                  "\u63A5\u53D7\u5E76\u5F00\u59CB\u5199\u4F5C",
                  e.jsx(F, {
                    className: "w-4 h-4 ml-2"
                  })
                ]
              })
            ]
          })
        ]
      });
    }
    return null;
  };
  In = ({ sessionId: t }) => {
    var _a, _b, _c, _d;
    const s = Y(o), n = Y(o.contextManager.state), { runLoop: r } = ce(), a = (_b = (_a = s.currentSession) == null ? void 0 : _a.modeState) == null ? void 0 : _b.currentPhase, i = (_d = (_c = s.currentSession) == null ? void 0 : _c.modeState) == null ? void 0 : _d.currentChapter, l = n.historyItems || [], x = n.processingItem, p = [
      ...l
    ].reverse().find((m) => m.type === "novel_chapter_prep_review"), g = [
      ...l
    ].reverse().find((m) => m.type === "novel_chapter_prep_interest"), w = [
      ...l
    ].reverse().find((m) => m.type === "novel_chapter_prep_emotion"), y = [
      ...l
    ].reverse().find((m) => m.type === "novel_chapter_plan_generation"), d = async () => {
      var _a2;
      console.log("[ChapterPrep] Starting step, current phase:", (_a2 = o.currentSession) == null ? void 0 : _a2.modeState.currentPhase), o.setUIState("chapter_prep_running"), await o.updateSessionInDB(), r(t, true);
    }, c = async () => {
      const m = o.currentSession;
      if (!m) {
        console.error("[ChapterPrep] No active session found");
        return;
      }
      const _ = m.modeState.currentPhase;
      console.log("[ChapterPrep] handleNextStep called. Current phase:", _), _ === "chapter_prep_review" ? m.modeState.currentPhase = "chapter_prep_interest" : _ === "chapter_prep_interest" ? m.modeState.currentPhase = "chapter_prep_emotion" : _ === "chapter_prep_emotion" ? m.modeState.currentPhase = "chapter_plan_generation" : _ === "chapter_plan_generation" && (m.modeState.currentPhase = "chapter_plan_approval"), m.modeState.currentUIState = "idle", m.updatedAt = Date.now(), await o.updateSessionInDB();
    }, v = async () => {
      const m = o.sessionManager;
      m && (m.enterNextState("block_write"), await o.updateSessionInDB());
    }, S = async () => {
      const m = o.sessionManager;
      m && (m.enterNextState("chapter_plan_generation"), o.setUIState("chapter_prep_running"), await o.updateSessionInDB(), r(t, true));
    }, u = x !== void 0, h = ((i == null ? void 0 : i.number) || 1) === 1;
    return e.jsxs("div", {
      className: "space-y-6",
      children: [
        e.jsx("div", {
          className: "flex items-center justify-between",
          children: e.jsxs("div", {
            children: [
              e.jsxs("h2", {
                className: "text-2xl font-bold",
                children: [
                  "\u7B2C ",
                  (i == null ? void 0 : i.number) || 1,
                  " \u7AE0\uFF1A",
                  (i == null ? void 0 : i.title) || "\u672A\u547D\u540D"
                ]
              }),
              e.jsx("p", {
                className: "text-sm text-muted-foreground",
                children: h ? "\u5F00\u7BC7\u51C6\u5907\u4E2D" : "\u7AE0\u8282\u51C6\u5907\u4E2D"
              })
            ]
          })
        }),
        e.jsxs("div", {
          className: "flex items-center gap-2 text-xs flex-wrap bg-muted/30 p-3 rounded-lg",
          children: [
            e.jsxs("div", {
              className: `flex items-center gap-1 ${[
                "chapter_prep_review"
              ].includes(a || "") ? "text-primary font-bold" : p ? "text-green-600" : "text-muted-foreground"}`,
              children: [
                p ? e.jsx($, {
                  className: "w-3 h-3"
                }) : e.jsx("div", {
                  className: "w-3 h-3 rounded-full border border-current"
                }),
                h ? "\u5F00\u7BC7\u5BC4\u8BED" : "\u524D\u60C5\u56DE\u987E"
              ]
            }),
            e.jsx(F, {
              className: "w-3 h-3 text-muted-foreground/30"
            }),
            e.jsxs("div", {
              className: `flex items-center gap-1 ${[
                "chapter_prep_interest"
              ].includes(a || "") ? "text-primary font-bold" : g ? "text-green-600" : "text-muted-foreground"}`,
              children: [
                g ? e.jsx($, {
                  className: "w-3 h-3"
                }) : e.jsx("div", {
                  className: "w-3 h-3 rounded-full border border-current"
                }),
                "\u5174\u8DA3\u70B9\u5206\u6790"
              ]
            }),
            e.jsx(F, {
              className: "w-3 h-3 text-muted-foreground/30"
            }),
            e.jsxs("div", {
              className: `flex items-center gap-1 ${[
                "chapter_prep_emotion"
              ].includes(a || "") ? "text-primary font-bold" : w ? "text-green-600" : "text-muted-foreground"}`,
              children: [
                w ? e.jsx($, {
                  className: "w-3 h-3"
                }) : e.jsx("div", {
                  className: "w-3 h-3 rounded-full border border-current"
                }),
                "\u60C5\u7EEA\u8BBE\u8BA1"
              ]
            }),
            e.jsx(F, {
              className: "w-3 h-3 text-muted-foreground/30"
            }),
            e.jsxs("div", {
              className: `flex items-center gap-1 ${[
                "chapter_plan_generation",
                "chapter_plan_approval"
              ].includes(a || "") ? "text-primary font-bold" : y ? "text-green-600" : "text-muted-foreground"}`,
              children: [
                y ? e.jsx($, {
                  className: "w-3 h-3"
                }) : e.jsx("div", {
                  className: "w-3 h-3 rounded-full border border-current"
                }),
                "\u7AE0\u8282\u89C4\u5212"
              ]
            })
          ]
        }),
        !p && !u && a === "chapter_prep_review" && e.jsxs(O, {
          className: "p-12 text-center border-dashed",
          children: [
            e.jsx("div", {
              className: "w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4",
              children: e.jsx(ie, {
                className: "w-8 h-8 text-primary"
              })
            }),
            e.jsx("h3", {
              className: "text-lg font-bold mb-2",
              children: h ? "\u5F00\u542F\u60A8\u7684\u521B\u4F5C\u4E4B\u65C5" : "\u51C6\u5907\u5F00\u59CB\u65B0\u7AE0\u8282"
            }),
            e.jsx("p", {
              className: "text-sm text-muted-foreground mb-8 max-w-md mx-auto",
              children: h ? "AI \u5C06\u6839\u636E\u60A8\u7684\u4E16\u754C\u89C2\u548C\u89D2\u8272\u8BBE\u5B9A\uFF0C\u4E3A\u60A8\u751F\u6210\u5F00\u7BC7\u5EFA\u8BAE\u548C\u521B\u4F5C\u7075\u611F\u3002" : "AI \u5C06\u56DE\u987E\u4E4B\u524D\u7684\u5267\u60C5\uFF0C\u5206\u6790\u5F53\u524D\u7684\u4F0F\u7B14\uFF0C\u4E3A\u60A8\u89C4\u5212\u672C\u7AE0\u7684\u5199\u4F5C\u65B9\u5411\u3002"
            }),
            e.jsxs(j, {
              size: "lg",
              onClick: d,
              className: "px-8",
              children: [
                e.jsx(z, {
                  className: "w-4 h-4 mr-2"
                }),
                h ? "\u5F00\u59CB\u5F00\u7BC7\u51C6\u5907" : "\u5F00\u59CB\u7AE0\u8282\u51C6\u5907"
              ]
            })
          ]
        }),
        !g && !u && a === "chapter_prep_interest" && e.jsxs(O, {
          className: "p-12 text-center border-dashed",
          children: [
            e.jsx("div", {
              className: "w-16 h-16 rounded-full bg-orange-500/10 flex items-center justify-center mx-auto mb-4",
              children: e.jsx(z, {
                className: "w-8 h-8 text-orange-500"
              })
            }),
            e.jsx("h3", {
              className: "text-lg font-bold mb-2",
              children: "\u5206\u6790\u672C\u7AE0\u5174\u8DA3\u70B9"
            }),
            e.jsx("p", {
              className: "text-sm text-muted-foreground mb-8 max-w-md mx-auto",
              children: "AI \u5C06\u6839\u636E\u524D\u60C5\u63D0\u8981\u548C\u4F0F\u7B14\uFF0C\u4E3A\u60A8\u63D0\u53D6\u672C\u7AE0\u7684\u770B\u70B9\u548C\u51B2\u7A81\u70B9\u3002"
            }),
            e.jsx(j, {
              size: "lg",
              onClick: d,
              className: "px-8 bg-orange-600 hover:bg-orange-700",
              children: "\u5F00\u59CB\u5206\u6790"
            })
          ]
        }),
        !w && !u && a === "chapter_prep_emotion" && e.jsxs(O, {
          className: "p-12 text-center border-dashed",
          children: [
            e.jsx("div", {
              className: "w-16 h-16 rounded-full bg-pink-500/10 flex items-center justify-center mx-auto mb-4",
              children: e.jsx(we, {
                className: "w-8 h-8 text-pink-500"
              })
            }),
            e.jsx("h3", {
              className: "text-lg font-bold mb-2",
              children: "\u8BBE\u8BA1\u60C5\u7EEA\u66F2\u7EBF"
            }),
            e.jsx("p", {
              className: "text-sm text-muted-foreground mb-8 max-w-md mx-auto",
              children: "AI \u5C06\u6839\u636E\u672C\u7AE0\u7684\u5174\u8DA3\u70B9\uFF0C\u4E3A\u60A8\u89C4\u5212\u8BFB\u8005\u7684\u60C5\u7EEA\u8D77\u4F0F\u3002"
            }),
            e.jsx(j, {
              size: "lg",
              onClick: d,
              className: "px-8 bg-pink-600 hover:bg-pink-700",
              children: "\u5F00\u59CB\u8BBE\u8BA1"
            })
          ]
        }),
        !y && !u && a === "chapter_plan_generation" && e.jsxs(O, {
          className: "p-12 text-center border-dashed",
          children: [
            e.jsx("div", {
              className: "w-16 h-16 rounded-full bg-blue-500/10 flex items-center justify-center mx-auto mb-4",
              children: e.jsx(ie, {
                className: "w-8 h-8 text-blue-500"
              })
            }),
            e.jsx("h3", {
              className: "text-lg font-bold mb-2",
              children: "\u751F\u6210\u7AE0\u8282\u89C4\u5212"
            }),
            e.jsx("p", {
              className: "text-sm text-muted-foreground mb-8 max-w-md mx-auto",
              children: "AI \u5C06\u6574\u5408\u6240\u6709\u51C6\u5907\u4FE1\u606F\uFF0C\u4E3A\u60A8\u751F\u6210\u8BE6\u7EC6\u7684\u672C\u7AE0\u5199\u4F5C\u5927\u7EB2\u3002"
            }),
            e.jsx(j, {
              size: "lg",
              onClick: d,
              className: "px-8 bg-blue-600 hover:bg-blue-700",
              children: "\u751F\u6210\u89C4\u5212"
            })
          ]
        }),
        p && e.jsxs(O, {
          className: "p-4 border-l-4 border-l-blue-500",
          children: [
            e.jsxs("h3", {
              className: "text-sm font-semibold mb-2 flex items-center gap-2",
              children: [
                e.jsx(ie, {
                  className: "w-4 h-4 text-blue-500"
                }),
                h ? "\u5F00\u7BC7\u5BC4\u8BED" : "\u524D\u60C5\u56DE\u987E"
              ]
            }),
            e.jsx("div", {
              className: "text-sm text-muted-foreground whitespace-pre-wrap leading-relaxed",
              children: p.data.reviewText
            }),
            a === "chapter_prep_review" && !u && e.jsx("div", {
              className: "mt-4 flex justify-end",
              children: e.jsxs(j, {
                size: "sm",
                onClick: c,
                children: [
                  "\u5206\u6790\u5174\u8DA3\u70B9",
                  e.jsx(F, {
                    className: "w-4 h-4 ml-2"
                  })
                ]
              })
            })
          ]
        }),
        g && e.jsxs(O, {
          className: "p-4 border-l-4 border-l-orange-500",
          children: [
            e.jsxs("h3", {
              className: "text-sm font-semibold mb-2 flex items-center gap-2",
              children: [
                e.jsx(z, {
                  className: "w-4 h-4 text-orange-500"
                }),
                "\u{1F3AF} \u5174\u8DA3\u70B9\u5206\u6790"
              ]
            }),
            (g.data.interestPoints || []).length > 0 ? e.jsx("div", {
              className: "grid grid-cols-1 md:grid-cols-2 gap-3",
              children: (g.data.interestPoints || []).map((m, _) => e.jsxs("div", {
                className: "flex items-start gap-2 p-2 rounded bg-muted/50",
                children: [
                  e.jsx("span", {
                    className: "text-[10px] font-bold px-1.5 py-0.5 rounded bg-orange-500/10 text-orange-600 uppercase",
                    children: m.type
                  }),
                  e.jsx("span", {
                    className: "text-sm text-muted-foreground",
                    children: m.content
                  })
                ]
              }, _))
            }) : e.jsx("div", {
              className: "text-sm text-muted-foreground whitespace-pre-wrap leading-relaxed",
              children: g.data.analysisText || g.data.content
            }),
            a === "chapter_prep_interest" && !u && e.jsx("div", {
              className: "mt-4 flex justify-end",
              children: e.jsxs(j, {
                size: "sm",
                onClick: c,
                children: [
                  "\u8BBE\u8BA1\u60C5\u7EEA\u66F2\u7EBF",
                  e.jsx(F, {
                    className: "w-4 h-4 ml-2"
                  })
                ]
              })
            })
          ]
        }),
        w && e.jsxs(O, {
          className: "p-4 border-l-4 border-l-pink-500",
          children: [
            e.jsxs("h3", {
              className: "text-sm font-semibold mb-2 flex items-center gap-2",
              children: [
                e.jsx(we, {
                  className: "w-4 h-4 text-pink-500"
                }),
                "\u{1F4AD} \u60C5\u7EEA\u8BBE\u8BA1"
              ]
            }),
            e.jsx("div", {
              className: "text-sm text-muted-foreground whitespace-pre-wrap leading-relaxed",
              children: w.data.emotionDesign
            }),
            a === "chapter_prep_emotion" && !u && e.jsx("div", {
              className: "mt-4 flex justify-end",
              children: e.jsxs(j, {
                size: "sm",
                onClick: c,
                children: [
                  "\u751F\u6210\u7AE0\u8282\u89C4\u5212",
                  e.jsx(F, {
                    className: "w-4 h-4 ml-2"
                  })
                ]
              })
            })
          ]
        }),
        y && e.jsxs(O, {
          className: "p-4",
          children: [
            e.jsx("h3", {
              className: "text-sm font-semibold mb-2",
              children: "\u{1F4DD} \u7AE0\u8282\u89C4\u5212"
            }),
            e.jsx("div", {
              className: "text-sm text-muted-foreground whitespace-pre-wrap",
              children: y.data.plan
            })
          ]
        }),
        u && x && e.jsx(O, {
          className: "p-4",
          children: e.jsxs("div", {
            className: "flex items-start gap-3",
            children: [
              e.jsx(H, {
                className: "w-5 h-5 animate-spin text-primary mt-1"
              }),
              e.jsxs("div", {
                className: "flex-1",
                children: [
                  e.jsx("h3", {
                    className: "text-sm font-semibold mb-2",
                    children: "AI \u751F\u6210\u4E2D..."
                  }),
                  e.jsx("div", {
                    className: "text-sm text-muted-foreground whitespace-pre-wrap",
                    children: x.data.content || ""
                  })
                ]
              })
            ]
          })
        }),
        a === "chapter_plan_approval" && e.jsxs("div", {
          className: "flex justify-end gap-3 pt-4 border-t",
          children: [
            e.jsx(j, {
              variant: "outline",
              onClick: S,
              children: "\u91CD\u65B0\u751F\u6210\u89C4\u5212"
            }),
            e.jsxs(j, {
              onClick: v,
              children: [
                "\u786E\u8BA4\u89C4\u5212\uFF0C\u5F00\u59CB\u5199\u4F5C",
                e.jsx(F, {
                  className: "w-4 h-4 ml-2"
                })
              ]
            })
          ]
        }),
        e.jsx("div", {
          className: "text-xs text-muted-foreground p-3 bg-muted/30 rounded",
          children: "\u{1F4A1} \u63D0\u793A\uFF1A\u7AE0\u8282\u51C6\u5907\u9636\u6BB5\u4F1A\u81EA\u52A8\u8FDB\u884C\u524D\u60C5\u56DE\u987E\u3001\u5174\u8DA3\u70B9\u5206\u6790\u3001\u60C5\u7EEA\u8BBE\u8BA1\u548C\u7AE0\u8282\u89C4\u5212\uFF0C\u5E2E\u52A9\u60A8\u66F4\u597D\u5730\u6784\u601D\u672C\u7AE0\u5185\u5BB9\u3002"
        })
      ]
    });
  };
  jn = ({ sessionId: t }) => {
    var _a, _b, _c, _d, _e2, _f, _g, _h, _i;
    const s = Y(o), n = se((P) => P.config), { runLoop: r } = ce(), a = (_b = (_a = s.currentSession) == null ? void 0 : _a.modeState) == null ? void 0 : _b.currentPhase, i = (_d = (_c = s.currentSession) == null ? void 0 : _c.modeState) == null ? void 0 : _d.currentChapter, l = (_e2 = s.contextManager) == null ? void 0 : _e2.state.processingItem, x = ((_g = (_f = s.currentSession) == null ? void 0 : _f.modeState) == null ? void 0 : _g.tempData) || {}, p = x.writeMode || "ai_direct", g = x.userInstruction || "", w = x.userContent || "", y = x.selectedCharacter || "", d = (i == null ? void 0 : i.blocks) || [], c = (i == null ? void 0 : i.targetWordCount) || 4e3, v = (i == null ? void 0 : i.wordCount) || 0, S = Math.min(v / c * 100, 100), [u, h] = T.useState(""), [m, _] = T.useState(""), [N, b] = T.useState(false);
    T.useEffect(() => {
      h(g);
    }, [
      g
    ]), T.useEffect(() => {
      _(w);
    }, [
      w
    ]);
    const E = (P) => {
      o.updateTempData(P);
    }, X = () => {
      E({
        userInstruction: u
      });
    }, Q = () => {
      E({
        userContent: m
      });
    }, le = async () => {
      b(true);
      try {
        const P = o.currentSession, te = o.contextManager;
        if (!P || !te) return;
        const rt = Z.makeMessagesForInstructionSuggestion(P, te);
        let xe = "";
        await q(n, rt.map((ge) => ({
          role: ge.role,
          content: ge.content,
          id: k()
        })), [], (ge, at) => {
          xe = at;
        }), h(xe), E({
          userInstruction: xe
        }), C.success("AI \u5DF2\u5EFA\u8BAE\u5199\u4F5C\u6307\u4EE4");
      } catch (P) {
        console.error("AI suggestion error:", P), C.error("AI \u5EFA\u8BAE\u5931\u8D25");
      } finally {
        b(false);
      }
    }, tt = async () => {
      if (o.sessionManager) {
        if (E({
          userInstruction: u,
          userContent: m
        }), p === "ai_direct" && !u) {
          const te = "\u8BF7\u6839\u636E\u7AE0\u8282\u89C4\u5212\u7EED\u5199\u5267\u60C5\u3002";
          h(te), E({
            userInstruction: te
          });
        }
        o.setUIState("block_write_running"), await o.updateSessionInDB(), r(t, true);
      }
    }, st = async () => {
      o.sessionManager && (h(""), _(""), E({
        userInstruction: "",
        userContent: "",
        latestBlockEvaluation: null
      }), v >= c ? (o.setPhase("chapter_check"), o.setUIState("chapter_complete")) : o.setUIState("block_write_ready"), await o.updateSessionInDB());
    }, nt = async () => {
      r(t, true);
    }, be = l !== void 0;
    return e.jsxs("div", {
      className: "space-y-6",
      children: [
        e.jsx("div", {
          className: "flex items-center justify-between",
          children: e.jsxs("div", {
            children: [
              e.jsxs("h2", {
                className: "text-2xl font-bold",
                children: [
                  "\u7B2C ",
                  (i == null ? void 0 : i.number) || 1,
                  " \u7AE0\uFF1A",
                  (i == null ? void 0 : i.title) || "\u672A\u547D\u540D"
                ]
              }),
              e.jsxs("div", {
                className: "flex items-center gap-4 mt-1",
                children: [
                  e.jsxs("p", {
                    className: "text-sm text-muted-foreground",
                    children: [
                      "\u5DF2\u5199 ",
                      v.toLocaleString(),
                      " / ",
                      c.toLocaleString(),
                      " \u5B57"
                    ]
                  }),
                  e.jsx("div", {
                    className: "flex-1 h-2 bg-muted rounded-full overflow-hidden max-w-xs",
                    children: e.jsx("div", {
                      className: "h-full bg-primary transition-all",
                      style: {
                        width: `${S}%`
                      }
                    })
                  })
                ]
              })
            ]
          })
        }),
        d.length > 0 && e.jsxs("div", {
          className: "space-y-3",
          children: [
            e.jsxs("h3", {
              className: "text-sm font-semibold",
              children: [
                "\u5DF2\u5B8C\u6210\u7247\u6BB5 (",
                d.length,
                ")"
              ]
            }),
            d.map((P, te) => e.jsxs(O, {
              className: "p-4",
              children: [
                e.jsxs("div", {
                  className: "flex items-start justify-between mb-2",
                  children: [
                    e.jsxs("span", {
                      className: "text-xs font-medium text-muted-foreground",
                      children: [
                        "\u7247\u6BB5 ",
                        te + 1,
                        " \xB7 ",
                        P.wordCount,
                        " \u5B57 \xB7 ",
                        P.writeMode === "ai_direct" ? "AI\u76F4\u63A5" : P.writeMode === "ai_guided" ? "AI\u5F15\u5BFC" : P.writeMode === "user_polish" ? "\u7528\u6237\u6DA6\u8272" : "\u89D2\u8272\u626E\u6F14"
                      ]
                    }),
                    e.jsx($, {
                      className: "w-4 h-4 text-green-500"
                    })
                  ]
                }),
                e.jsx("div", {
                  className: "text-sm whitespace-pre-wrap",
                  children: P.content
                })
              ]
            }, P.id))
          ]
        }),
        be && l && e.jsxs(O, {
          className: "p-4 border-primary bg-primary/5",
          children: [
            e.jsxs("div", {
              className: "flex items-start gap-3 mb-2",
              children: [
                e.jsx(H, {
                  className: "w-5 h-5 animate-spin text-primary mt-1"
                }),
                e.jsx("h3", {
                  className: "text-sm font-semibold",
                  children: "AI \u6B63\u5728\u521B\u4F5C\u4E2D..."
                })
              ]
            }),
            e.jsx("div", {
              className: "text-sm whitespace-pre-wrap",
              children: l.data.content || ""
            })
          ]
        }),
        a === "block_write" && !be && e.jsx(O, {
          className: "p-6 border-t-4 border-t-primary",
          children: e.jsxs("div", {
            className: "space-y-4",
            children: [
              e.jsxs("div", {
                className: "flex items-center justify-between mb-2",
                children: [
                  e.jsxs("h3", {
                    className: "text-lg font-bold flex items-center gap-2",
                    children: [
                      e.jsx(z, {
                        className: "w-5 h-5 text-primary"
                      }),
                      "\u63A5\u4E0B\u6765\u7684\u5199\u4F5C\u8BA1\u5212"
                    ]
                  }),
                  e.jsxs("div", {
                    className: "text-xs text-muted-foreground bg-muted px-2 py-1 rounded",
                    children: [
                      "\u5F53\u524D\u6A21\u5F0F: ",
                      p === "ai_direct" ? "AI \u76F4\u63A5\u5199\u4F5C" : p === "ai_guided" ? "AI \u5F15\u5BFC\u5199\u4F5C" : p === "user_polish" ? "\u7528\u6237\u6DA6\u8272" : "\u89D2\u8272\u626E\u6F14"
                    ]
                  })
                ]
              }),
              e.jsxs("div", {
                className: "grid grid-cols-1 md:grid-cols-2 gap-4",
                children: [
                  e.jsxs("div", {
                    className: "space-y-2",
                    children: [
                      e.jsx(W, {
                        children: "\u5199\u4F5C\u6A21\u5F0F"
                      }),
                      e.jsxs(Ee, {
                        value: p,
                        onValueChange: (P) => E({
                          writeMode: P
                        }),
                        children: [
                          e.jsx(Me, {
                            children: e.jsx(Pe, {})
                          }),
                          e.jsxs(Oe, {
                            children: [
                              e.jsx(de, {
                                value: "ai_direct",
                                children: "AI \u76F4\u63A5\u5199\u4F5C"
                              }),
                              e.jsx(de, {
                                value: "ai_guided",
                                children: "AI \u5F15\u5BFC\u5199\u4F5C"
                              }),
                              e.jsx(de, {
                                value: "user_polish",
                                children: "\u7528\u6237\u63D0\u4F9B\u521D\u7A3F\uFF0CAI \u6DA6\u8272"
                              }),
                              e.jsx(de, {
                                value: "roleplay",
                                children: "\u89D2\u8272\u626E\u6F14\u6A21\u5F0F"
                              })
                            ]
                          })
                        ]
                      })
                    ]
                  }),
                  p === "roleplay" && e.jsxs("div", {
                    className: "space-y-2",
                    children: [
                      e.jsx(W, {
                        children: "\u9009\u62E9\u89D2\u8272"
                      }),
                      e.jsxs(Ee, {
                        value: y,
                        onValueChange: (P) => E({
                          selectedCharacter: P
                        }),
                        children: [
                          e.jsx(Me, {
                            children: e.jsx(Pe, {
                              placeholder: "\u9009\u62E9\u89D2\u8272..."
                            })
                          }),
                          e.jsx(Oe, {
                            children: (((_i = (_h = s.currentSession) == null ? void 0 : _h.modeConfig) == null ? void 0 : _i.keyCharacters) || []).map((P) => e.jsx(de, {
                              value: P.id,
                              children: P.name
                            }, P.id))
                          })
                        ]
                      })
                    ]
                  })
                ]
              }),
              (p === "ai_guided" || p === "ai_direct") && e.jsxs("div", {
                className: "space-y-2",
                children: [
                  e.jsxs("div", {
                    className: "flex items-center justify-between",
                    children: [
                      e.jsxs(W, {
                        className: "flex items-center gap-2",
                        children: [
                          "\u5199\u4F5C\u6307\u4EE4",
                          e.jsx("span", {
                            className: "text-[10px] font-normal text-muted-foreground",
                            children: "(\u53EF\u9009\uFF0C\u7559\u7A7A\u5219\u7531 AI \u81EA\u4E3B\u53D1\u6325)"
                          })
                        ]
                      }),
                      e.jsxs(j, {
                        size: "xs",
                        variant: "ghost",
                        className: "h-7 text-xs",
                        onClick: le,
                        disabled: N,
                        children: [
                          N ? e.jsx(H, {
                            className: "w-3 h-3 mr-1 animate-spin"
                          }) : e.jsx(he, {
                            className: "w-3 h-3 mr-1"
                          }),
                          "AI \u5EFA\u8BAE\u6307\u4EE4"
                        ]
                      })
                    ]
                  }),
                  e.jsx(G, {
                    placeholder: "\u4F8B\u5982\uFF1A\u63CF\u5199\u4E3B\u89D2\u8FDB\u5165\u9152\u9986\u65F6\u7684\u5FC3\u7406\u6D3B\u52A8\uFF0C\u6216\u8005\u589E\u52A0\u4E00\u6BB5\u5173\u4E8E\u73AF\u5883\u7684\u63CF\u5199...",
                    value: u,
                    onChange: (P) => h(P.target.value),
                    onBlur: X,
                    rows: 3,
                    className: "resize-none"
                  })
                ]
              }),
              p === "user_polish" && e.jsxs("div", {
                className: "space-y-2",
                children: [
                  e.jsx(W, {
                    children: "\u60A8\u7684\u521D\u7A3F"
                  }),
                  e.jsx(G, {
                    placeholder: "\u5728\u8FD9\u91CC\u8F93\u5165\u60A8\u7684\u8349\u7A3F\uFF0CAI \u5C06\u4E3A\u60A8\u8FDB\u884C\u6587\u5B66\u5316\u6DA6\u8272...",
                    value: m,
                    onChange: (P) => _(P.target.value),
                    onBlur: Q,
                    rows: 6
                  })
                ]
              }),
              e.jsxs(j, {
                onClick: tt,
                className: "w-full py-6 text-lg font-bold shadow-lg hover:shadow-primary/20 transition-all",
                children: [
                  e.jsx(z, {
                    className: "w-5 h-5 mr-2"
                  }),
                  d.length === 0 ? "\u5F00\u59CB\u64B0\u5199\u7B2C\u4E00\u7AE0" : "\u7EE7\u7EED\u64B0\u5199\u4E0B\u4E00\u6BB5"
                ]
              })
            ]
          })
        }),
        a === "block_confirm" && e.jsxs("div", {
          className: "flex justify-end gap-3 pt-4 border-t",
          children: [
            e.jsxs(j, {
              variant: "outline",
              onClick: nt,
              children: [
                e.jsx($e, {
                  className: "w-4 h-4 mr-2"
                }),
                "\u91CD\u65B0\u751F\u6210"
              ]
            }),
            e.jsxs(j, {
              onClick: st,
              children: [
                "\u63A5\u53D7\u5E76\u7EE7\u7EED",
                e.jsx(F, {
                  className: "w-4 h-4 ml-2"
                })
              ]
            })
          ]
        })
      ]
    });
  };
  Cn = ({ sessionId: t }) => {
    var _a, _b, _c, _d, _e2, _f, _g, _h, _i, _j, _k;
    const s = Y(o), { runLoop: n } = ce(), r = (_b = (_a = s.currentSession) == null ? void 0 : _a.modeState) == null ? void 0 : _b.currentPhase, a = (_d = (_c = s.currentSession) == null ? void 0 : _c.modeState) == null ? void 0 : _d.currentChapter, i = ((_e2 = s.contextManager) == null ? void 0 : _e2.state.historyItems) || [], l = (_f = s.contextManager) == null ? void 0 : _f.state.processingItem, x = [
      ...i
    ].reverse().find((d) => d.type === "novel_chapter_summary"), p = [
      ...i
    ].reverse().find((d) => d.type === "novel_knowledge_update"), g = async () => {
      const d = o.sessionManager;
      d && (d.completeCurrentChapter(), d.enterNextState("completion_check"), await o.updateSessionInDB(), n(t, true));
    }, w = async () => {
      const d = o.sessionManager;
      if (!d) return;
      d.completeCurrentChapter();
      const c = ((a == null ? void 0 : a.number) || 1) + 1;
      d.initializeNewChapter(c), d.enterNextState("chapter_prep_review"), await o.updateSessionInDB(), n(t, true);
    }, y = l !== void 0;
    return e.jsxs("div", {
      className: "space-y-6",
      children: [
        e.jsxs("div", {
          className: "flex items-center justify-between",
          children: [
            e.jsxs("div", {
              children: [
                e.jsxs("h2", {
                  className: "text-2xl font-bold",
                  children: [
                    "\u7B2C ",
                    (a == null ? void 0 : a.number) || 1,
                    " \u7AE0\uFF1A",
                    (a == null ? void 0 : a.title) || "\u672A\u547D\u540D"
                  ]
                }),
                e.jsxs("p", {
                  className: "text-sm text-muted-foreground",
                  children: [
                    "\u5DF2\u5B8C\u6210 ",
                    ((_g = a == null ? void 0 : a.wordCount) == null ? void 0 : _g.toLocaleString()) || 0,
                    " \u5B57"
                  ]
                })
              ]
            }),
            e.jsxs("div", {
              className: "flex items-center gap-2 text-green-600",
              children: [
                e.jsx($, {
                  className: "w-5 h-5"
                }),
                e.jsx("span", {
                  className: "font-medium",
                  children: "\u7AE0\u8282\u5B8C\u6210"
                })
              ]
            })
          ]
        }),
        x && e.jsxs(O, {
          className: "p-4",
          children: [
            e.jsx("h3", {
              className: "text-sm font-semibold mb-2",
              children: "\u{1F4C4} \u7AE0\u8282\u6458\u8981"
            }),
            e.jsx("div", {
              className: "text-sm text-muted-foreground whitespace-pre-wrap",
              children: x.data.summary
            })
          ]
        }),
        p && e.jsxs(O, {
          className: "p-4",
          children: [
            e.jsx("h3", {
              className: "text-sm font-semibold mb-2",
              children: "\u{1F4DA} \u77E5\u8BC6\u5E93\u66F4\u65B0"
            }),
            e.jsxs("div", {
              className: "space-y-3 text-sm",
              children: [
                ((_i = (_h = p.data.updates) == null ? void 0 : _h.newEntities) == null ? void 0 : _i.length) > 0 && e.jsxs("div", {
                  children: [
                    e.jsx("div", {
                      className: "font-medium mb-1",
                      children: "\u65B0\u589E\u5B9E\u4F53\uFF1A"
                    }),
                    e.jsx("div", {
                      className: "space-y-1",
                      children: p.data.updates.newEntities.map((d, c) => e.jsxs("div", {
                        className: "text-muted-foreground",
                        children: [
                          "\xB7 ",
                          d.name || d.id
                        ]
                      }, c))
                    })
                  ]
                }),
                ((_k = (_j = p.data.updates) == null ? void 0 : _j.newEvents) == null ? void 0 : _k.length) > 0 && e.jsxs("div", {
                  children: [
                    e.jsx("div", {
                      className: "font-medium mb-1",
                      children: "\u65B0\u589E\u4E8B\u4EF6\uFF1A"
                    }),
                    e.jsx("div", {
                      className: "space-y-1",
                      children: p.data.updates.newEvents.map((d, c) => e.jsxs("div", {
                        className: "text-muted-foreground",
                        children: [
                          "\xB7 ",
                          d.description || d.id
                        ]
                      }, c))
                    })
                  ]
                })
              ]
            })
          ]
        }),
        y && l && e.jsx(O, {
          className: "p-4",
          children: e.jsxs("div", {
            className: "flex items-start gap-3",
            children: [
              e.jsx(H, {
                className: "w-5 h-5 animate-spin text-primary mt-1"
              }),
              e.jsxs("div", {
                className: "flex-1",
                children: [
                  e.jsx("h3", {
                    className: "text-sm font-semibold mb-2",
                    children: "AI \u5904\u7406\u4E2D..."
                  }),
                  e.jsx("div", {
                    className: "text-sm text-muted-foreground whitespace-pre-wrap",
                    children: l.data.content || ""
                  })
                ]
              })
            ]
          })
        }),
        r === "re_planning_check" && !y && e.jsxs("div", {
          className: "flex justify-end gap-3 pt-4 border-t",
          children: [
            e.jsx(j, {
              variant: "outline",
              onClick: g,
              children: "\u5B8C\u6210\u5C0F\u8BF4\uFF08\u8FDB\u5165\u5B8C\u7ED3\u6D41\u7A0B\uFF09"
            }),
            e.jsxs(j, {
              onClick: w,
              children: [
                "\u7EE7\u7EED\u4E0B\u4E00\u7AE0",
                e.jsx(F, {
                  className: "w-4 h-4 ml-2"
                })
              ]
            })
          ]
        }),
        e.jsx("div", {
          className: "text-xs text-muted-foreground p-3 bg-muted/30 rounded",
          children: "\u{1F4A1} \u63D0\u793A\uFF1A\u6BCF\u7AE0\u5B8C\u6210\u540E\u4F1A\u81EA\u52A8\u751F\u6210\u6458\u8981\u5E76\u66F4\u65B0\u77E5\u8BC6\u5E93\u3002\u60A8\u53EF\u4EE5\u9009\u62E9\u7EE7\u7EED\u4E0B\u4E00\u7AE0\u6216\u8FDB\u5165\u5B8C\u7ED3\u6D41\u7A0B\u3002"
        })
      ]
    });
  };
  Tn = ({ sessionId: t }) => {
    var _a, _b, _c, _d;
    const s = Y(o), { runLoop: n } = ce(), r = (_b = (_a = s.currentSession) == null ? void 0 : _a.modeState) == null ? void 0 : _b.currentPhase, a = (_d = (_c = s.currentSession) == null ? void 0 : _c.modeState) == null ? void 0 : _d.currentChapter, i = async () => {
      const l = o.sessionManager;
      l && (l.initializeNewChapter(1), l.enterNextState("chapter_prep_review"), await o.updateSessionInDB(), n(t, true));
    };
    return r === "chapter_prep_review" || r === "chapter_prep_foreshadow" || r === "chapter_prep_interest" || r === "chapter_prep_emotion" || r === "chapter_plan_generation" || r === "chapter_plan_approval" ? e.jsx("div", {
      className: "max-w-4xl mx-auto",
      children: e.jsx(In, {
        sessionId: t
      })
    }) : r === "block_write" || r === "block_check" || r === "block_confirm" ? e.jsx("div", {
      className: "max-w-5xl mx-auto",
      children: e.jsx(jn, {
        sessionId: t
      })
    }) : r === "chapter_check" || r === "chapter_confirm" || r === "chapter_summary_generation" || r === "knowledge_update" || r === "re_planning_check" ? e.jsx("div", {
      className: "max-w-4xl mx-auto",
      children: e.jsx(Cn, {
        sessionId: t
      })
    }) : a ? e.jsx("div", {
      className: "max-w-4xl mx-auto",
      children: e.jsx(O, {
        className: "p-6",
        children: e.jsxs("div", {
          className: "text-center py-8 text-muted-foreground",
          children: [
            e.jsx(H, {
              className: "w-8 h-8 animate-spin mx-auto mb-2"
            }),
            e.jsx("p", {
              children: "\u52A0\u8F7D\u4E2D..."
            })
          ]
        })
      })
    }) : e.jsx("div", {
      className: "max-w-4xl mx-auto",
      children: e.jsx(O, {
        className: "p-6",
        children: e.jsxs("div", {
          className: "text-center py-12",
          children: [
            e.jsx("div", {
              className: "w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4",
              children: e.jsx(ie, {
                className: "w-8 h-8 text-primary"
              })
            }),
            e.jsx("h3", {
              className: "text-lg font-semibold mb-2",
              children: "\u51C6\u5907\u5F00\u59CB\u5199\u4F5C"
            }),
            e.jsx("p", {
              className: "text-sm text-muted-foreground mb-6",
              children: "\u4E00\u5207\u51C6\u5907\u5C31\u7EEA\uFF0C\u70B9\u51FB\u4E0B\u65B9\u6309\u94AE\u5F00\u59CB\u7B2C\u4E00\u7AE0\u7684\u521B\u4F5C"
            }),
            e.jsxs(j, {
              onClick: i,
              children: [
                "\u5F00\u59CB\u7B2C\u4E00\u7AE0",
                e.jsx(F, {
                  className: "w-4 h-4 ml-2"
                })
              ]
            })
          ]
        })
      })
    });
  };
  An = () => {
    var _a, _b, _c, _d, _e2, _f, _g;
    const t = Y(o), s = (_b = (_a = t.currentSession) == null ? void 0 : _a.modeState) == null ? void 0 : _b.currentPhase, n = ((_c = t.contextManager) == null ? void 0 : _c.state.historyItems) || [], r = (_d = t.contextManager) == null ? void 0 : _d.state.processingItem, a = (_f = (_e2 = t.currentSession) == null ? void 0 : _e2.modeState) == null ? void 0 : _f.progressTracking, i = [
      ...n
    ].reverse().find((c) => c.type === "novel_completion_check"), l = [
      ...n
    ].reverse().find((c) => c.type === "novel_book_summary"), x = [
      ...n
    ].reverse().find((c) => c.type === "novel_recommendation"), p = [
      ...n
    ].reverse().find((c) => c.type === "novel_reading_guide"), g = [
      ...n
    ].reverse().find((c) => c.type === "novel_author_note"), w = [
      ...n
    ].reverse().find((c) => c.type === "novel_cover_description"), y = r !== void 0, d = () => {
      C.info("\u5BFC\u51FA\u529F\u80FD\u5F00\u53D1\u4E2D...");
    };
    return s === "completed" ? e.jsxs("div", {
      className: "max-w-4xl mx-auto space-y-6",
      children: [
        e.jsxs(O, {
          className: "p-8 text-center",
          children: [
            e.jsx("div", {
              className: "w-20 h-20 rounded-full bg-gradient-to-br from-yellow-500 to-orange-500 flex items-center justify-center mx-auto mb-4",
              children: e.jsx(Tt, {
                className: "w-10 h-10 text-white"
              })
            }),
            e.jsx("h2", {
              className: "text-3xl font-bold mb-2",
              children: "\u{1F389} \u606D\u559C\u5B8C\u6210\u521B\u4F5C\uFF01"
            }),
            e.jsxs("p", {
              className: "text-muted-foreground mb-6",
              children: [
                "\u60A8\u5DF2\u5B8C\u6210 ",
                (a == null ? void 0 : a.completedChapters) || 0,
                " \u7AE0\uFF0C\u5171\u8BA1 ",
                ((_g = a == null ? void 0 : a.totalWordCount) == null ? void 0 : _g.toLocaleString()) || 0,
                " \u5B57"
              ]
            }),
            e.jsxs(j, {
              size: "lg",
              onClick: d,
              children: [
                e.jsx(At, {
                  className: "w-5 h-5 mr-2"
                }),
                "\u5BFC\u51FA\u5C0F\u8BF4"
              ]
            })
          ]
        }),
        l && e.jsxs(O, {
          className: "p-6",
          children: [
            e.jsxs("h3", {
              className: "text-lg font-semibold mb-3 flex items-center gap-2",
              children: [
                e.jsx($, {
                  className: "w-5 h-5 text-green-500"
                }),
                "\u5168\u4E66\u6458\u8981"
              ]
            }),
            e.jsx("div", {
              className: "text-sm text-muted-foreground whitespace-pre-wrap",
              children: l.data.summary
            })
          ]
        }),
        x && e.jsxs(O, {
          className: "p-6",
          children: [
            e.jsxs("h3", {
              className: "text-lg font-semibold mb-3 flex items-center gap-2",
              children: [
                e.jsx($, {
                  className: "w-5 h-5 text-green-500"
                }),
                "\u63A8\u8350\u8BED"
              ]
            }),
            e.jsxs("div", {
              className: "space-y-3",
              children: [
                e.jsxs("div", {
                  children: [
                    e.jsx("div", {
                      className: "text-xs font-medium text-muted-foreground mb-1",
                      children: "\u7B80\u77ED\u7248\uFF1A"
                    }),
                    e.jsx("div", {
                      className: "text-sm",
                      children: x.data.shortVersion
                    })
                  ]
                }),
                e.jsxs("div", {
                  children: [
                    e.jsx("div", {
                      className: "text-xs font-medium text-muted-foreground mb-1",
                      children: "\u8BE6\u7EC6\u7248\uFF1A"
                    }),
                    e.jsx("div", {
                      className: "text-sm text-muted-foreground",
                      children: x.data.longVersion
                    })
                  ]
                })
              ]
            })
          ]
        }),
        p && e.jsxs(O, {
          className: "p-6",
          children: [
            e.jsxs("h3", {
              className: "text-lg font-semibold mb-3 flex items-center gap-2",
              children: [
                e.jsx($, {
                  className: "w-5 h-5 text-green-500"
                }),
                "\u5BFC\u8BFB"
              ]
            }),
            e.jsx("div", {
              className: "text-sm text-muted-foreground whitespace-pre-wrap",
              children: p.data.guide
            })
          ]
        }),
        g && e.jsxs(O, {
          className: "p-6",
          children: [
            e.jsxs("h3", {
              className: "text-lg font-semibold mb-3 flex items-center gap-2",
              children: [
                e.jsx($, {
                  className: "w-5 h-5 text-green-500"
                }),
                "\u4F5C\u8005\u7684\u8BDD"
              ]
            }),
            e.jsx("div", {
              className: "text-sm text-muted-foreground whitespace-pre-wrap",
              children: g.data.note
            })
          ]
        }),
        w && e.jsxs(O, {
          className: "p-6",
          children: [
            e.jsxs("h3", {
              className: "text-lg font-semibold mb-3 flex items-center gap-2",
              children: [
                e.jsx($, {
                  className: "w-5 h-5 text-green-500"
                }),
                "\u5C01\u9762\u63CF\u8FF0\uFF08\u7528\u4E8E AI \u7ED8\u56FE\uFF09"
              ]
            }),
            e.jsx("div", {
              className: "text-sm text-muted-foreground whitespace-pre-wrap",
              children: w.data.description
            })
          ]
        })
      ]
    }) : e.jsxs("div", {
      className: "max-w-4xl mx-auto space-y-6",
      children: [
        e.jsxs(O, {
          className: "p-6",
          children: [
            e.jsx("h2", {
              className: "text-2xl font-bold mb-4",
              children: "\u5C0F\u8BF4\u5B8C\u7ED3\u5904\u7406\u4E2D"
            }),
            e.jsxs("div", {
              className: "space-y-4",
              children: [
                e.jsxs("div", {
                  className: `flex items-center gap-3 ${i ? "text-green-600" : "text-muted-foreground"}`,
                  children: [
                    i ? e.jsx($, {
                      className: "w-5 h-5"
                    }) : e.jsx("div", {
                      className: "w-5 h-5 rounded-full border-2"
                    }),
                    e.jsx("span", {
                      children: "\u5B8C\u7ED3\u68C0\u67E5"
                    })
                  ]
                }),
                e.jsxs("div", {
                  className: `flex items-center gap-3 ${l ? "text-green-600" : "text-muted-foreground"}`,
                  children: [
                    l ? e.jsx($, {
                      className: "w-5 h-5"
                    }) : e.jsx("div", {
                      className: "w-5 h-5 rounded-full border-2"
                    }),
                    e.jsx("span", {
                      children: "\u751F\u6210\u5168\u4E66\u6458\u8981"
                    })
                  ]
                }),
                e.jsxs("div", {
                  className: `flex items-center gap-3 ${x ? "text-green-600" : "text-muted-foreground"}`,
                  children: [
                    x ? e.jsx($, {
                      className: "w-5 h-5"
                    }) : e.jsx("div", {
                      className: "w-5 h-5 rounded-full border-2"
                    }),
                    e.jsx("span", {
                      children: "\u751F\u6210\u63A8\u8350\u8BED"
                    })
                  ]
                }),
                e.jsxs("div", {
                  className: `flex items-center gap-3 ${p ? "text-green-600" : "text-muted-foreground"}`,
                  children: [
                    p ? e.jsx($, {
                      className: "w-5 h-5"
                    }) : e.jsx("div", {
                      className: "w-5 h-5 rounded-full border-2"
                    }),
                    e.jsx("span", {
                      children: "\u751F\u6210\u5BFC\u8BFB"
                    })
                  ]
                }),
                e.jsxs("div", {
                  className: `flex items-center gap-3 ${g ? "text-green-600" : "text-muted-foreground"}`,
                  children: [
                    g ? e.jsx($, {
                      className: "w-5 h-5"
                    }) : e.jsx("div", {
                      className: "w-5 h-5 rounded-full border-2"
                    }),
                    e.jsx("span", {
                      children: "\u751F\u6210\u4F5C\u8005\u7684\u8BDD"
                    })
                  ]
                }),
                e.jsxs("div", {
                  className: `flex items-center gap-3 ${w ? "text-green-600" : "text-muted-foreground"}`,
                  children: [
                    w ? e.jsx($, {
                      className: "w-5 h-5"
                    }) : e.jsx("div", {
                      className: "w-5 h-5 rounded-full border-2"
                    }),
                    e.jsx("span", {
                      children: "\u751F\u6210\u5C01\u9762\u63CF\u8FF0"
                    })
                  ]
                })
              ]
            })
          ]
        }),
        y && r && e.jsx(O, {
          className: "p-6",
          children: e.jsxs("div", {
            className: "flex items-start gap-3",
            children: [
              e.jsx(H, {
                className: "w-5 h-5 animate-spin text-primary mt-1"
              }),
              e.jsxs("div", {
                className: "flex-1",
                children: [
                  e.jsx("h3", {
                    className: "text-sm font-semibold mb-2",
                    children: "AI \u751F\u6210\u4E2D..."
                  }),
                  e.jsx("div", {
                    className: "text-sm text-muted-foreground whitespace-pre-wrap",
                    children: r.data.content || ""
                  })
                ]
              })
            ]
          })
        }),
        e.jsx("div", {
          className: "text-xs text-muted-foreground p-3 bg-muted/30 rounded",
          children: "\u{1F4A1} \u63D0\u793A\uFF1AAI \u6B63\u5728\u4E3A\u60A8\u7684\u5C0F\u8BF4\u751F\u6210\u5B8C\u7ED3\u8D44\u6599\uFF0C\u5305\u62EC\u6458\u8981\u3001\u63A8\u8350\u8BED\u3001\u5BFC\u8BFB\u7B49\uFF0C\u8BF7\u7A0D\u5019..."
        })
      ]
    });
  };
  sr = (t) => {
    var _a, _b, _c, _d, _e2, _f, _g, _h;
    const s = T.useRef(null), [n, r] = T.useState(false), [a, i] = T.useState(false), l = Y(o), { data: x = [] } = lt((u) => u.from({
      s: ct
    })), p = x.find((u) => u.id === t.sessionId);
    T.useEffect(() => {
      var _a2;
      let u = false;
      if (!p) return;
      if (((_a2 = o.currentSession) == null ? void 0 : _a2.id) === p.id && o.contextManager) {
        i(true);
        return;
      }
      return (async () => {
        try {
          await o.loadSession(p), u || i(true);
        } catch (m) {
          console.error("Load session error", m);
        }
      })(), () => {
        u = true;
      };
    }, [
      p == null ? void 0 : p.id,
      p
    ]);
    const { runLoop: g, startDesign: w } = ce();
    T.useEffect(() => {
      s.current && (s.current.scrollTop = s.current.scrollHeight);
    });
    const y = async () => {
      if (n) return;
      const u = o.sessionManager, h = o.contextManager;
      if (u && h) {
        r(true);
        try {
          u.getActualCurrentPhase(h) === "design_worldview" ? await w() : await g(p.id);
        } finally {
          r(false);
        }
      }
    };
    if (!(p && a)) return e.jsxs("div", {
      className: "flex flex-col items-center justify-center h-full text-muted-foreground gap-4",
      children: [
        e.jsx("div", {
          className: "w-12 h-12 rounded-2xl bg-muted animate-pulse flex items-center justify-center",
          children: e.jsx(we, {
            className: "w-6 h-6 opacity-20"
          })
        }),
        e.jsx("p", {
          className: "text-xs font-medium tracking-widest uppercase opacity-50",
          children: "\u6B63\u5728\u52A0\u8F7D\u5C0F\u8BF4\u9879\u76EE..."
        })
      ]
    });
    const d = o.sessionManager && o.contextManager ? o.sessionManager.getActualCurrentUIState(o.contextManager) : ((_b = (_a = l.currentSession) == null ? void 0 : _a.modeState) == null ? void 0 : _b.currentUIState) || "idle", c = (_d = (_c = l.currentSession) == null ? void 0 : _c.modeState) == null ? void 0 : _d.currentPhase, v = Js[d], S = () => c ? c.startsWith("design_") ? e.jsx(vn, {
      sessionId: t.sessionId
    }) : c === "ai_review" || c === "user_revision" ? e.jsx(bn, {
      sessionId: t.sessionId
    }) : c.startsWith("chapter_") || c.startsWith("block_") || c === "re_planning_check" || c === "knowledge_update" ? e.jsx(Tn, {
      sessionId: t.sessionId
    }) : c === "completion_check" || c.includes("_generation") || c === "completed" ? e.jsx(An, {
      sessionId: t.sessionId
    }) : null : null;
    return e.jsxs("div", {
      className: "flex flex-col h-full bg-background",
      children: [
        e.jsxs("div", {
          className: "flex items-center justify-between px-4 py-3 border-b bg-muted/30",
          children: [
            e.jsxs("div", {
              className: "flex items-center gap-3",
              children: [
                e.jsx("div", {
                  className: "w-8 h-8 rounded-lg bg-linear-to-br from-purple-500 to-pink-500 flex items-center justify-center",
                  children: e.jsx(ie, {
                    className: "w-4 h-4 text-white"
                  })
                }),
                e.jsxs("div", {
                  children: [
                    e.jsx("h2", {
                      className: "text-sm font-semibold",
                      children: ((_f = (_e2 = l.currentSession) == null ? void 0 : _e2.modeConfig) == null ? void 0 : _f.projectName) || "\u65B0\u5C0F\u8BF4\u9879\u76EE"
                    }),
                    e.jsx("p", {
                      className: "text-xs text-muted-foreground",
                      children: (v == null ? void 0 : v.label) || d
                    })
                  ]
                })
              ]
            }),
            e.jsxs("div", {
              className: "flex items-center gap-2",
              children: [
                ((_h = (_g = l.currentSession) == null ? void 0 : _g.modeState) == null ? void 0 : _h.progressTracking) && e.jsxs("div", {
                  className: "text-xs text-muted-foreground",
                  children: [
                    "\u5DF2\u5B8C\u6210 ",
                    l.currentSession.modeState.progressTracking.completedChapters,
                    " \u7AE0 \xB7 ",
                    l.currentSession.modeState.progressTracking.totalWordCount.toLocaleString(),
                    " \u5B57"
                  ]
                }),
                d === "idle" && e.jsxs(j, {
                  size: "sm",
                  onClick: y,
                  disabled: n,
                  children: [
                    e.jsx(Ae, {
                      className: "w-4 h-4 mr-2"
                    }),
                    "\u5F00\u59CB\u521B\u4F5C"
                  ]
                })
              ]
            })
          ]
        }),
        e.jsx("div", {
          ref: s,
          className: "flex-1 overflow-y-auto",
          children: d === "idle" ? e.jsxs("div", {
            className: "flex flex-col items-center justify-center h-full gap-6 p-8",
            children: [
              e.jsx("div", {
                className: "w-20 h-20 rounded-2xl bg-linear-to-br from-purple-500/10 to-pink-500/10 flex items-center justify-center",
                children: e.jsx(ie, {
                  className: "w-10 h-10 text-purple-500"
                })
              }),
              e.jsxs("div", {
                className: "text-center space-y-2",
                children: [
                  e.jsx("h3", {
                    className: "text-xl font-semibold",
                    children: "\u5C0F\u8BF4\u521B\u4F5C\u6A21\u5F0F"
                  }),
                  e.jsx("p", {
                    className: "text-sm text-muted-foreground max-w-md",
                    children: "AI \u8F85\u52A9\u7684\u5C0F\u8BF4\u521B\u4F5C\u5DE5\u5177\uFF0C\u4ECE\u4E16\u754C\u89C2\u8BBE\u8BA1\u5230\u7AE0\u8282\u5199\u4F5C\uFF0C\u5168\u7A0B\u534F\u52A9\u60A8\u5B8C\u6210\u521B\u4F5C"
                  })
                ]
              }),
              e.jsxs(j, {
                size: "lg",
                onClick: y,
                disabled: n,
                className: "mt-4",
                children: [
                  e.jsx(Ae, {
                    className: "w-5 h-5 mr-2"
                  }),
                  "\u5F00\u59CB\u8BBE\u8BA1"
                ]
              })
            ]
          }) : e.jsx("div", {
            className: "p-4",
            children: S()
          })
        }),
        (v == null ? void 0 : v.inputEnabled) && e.jsx("div", {
          className: "border-t p-4 bg-muted/30",
          children: e.jsx("div", {
            className: "text-xs text-muted-foreground text-center",
            children: v.placeholder
          })
        })
      ]
    });
  };
});
export {
  sr as SessionMainForNovelWriting,
  __tla
};
